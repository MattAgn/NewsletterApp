{"version":3,"sources":["useSelector.js"],"names":["_interopRequireDefault","require","exports","__esModule","createSelectorHook","useSelector","_react","_invariant","_useReduxContext2","_Subscription","_Context","useIsomorphicLayoutEffect","window","useLayoutEffect","useEffect","refEquality","a","b","useSelectorWithStoreAndSubscription","selector","equalityFn","store","contextSub","_useReducer","useReducer","s","forceRender","subscription","useMemo","latestSubscriptionCallbackError","useRef","latestSelector","latestSelectedState","selectedState","current","getState","err","errorMessage","message","stack","Error","undefined","checkForUpdates","newSelectedState","onStateChange","trySubscribe","tryUnsubscribe","context","ReactReduxContext","useReduxContext","useContext","_useReduxContext"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.createSelectorHook = createSelectorHook;\nexports.useSelector = void 0;\n\nvar _react = require(\"react\");\n\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\n\nvar _useReduxContext2 = require(\"./useReduxContext\");\n\nvar _Subscription = _interopRequireDefault(require(\"../utils/Subscription\"));\n\nvar _Context = require(\"../components/Context\");\n\n// React currently throws a warning when using useLayoutEffect on the server.\n// To get around it, we can conditionally useEffect on the server (no-op) and\n// useLayoutEffect in the browser. We need useLayoutEffect to ensure the store\n// subscription callback always has the selector from the latest render commit\n// available, otherwise a store update may happen between render and the effect,\n// which may cause missed updates; we also must ensure the store subscription\n// is created synchronously, otherwise a store update may occur before the\n// subscription is created and an inconsistent state may be observed\nvar useIsomorphicLayoutEffect = typeof window !== 'undefined' ? _react.useLayoutEffect : _react.useEffect;\n\nvar refEquality = function refEquality(a, b) {\n  return a === b;\n};\n\nfunction useSelectorWithStoreAndSubscription(selector, equalityFn, store, contextSub) {\n  var _useReducer = (0, _react.useReducer)(function (s) {\n    return s + 1;\n  }, 0),\n      forceRender = _useReducer[1];\n\n  var subscription = (0, _react.useMemo)(function () {\n    return new _Subscription[\"default\"](store, contextSub);\n  }, [store, contextSub]);\n  var latestSubscriptionCallbackError = (0, _react.useRef)();\n  var latestSelector = (0, _react.useRef)();\n  var latestSelectedState = (0, _react.useRef)();\n  var selectedState;\n\n  try {\n    if (selector !== latestSelector.current || latestSubscriptionCallbackError.current) {\n      selectedState = selector(store.getState());\n    } else {\n      selectedState = latestSelectedState.current;\n    }\n  } catch (err) {\n    var errorMessage = \"An error occured while selecting the store state: \" + err.message + \".\";\n\n    if (latestSubscriptionCallbackError.current) {\n      errorMessage += \"\\nThe error may be correlated with this previous error:\\n\" + latestSubscriptionCallbackError.current.stack + \"\\n\\nOriginal stack trace:\";\n    }\n\n    throw new Error(errorMessage);\n  }\n\n  useIsomorphicLayoutEffect(function () {\n    latestSelector.current = selector;\n    latestSelectedState.current = selectedState;\n    latestSubscriptionCallbackError.current = undefined;\n  });\n  useIsomorphicLayoutEffect(function () {\n    function checkForUpdates() {\n      try {\n        var newSelectedState = latestSelector.current(store.getState());\n\n        if (equalityFn(newSelectedState, latestSelectedState.current)) {\n          return;\n        }\n\n        latestSelectedState.current = newSelectedState;\n      } catch (err) {\n        // we ignore all errors here, since when the component\n        // is re-rendered, the selectors are called again, and\n        // will throw again, if neither props nor store state\n        // changed\n        latestSubscriptionCallbackError.current = err;\n      }\n\n      forceRender({});\n    }\n\n    subscription.onStateChange = checkForUpdates;\n    subscription.trySubscribe();\n    checkForUpdates();\n    return function () {\n      return subscription.tryUnsubscribe();\n    };\n  }, [store, subscription]);\n  return selectedState;\n}\n/**\n * Hook factory, which creates a `useSelector` hook bound to a given context.\n *\n * @param {Function} [context=ReactReduxContext] Context passed to your `<Provider>`.\n * @returns {Function} A `useSelector` hook bound to the specified context.\n */\n\n\nfunction createSelectorHook(context) {\n  if (context === void 0) {\n    context = _Context.ReactReduxContext;\n  }\n\n  var useReduxContext = context === _Context.ReactReduxContext ? _useReduxContext2.useReduxContext : function () {\n    return (0, _react.useContext)(context);\n  };\n  return function useSelector(selector, equalityFn) {\n    if (equalityFn === void 0) {\n      equalityFn = refEquality;\n    }\n\n    (0, _invariant[\"default\"])(selector, \"You must pass a selector to useSelectors\");\n\n    var _useReduxContext = useReduxContext(),\n        store = _useReduxContext.store,\n        contextSub = _useReduxContext.subscription;\n\n    return useSelectorWithStoreAndSubscription(selector, equalityFn, store, contextSub);\n  };\n}\n/**\n * A hook to access the redux store's state. This hook takes a selector function\n * as an argument. The selector is called with the store state.\n *\n * This hook takes an optional equality comparison function as the second parameter\n * that allows you to customize the way the selected state is compared to determine\n * whether the component needs to be re-rendered.\n *\n * @param {Function} selector the selector function\n * @param {Function=} equalityFn the function that will be used to determine equality\n *\n * @returns {any} the selected state\n *\n * @example\n *\n * import React from 'react'\n * import { useSelector } from 'react-redux'\n *\n * export const CounterComponent = () => {\n *   const counter = useSelector(state => state.counter)\n *   return <div>{counter}</div>\n * }\n */\n\n\nvar useSelector = createSelectorHook();\nexports.useSelector = useSelector;"]}