f7a2e1e56d27947c282313fae23d0cda
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var EventEmitter = require('./EventEmitter');

var EventEmitterWithHolding = require('./EventEmitterWithHolding');

var EventHolder = require('./EventHolder');

var invariant = require('invariant');

var keyOf = require('fbjs/lib/keyOf');

var TYPES_KEY = keyOf({
  __types: true
});

function mixInEventEmitter(cls, types) {
  invariant(types, 'Must supply set of valid event types');
  var target = cls.prototype || cls;
  invariant(!target.__eventEmitter, 'An active emitter is already mixed in');
  var ctor = cls.constructor;

  if (ctor) {
    invariant(ctor === Object || ctor === Function, 'Mix EventEmitter into a class, not an instance');
  }

  if (target.hasOwnProperty(TYPES_KEY)) {
    (0, _extends2.default)(target.__types, types);
  } else if (target.__types) {
    target.__types = (0, _extends2.default)({}, target.__types, types);
  } else {
    target.__types = types;
  }

  (0, _extends2.default)(target, EventEmitterMixin);
}

var EventEmitterMixin = {
  emit: function emit(eventType, a, b, c, d, e, _) {
    return this.__getEventEmitter().emit(eventType, a, b, c, d, e, _);
  },
  emitAndHold: function emitAndHold(eventType, a, b, c, d, e, _) {
    return this.__getEventEmitter().emitAndHold(eventType, a, b, c, d, e, _);
  },
  addListener: function addListener(eventType, listener, context) {
    return this.__getEventEmitter().addListener(eventType, listener, context);
  },
  once: function once(eventType, listener, context) {
    return this.__getEventEmitter().once(eventType, listener, context);
  },
  addRetroactiveListener: function addRetroactiveListener(eventType, listener, context) {
    return this.__getEventEmitter().addRetroactiveListener(eventType, listener, context);
  },
  addListenerMap: function addListenerMap(listenerMap, context) {
    return this.__getEventEmitter().addListenerMap(listenerMap, context);
  },
  addRetroactiveListenerMap: function addRetroactiveListenerMap(listenerMap, context) {
    return this.__getEventEmitter().addListenerMap(listenerMap, context);
  },
  removeAllListeners: function removeAllListeners() {
    this.__getEventEmitter().removeAllListeners();
  },
  removeCurrentListener: function removeCurrentListener() {
    this.__getEventEmitter().removeCurrentListener();
  },
  releaseHeldEventType: function releaseHeldEventType(eventType) {
    this.__getEventEmitter().releaseHeldEventType(eventType);
  },
  __getEventEmitter: function __getEventEmitter() {
    if (!this.__eventEmitter) {
      var emitter = new EventEmitter();

      if (__DEV__) {
        var EventValidator = require('./EventValidator');

        emitter = EventValidator.addValidation(emitter, this.__types);
      }

      var holder = new EventHolder();
      this.__eventEmitter = new EventEmitterWithHolding(emitter, holder);
    }

    return this.__eventEmitter;
  }
};
module.exports = mixInEventEmitter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1peEluRXZlbnRFbWl0dGVyLmpzIl0sIm5hbWVzIjpbIkV2ZW50RW1pdHRlciIsInJlcXVpcmUiLCJFdmVudEVtaXR0ZXJXaXRoSG9sZGluZyIsIkV2ZW50SG9sZGVyIiwiaW52YXJpYW50Iiwia2V5T2YiLCJUWVBFU19LRVkiLCJfX3R5cGVzIiwibWl4SW5FdmVudEVtaXR0ZXIiLCJjbHMiLCJ0eXBlcyIsInRhcmdldCIsInByb3RvdHlwZSIsIl9fZXZlbnRFbWl0dGVyIiwiY3RvciIsImNvbnN0cnVjdG9yIiwiT2JqZWN0IiwiRnVuY3Rpb24iLCJoYXNPd25Qcm9wZXJ0eSIsIkV2ZW50RW1pdHRlck1peGluIiwiZW1pdCIsImV2ZW50VHlwZSIsImEiLCJiIiwiYyIsImQiLCJlIiwiXyIsIl9fZ2V0RXZlbnRFbWl0dGVyIiwiZW1pdEFuZEhvbGQiLCJhZGRMaXN0ZW5lciIsImxpc3RlbmVyIiwiY29udGV4dCIsIm9uY2UiLCJhZGRSZXRyb2FjdGl2ZUxpc3RlbmVyIiwiYWRkTGlzdGVuZXJNYXAiLCJsaXN0ZW5lck1hcCIsImFkZFJldHJvYWN0aXZlTGlzdGVuZXJNYXAiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJyZW1vdmVDdXJyZW50TGlzdGVuZXIiLCJyZWxlYXNlSGVsZEV2ZW50VHlwZSIsImVtaXR0ZXIiLCJfX0RFVl9fIiwiRXZlbnRWYWxpZGF0b3IiLCJhZGRWYWxpZGF0aW9uIiwiaG9sZGVyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7OztBQUVBLElBQU1BLFlBQVksR0FBR0MsT0FBTyxDQUFDLGdCQUFELENBQTVCOztBQUNBLElBQU1DLHVCQUF1QixHQUFHRCxPQUFPLENBQUMsMkJBQUQsQ0FBdkM7O0FBQ0EsSUFBTUUsV0FBVyxHQUFHRixPQUFPLENBQUMsZUFBRCxDQUEzQjs7QUFFQSxJQUFNRyxTQUFTLEdBQUdILE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1JLEtBQUssR0FBR0osT0FBTyxDQUFD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Q0Q7QUF6RHVCLENBQTFCO0FBNERBaUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCdkMsaUJBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgRXZlbnRFbWl0dGVyID0gcmVxdWlyZSgnLi9FdmVudEVtaXR0ZXInKTtcbmNvbnN0IEV2ZW50RW1pdHRlcldpdGhIb2xkaW5nID0gcmVxdWlyZSgnLi9FdmVudEVtaXR0ZXJXaXRoSG9sZGluZycpO1xuY29uc3QgRXZlbnRIb2xkZXIgPSByZXF1aXJlKCcuL0V2ZW50SG9sZGVyJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuY29uc3Qga2V5T2YgPSByZXF1aXJlKCdmYmpzL2xpYi9rZXlPZicpO1xuXG5pbXBvcnQgdHlwZSBFbWl0dGVyU3Vic2NyaXB0aW9uIGZyb20gJy4vRW1pdHRlclN1YnNjcmlwdGlvbic7XG5cbmNvbnN0IFRZUEVTX0tFWSA9IGtleU9mKHtfX3R5cGVzOiB0cnVlfSk7XG5cbi8qKlxuICogQVBJIHRvIHNldHVwIGFuIG9iamVjdCBvciBjb25zdHJ1Y3RvciB0byBiZSBhYmxlIHRvIGVtaXQgZGF0YSBldmVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqIGZ1bmN0aW9uIERvZygpIHsgLi4uZG9nIHN0dWZmLi4uIH1cbiAqIG1peEluRXZlbnRFbWl0dGVyKERvZywge2Jhcms6IHRydWV9KTtcbiAqXG4gKiB2YXIgcHVwcHkgPSBuZXcgRG9nKCk7XG4gKiBwdXBweS5hZGRMaXN0ZW5lcignYmFyaycsIGZ1bmN0aW9uICh2b2x1bWUpIHtcbiAqICAgY29uc29sZS5sb2coJ1B1cHB5JywgdGhpcywgJ2JhcmtlZCBhdCB2b2x1bWU6Jywgdm9sdW1lKTtcbiAqIH0pO1xuICogcHVwcHkuZW1pdCgnYmFyaycsICdxdWlldCcpO1xuICogLy8gUHVwcHkgPHB1cHB5PiBiYXJrZWQgYXQgdm9sdW1lOiBxdWlldFxuICpcbiAqXG4gKiAvLyBBIFwic2luZ2xldG9uXCIgb2JqZWN0IG1heSBhbHNvIGJlIGNvbW1pc3Npb25lZDpcbiAqXG4gKiB2YXIgU2luZ2xldG9uID0ge307XG4gKiBtaXhJbkV2ZW50RW1pdHRlcihTaW5nbGV0b24sIHtsb25lbHk6IHRydWV9KTtcbiAqIFNpbmdsZXRvbi5lbWl0KCdsb25lbHknLCB0cnVlKTtcbiAqL1xuZnVuY3Rpb24gbWl4SW5FdmVudEVtaXR0ZXIoY2xzOiBGdW5jdGlvbiB8IE9iamVjdCwgdHlwZXM6IE9iamVjdCkge1xuICBpbnZhcmlhbnQodHlwZXMsICdNdXN0IHN1cHBseSBzZXQgb2YgdmFsaWQgZXZlbnQgdHlwZXMnKTtcblxuICAvLyBJZiB0aGlzIGlzIGEgY29uc3RydWN0b3IsIHdyaXRlIHRvIHRoZSBwcm90b3R5cGUsIG90aGVyd2lzZSB3cml0ZSB0byB0aGVcbiAgLy8gc2luZ2xldG9uIG9iamVjdC5cbiAgY29uc3QgdGFyZ2V0ID0gY2xzLnByb3RvdHlwZSB8fCBjbHM7XG5cbiAgaW52YXJpYW50KCF0YXJnZXQuX19ldmVudEVtaXR0ZXIsICdBbiBhY3RpdmUgZW1pdHRlciBpcyBhbHJlYWR5IG1peGVkIGluJyk7XG5cbiAgY29uc3QgY3RvciA9IGNscy5jb25zdHJ1Y3RvcjtcbiAgaWYgKGN0b3IpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBjdG9yID09PSBPYmplY3QgfHwgY3RvciA9PT0gRnVuY3Rpb24sXG4gICAgICAnTWl4IEV2ZW50RW1pdHRlciBpbnRvIGEgY2xhc3MsIG5vdCBhbiBpbnN0YW5jZScsXG4gICAgKTtcbiAgfVxuXG4gIC8vIEtlZXAgdHJhY2sgb2YgdGhlIHByb3ZpZGVkIHR5cGVzLCB1bmlvbiB0aGUgdHlwZXMgaWYgdGhleSBhbHJlYWR5IGV4aXN0LFxuICAvLyB3aGljaCBhbGxvd3MgZm9yIHByb3RvdHlwZSBzdWJjbGFzc2VzIHRvIHByb3ZpZGUgbW9yZSB0eXBlcy5cbiAgaWYgKHRhcmdldC5oYXNPd25Qcm9wZXJ0eShUWVBFU19LRVkpKSB7XG4gICAgT2JqZWN0LmFzc2lnbih0YXJnZXQuX190eXBlcywgdHlwZXMpO1xuICB9IGVsc2UgaWYgKHRhcmdldC5fX3R5cGVzKSB7XG4gICAgdGFyZ2V0Ll9fdHlwZXMgPSBPYmplY3QuYXNzaWduKHt9LCB0YXJnZXQuX190eXBlcywgdHlwZXMpO1xuICB9IGVsc2Uge1xuICAgIHRhcmdldC5fX3R5cGVzID0gdHlwZXM7XG4gIH1cbiAgT2JqZWN0LmFzc2lnbih0YXJnZXQsIEV2ZW50RW1pdHRlck1peGluKTtcbn1cblxuY29uc3QgRXZlbnRFbWl0dGVyTWl4aW4gPSB7XG4gIGVtaXQ6IGZ1bmN0aW9uKGV2ZW50VHlwZSwgYSwgYiwgYywgZCwgZSwgXykge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0RXZlbnRFbWl0dGVyKCkuZW1pdChldmVudFR5cGUsIGEsIGIsIGMsIGQsIGUsIF8pO1xuICB9LFxuXG4gIGVtaXRBbmRIb2xkOiBmdW5jdGlvbihldmVudFR5cGUsIGEsIGIsIGMsIGQsIGUsIF8pIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldEV2ZW50RW1pdHRlcigpLmVtaXRBbmRIb2xkKGV2ZW50VHlwZSwgYSwgYiwgYywgZCwgZSwgXyk7XG4gIH0sXG5cbiAgYWRkTGlzdGVuZXI6IGZ1bmN0aW9uKGV2ZW50VHlwZSwgbGlzdGVuZXIsIGNvbnRleHQpOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldEV2ZW50RW1pdHRlcigpLmFkZExpc3RlbmVyKGV2ZW50VHlwZSwgbGlzdGVuZXIsIGNvbnRleHQpO1xuICB9LFxuXG4gIG9uY2U6IGZ1bmN0aW9uKGV2ZW50VHlwZSwgbGlzdGVuZXIsIGNvbnRleHQpIHtcbiAgICByZXR1cm4gdGhpcy5fX2dldEV2ZW50RW1pdHRlcigpLm9uY2UoZXZlbnRUeXBlLCBsaXN0ZW5lciwgY29udGV4dCk7XG4gIH0sXG5cbiAgYWRkUmV0cm9hY3RpdmVMaXN0ZW5lcjogZnVuY3Rpb24oZXZlbnRUeXBlLCBsaXN0ZW5lciwgY29udGV4dCkge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0RXZlbnRFbWl0dGVyKCkuYWRkUmV0cm9hY3RpdmVMaXN0ZW5lcihcbiAgICAgIGV2ZW50VHlwZSxcbiAgICAgIGxpc3RlbmVyLFxuICAgICAgY29udGV4dCxcbiAgICApO1xuICB9LFxuXG4gIGFkZExpc3RlbmVyTWFwOiBmdW5jdGlvbihsaXN0ZW5lck1hcCwgY29udGV4dCkge1xuICAgIHJldHVybiB0aGlzLl9fZ2V0RXZlbnRFbWl0dGVyKCkuYWRkTGlzdGVuZXJNYXAobGlzdGVuZXJNYXAsIGNvbnRleHQpO1xuICB9LFxuXG4gIGFkZFJldHJvYWN0aXZlTGlzdGVuZXJNYXA6IGZ1bmN0aW9uKGxpc3RlbmVyTWFwLCBjb250ZXh0KSB7XG4gICAgcmV0dXJuIHRoaXMuX19nZXRFdmVudEVtaXR0ZXIoKS5hZGRMaXN0ZW5lck1hcChsaXN0ZW5lck1hcCwgY29udGV4dCk7XG4gIH0sXG5cbiAgcmVtb3ZlQWxsTGlzdGVuZXJzOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9fZ2V0RXZlbnRFbWl0dGVyKCkucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gIH0sXG5cbiAgcmVtb3ZlQ3VycmVudExpc3RlbmVyOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9fZ2V0RXZlbnRFbWl0dGVyKCkucmVtb3ZlQ3VycmVudExpc3RlbmVyKCk7XG4gIH0sXG5cbiAgcmVsZWFzZUhlbGRFdmVudFR5cGU6IGZ1bmN0aW9uKGV2ZW50VHlwZSkge1xuICAgIHRoaXMuX19nZXRFdmVudEVtaXR0ZXIoKS5yZWxlYXNlSGVsZEV2ZW50VHlwZShldmVudFR5cGUpO1xuICB9LFxuXG4gIF9fZ2V0RXZlbnRFbWl0dGVyOiBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuX19ldmVudEVtaXR0ZXIpIHtcbiAgICAgIGxldCBlbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgaWYgKF9fREVWX18pIHtcbiAgICAgICAgY29uc3QgRXZlbnRWYWxpZGF0b3IgPSByZXF1aXJlKCcuL0V2ZW50VmFsaWRhdG9yJyk7XG4gICAgICAgIGVtaXR0ZXIgPSBFdmVudFZhbGlkYXRvci5hZGRWYWxpZGF0aW9uKGVtaXR0ZXIsIHRoaXMuX190eXBlcyk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhvbGRlciA9IG5ldyBFdmVudEhvbGRlcigpO1xuICAgICAgdGhpcy5fX2V2ZW50RW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXJXaXRoSG9sZGluZyhlbWl0dGVyLCBob2xkZXIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fX2V2ZW50RW1pdHRlcjtcbiAgfSxcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gbWl4SW5FdmVudEVtaXR0ZXI7XG4iXX0=