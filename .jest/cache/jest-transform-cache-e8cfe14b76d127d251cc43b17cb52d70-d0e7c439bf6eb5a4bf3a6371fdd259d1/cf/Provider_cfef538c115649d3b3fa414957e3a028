3b28414279aee12860a8e3c1d809572a
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

exports.__esModule = true;
exports["default"] = void 0;

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _Context = require("./Context");

var _Subscription = _interopRequireDefault(require("../utils/Subscription"));

function Provider(_ref) {
  var store = _ref.store,
      context = _ref.context,
      children = _ref.children;
  var contextValue = (0, _react.useMemo)(function () {
    var subscription = new _Subscription["default"](store);
    subscription.onStateChange = subscription.notifyNestedSubs;
    return {
      store: store,
      subscription: subscription
    };
  }, [store]);
  var previousState = (0, _react.useMemo)(function () {
    return store.getState();
  }, [store]);
  (0, _react.useEffect)(function () {
    var subscription = contextValue.subscription;
    subscription.trySubscribe();

    if (previousState !== store.getState()) {
      subscription.notifyNestedSubs();
    }

    return function () {
      subscription.tryUnsubscribe();
      subscription.onStateChange = null;
    };
  }, [contextValue, previousState]);
  var Context = context || _Context.ReactReduxContext;
  return _react["default"].createElement(Context.Provider, {
    value: contextValue
  }, children);
}

Provider.propTypes = {
  store: _propTypes["default"].shape({
    subscribe: _propTypes["default"].func.isRequired,
    dispatch: _propTypes["default"].func.isRequired,
    getState: _propTypes["default"].func.isRequired
  }),
  context: _propTypes["default"].object,
  children: _propTypes["default"].any
};
var _default = Provider;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlByb3ZpZGVyLmpzIl0sIm5hbWVzIjpbIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJleHBvcnRzIiwiX19lc01vZHVsZSIsIl9yZWFjdCIsIl9wcm9wVHlwZXMiLCJfQ29udGV4dCIsIl9TdWJzY3JpcHRpb24iLCJQcm92aWRlciIsIl9yZWYiLCJzdG9yZSIsImNvbnRleHQiLCJjaGlsZHJlbiIsImNvbnRleHRWYWx1ZSIsInVzZU1lbW8iLCJzdWJzY3JpcHRpb24iLCJvblN0YXRlQ2hhbmdlIiwibm90aWZ5TmVzdGVkU3VicyIsInByZXZpb3VzU3RhdGUiLCJnZXRTdGF0ZSIsInVzZUVmZmVjdCIsInRyeVN1YnNjcmliZSIsInRyeVVuc3Vic2NyaWJlIiwiQ29udGV4dCIsIlJlYWN0UmVkdXhDb250ZXh0IiwiY3JlYXRlRWxlbWVudCIsInZhbHVlIiwicHJvcFR5cGVzIiwic2hhcGUiLCJzdWJzY3JpYmUiLCJmdW5jIiwiaXNSZXF1aXJlZCIsImRpc3BhdGNoIiwib2JqZWN0IiwiYW55IiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLHNCQUFzQixHQUFHQyxPQUFPLENBQUMsOENBQUQsQ0FBcEM7O0FBRUEsSUFBSUMsdUJBQXVCLEdBQUdELE9BQU8sQ0FBQywrQ0FBRCxDQUFyQzs7QUFFQUUsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQyxTQUFELENBQVAsR0FBcUIsS0FBSyxDQUExQjs7QUFFQSxJQUFJRSxNQUFNLEdBQUdILHVCQUF1QixDQUFDRCxPQUFPLENBQUMsT0FBRCxDQUFSLENBQXBDOztBQUVBLElBQUlLLFVBQVUsR0FBR04sc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxZQUFELENBQVIsQ0FBdkM7O0FBRUEsSUFBSU0sUUFBUSxHQUFHTixPQUFPLENBQUMsV0FBRCxDQUF0Qjs7QUFFQSxJQUFJTyxhQUFhLEdBQUdSLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsdUJBQUQsQ0FBUixDQUExQzs7QUFFQSxTQUFTUSxRQUFULENBQWtCQyxJQUFsQixFQUF3QjtBQUN0QixNQUFJQyxLQUFLLEdBQUdELElBQUksQ0FBQ0MsS0FBakI7QUFBQSxNQUNJQyxPQUFPLEdBQUdGLElBQUksQ0FBQ0UsT0FEbkI7QUFBQSxNQUVJQyxRQUFRLEdBQUdILElBQUksQ0FBQ0csUUFGcEI7QUFHQSxNQUFJQyxZQUFZLEdBQUcsQ0FBQyxHQUFHVCxNQUFNLENBQUNVLE9BQVgsRUFBb0IsWUFBWTtBQUNqRCxRQUFJQyxZQUFZLEdBQUcsSUFBSVIsYUFBYSxDQUFDLFNBQUQsQ0FBakIsQ0FBNkJHLEtBQTdCLENBQW5CO0FBQ0FLLElBQUFBLFlBQVksQ0FBQ0MsYUFBYixHQUE2QkQsWUFBWSxDQUFDRSxnQkFBMUM7QUFDQSxXQUFPO0FBQ0xQLE1BQUFBLEtBQUssRUFBRUEsS0FERjtBQUVMSyxNQUFBQSxZQUFZLEVBQUVBO0FBRlQsS0FBUDtBQUlELEdBUGtCLEVBT2hCLENBQUNMLEtBQUQsQ0FQZ0IsQ0FBbkI7QUFRQSxNQUFJUSxhQUFhLEdBQUcsQ0FBQyxHQUFHZCxNQUFNLENBQUNVLE9BQVgsRUFBb0IsWUFBWTtBQUNsRCxXQUFPSixLQUFLLENBQUNTLFFBQU4sRUFBUDtBQUNELEdBRm1CLEVBRWpCLENBQUNULEtBQUQsQ0FGaUIsQ0FBcEI7QUFHQSxHQUFDLEdBQUdOLE1BQU0sQ0FBQ2dCLFNBQVgsRUFBc0IsWUFBWTtBQUNoQyxRQUFJTCxZQUFZLEdBQUdGLFlBQVksQ0FBQ0UsWUFBaEM7QUFDQUEsSUFBQUEsWUFBWSxDQUFDTSxZQUFiOztBQUVBLFFBQUlILGFBQWEsS0FBS1IsS0FBSyxDQUFDUyxRQUFOLEVBQXRCLEVBQXdDO0FBQ3RDSixNQUFBQSxZQUFZLENBQUNFLGdCQUFiO0FBQ0Q7O0FBRUQsV0FBTyxZQUFZO0FBQ2pCRixNQUFBQSxZQUFZLENBQUNPLGNBQWI7QUFDQVAsTUFBQUEsWUFBWSxDQUFDQyxhQUFiLEdBQTZCLElBQTdCO0FBQ0QsS0FIRDtBQUlELEdBWkQsRUFZRyxDQUFDSCxZQUFELEVBQWVLLGFBQWYsQ0FaSDtBQWFBLE1BQUlLLE9BQU8sR0FBR1osT0FBTyxJQUFJTCxRQUFRLENBQUNrQixpQkFBbEM7QUFDQSxTQUFPcEIsTUFBTSxDQUFDLFNBQUQsQ0FBTixDQUFrQnFCLGFBQWxCLENBQWdDRixPQUFPLENBQUNmLFFBQXhDLEVBQWtEO0FBQ3ZEa0IsSUFBQUEsS0FBSyxFQUFFYjtBQURnRCxHQUFsRCxFQUVKRCxRQUZJLENBQVA7QUFHRDs7QUFFREosUUFBUSxDQUFDbUIsU0FBVCxHQUFxQjtBQUNuQmpCLEVBQUFBLEtBQUssRUFBRUwsVUFBVSxDQUFDLFNBQUQsQ0FBVixDQUFzQnVCLEtBQXRCLENBQTRCO0FBQ2pDQyxJQUFBQSxTQUFTLEVBQUV4QixVQUFVLENBQUMsU0FBRCxDQUFWLENBQXNCeUIsSUFBdEIsQ0FBMkJDLFVBREw7QUFFakNDLElBQUFBLFFBQVEsRUFBRTNCLFVBQVUsQ0FBQyxTQUFELENBQVYsQ0FBc0J5QixJQUF0QixDQUEyQkMsVUFGSjtBQUdqQ1osSUFBQUEsUUFBUSxFQUFFZCxVQUFVLENBQUMsU0FBRCxDQUFWLENBQXNCeUIsSUFBdEIsQ0FBMkJDO0FBSEosR0FBNUIsQ0FEWTtBQU1uQnBCLEVBQUFBLE9BQU8sRUFBRU4sVUFBVSxDQUFDLFNBQUQsQ0FBVixDQUFzQjRCLE1BTlo7QUFPbkJyQixFQUFBQSxRQUFRLEVBQUVQLFVBQVUsQ0FBQyxTQUFELENBQVYsQ0FBc0I2QjtBQVBiLENBQXJCO0FBU0EsSUFBSUMsUUFBUSxHQUFHM0IsUUFBZjtBQUNBTixPQUFPLENBQUMsU0FBRCxDQUFQLEdBQXFCaUMsUUFBckIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxudmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZURlZmF1bHRcIik7XG5cbnZhciBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlV2lsZGNhcmRcIik7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IHZvaWQgMDtcblxudmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJyZWFjdFwiKSk7XG5cbnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicHJvcC10eXBlc1wiKSk7XG5cbnZhciBfQ29udGV4dCA9IHJlcXVpcmUoXCIuL0NvbnRleHRcIik7XG5cbnZhciBfU3Vic2NyaXB0aW9uID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vdXRpbHMvU3Vic2NyaXB0aW9uXCIpKTtcblxuZnVuY3Rpb24gUHJvdmlkZXIoX3JlZikge1xuICB2YXIgc3RvcmUgPSBfcmVmLnN0b3JlLFxuICAgICAgY29udGV4dCA9IF9yZWYuY29udGV4dCxcbiAgICAgIGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbjtcbiAgdmFyIGNvbnRleHRWYWx1ZSA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgIHZhciBzdWJzY3JpcHRpb24gPSBuZXcgX1N1YnNjcmlwdGlvbltcImRlZmF1bHRcIl0oc3RvcmUpO1xuICAgIHN1YnNjcmlwdGlvbi5vblN0YXRlQ2hhbmdlID0gc3Vic2NyaXB0aW9uLm5vdGlmeU5lc3RlZFN1YnM7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0b3JlOiBzdG9yZSxcbiAgICAgIHN1YnNjcmlwdGlvbjogc3Vic2NyaXB0aW9uXG4gICAgfTtcbiAgfSwgW3N0b3JlXSk7XG4gIHZhciBwcmV2aW91c1N0YXRlID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHN0b3JlLmdldFN0YXRlKCk7XG4gIH0sIFtzdG9yZV0pO1xuICAoMCwgX3JlYWN0LnVzZUVmZmVjdCkoZnVuY3Rpb24gKCkge1xuICAgIHZhciBzdWJzY3JpcHRpb24gPSBjb250ZXh0VmFsdWUuc3Vic2NyaXB0aW9uO1xuICAgIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTtcblxuICAgIGlmIChwcmV2aW91c1N0YXRlICE9PSBzdG9yZS5nZXRTdGF0ZSgpKSB7XG4gICAgICBzdWJzY3JpcHRpb24ubm90aWZ5TmVzdGVkU3VicygpO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICBzdWJzY3JpcHRpb24udHJ5VW5zdWJzY3JpYmUoKTtcbiAgICAgIHN1YnNjcmlwdGlvbi5vblN0YXRlQ2hhbmdlID0gbnVsbDtcbiAgICB9O1xuICB9LCBbY29udGV4dFZhbHVlLCBwcmV2aW91c1N0YXRlXSk7XG4gIHZhciBDb250ZXh0ID0gY29udGV4dCB8fCBfQ29udGV4dC5SZWFjdFJlZHV4Q29udGV4dDtcbiAgcmV0dXJuIF9yZWFjdFtcImRlZmF1bHRcIl0uY3JlYXRlRWxlbWVudChDb250ZXh0LlByb3ZpZGVyLCB7XG4gICAgdmFsdWU6IGNvbnRleHRWYWx1ZVxuICB9LCBjaGlsZHJlbik7XG59XG5cblByb3ZpZGVyLnByb3BUeXBlcyA9IHtcbiAgc3RvcmU6IF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLnNoYXBlKHtcbiAgICBzdWJzY3JpYmU6IF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICBkaXNwYXRjaDogX3Byb3BUeXBlc1tcImRlZmF1bHRcIl0uZnVuYy5pc1JlcXVpcmVkLFxuICAgIGdldFN0YXRlOiBfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5mdW5jLmlzUmVxdWlyZWRcbiAgfSksXG4gIGNvbnRleHQ6IF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLm9iamVjdCxcbiAgY2hpbGRyZW46IF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLmFueVxufTtcbnZhciBfZGVmYXVsdCA9IFByb3ZpZGVyO1xuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBfZGVmYXVsdDsiXX0=