1abb41e40b431354d3908059d0d06888
'use strict';

var MatrixMath = require('../Utilities/MatrixMath');

var Platform = require('../Utilities/Platform');

var invariant = require('invariant');

var stringifySafe = require('../Utilities/stringifySafe');

function processTransform(transform) {
  if (__DEV__) {
    _validateTransforms(transform);
  }

  if (Platform.OS === 'android' || Platform.OS === 'ios') {
    return transform;
  }

  var result = MatrixMath.createIdentityMatrix();
  transform.forEach(function (transformation) {
    var key = Object.keys(transformation)[0];
    var value = transformation[key];

    switch (key) {
      case 'matrix':
        MatrixMath.multiplyInto(result, result, value);
        break;

      case 'perspective':
        _multiplyTransform(result, MatrixMath.reusePerspectiveCommand, [value]);

        break;

      case 'rotateX':
        _multiplyTransform(result, MatrixMath.reuseRotateXCommand, [_convertToRadians(value)]);

        break;

      case 'rotateY':
        _multiplyTransform(result, MatrixMath.reuseRotateYCommand, [_convertToRadians(value)]);

        break;

      case 'rotate':
      case 'rotateZ':
        _multiplyTransform(result, MatrixMath.reuseRotateZCommand, [_convertToRadians(value)]);

        break;

      case 'scale':
        _multiplyTransform(result, MatrixMath.reuseScaleCommand, [value]);

        break;

      case 'scaleX':
        _multiplyTransform(result, MatrixMath.reuseScaleXCommand, [value]);

        break;

      case 'scaleY':
        _multiplyTransform(result, MatrixMath.reuseScaleYCommand, [value]);

        break;

      case 'translate':
        _multiplyTransform(result, MatrixMath.reuseTranslate3dCommand, [value[0], value[1], value[2] || 0]);

        break;

      case 'translateX':
        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [value, 0]);

        break;

      case 'translateY':
        _multiplyTransform(result, MatrixMath.reuseTranslate2dCommand, [0, value]);

        break;

      case 'skewX':
        _multiplyTransform(result, MatrixMath.reuseSkewXCommand, [_convertToRadians(value)]);

        break;

      case 'skewY':
        _multiplyTransform(result, MatrixMath.reuseSkewYCommand, [_convertToRadians(value)]);

        break;

      default:
        throw new Error('Invalid transform name: ' + key);
    }
  });
  return result;
}

function _multiplyTransform(result, matrixMathFunction, args) {
  var matrixToApply = MatrixMath.createIdentityMatrix();
  var argsWithIdentity = [matrixToApply].concat(args);
  matrixMathFunction.apply(this, argsWithIdentity);
  MatrixMath.multiplyInto(result, result, matrixToApply);
}

function _convertToRadians(value) {
  var floatValue = parseFloat(value);
  return value.indexOf('rad') > -1 ? floatValue : floatValue * Math.PI / 180;
}

function _validateTransforms(transform) {
  transform.forEach(function (transformation) {
    var keys = Object.keys(transformation);
    invariant(keys.length === 1, 'You must specify exactly one property per transform object. Passed properties: %s', stringifySafe(transformation));
    var key = keys[0];
    var value = transformation[key];

    _validateTransform(key, value, transformation);
  });
}

function _validateTransform(key, value, transformation) {
  invariant(!value.getValue, 'You passed an Animated.Value to a normal component. ' + 'You need to wrap that component in an Animated. For example, ' + 'replace <View /> by <Animated.View />.');
  var multivalueTransforms = ['matrix', 'translate'];

  if (multivalueTransforms.indexOf(key) !== -1) {
    invariant(Array.isArray(value), 'Transform with key of %s must have an array as the value: %s', key, stringifySafe(transformation));
  }

  switch (key) {
    case 'matrix':
      invariant(value.length === 9 || value.length === 16, 'Matrix transform must have a length of 9 (2d) or 16 (3d). ' + 'Provided matrix has a length of %s: %s', value.length, stringifySafe(transformation));
      break;

    case 'translate':
      invariant(value.length === 2 || value.length === 3, 'Transform with key translate must be an array of length 2 or 3, found %s: %s', value.length, stringifySafe(transformation));
      break;

    case 'rotateX':
    case 'rotateY':
    case 'rotateZ':
    case 'rotate':
    case 'skewX':
    case 'skewY':
      invariant(typeof value === 'string', 'Transform with key of "%s" must be a string: %s', key, stringifySafe(transformation));
      invariant(value.indexOf('deg') > -1 || value.indexOf('rad') > -1, 'Rotate transform must be expressed in degrees (deg) or radians ' + '(rad): %s', stringifySafe(transformation));
      break;

    case 'perspective':
      invariant(typeof value === 'number', 'Transform with key of "%s" must be a number: %s', key, stringifySafe(transformation));
      invariant(value !== 0, 'Transform with key of "%s" cannot be zero: %s', key, stringifySafe(transformation));
      break;

    case 'translateX':
    case 'translateY':
    case 'scale':
    case 'scaleX':
    case 'scaleY':
      invariant(typeof value === 'number', 'Transform with key of "%s" must be a number: %s', key, stringifySafe(transformation));
      break;

    default:
      invariant(false, 'Invalid transform %s: %s', key, stringifySafe(transformation));
  }
}

module.exports = processTransform;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInByb2Nlc3NUcmFuc2Zvcm0uanMiXSwibmFtZXMiOlsiTWF0cml4TWF0aCIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsImludmFyaWFudCIsInN0cmluZ2lmeVNhZmUiLCJwcm9jZXNzVHJhbnNmb3JtIiwidHJhbnNmb3JtIiwiX19ERVZfXyIsIl92YWxpZGF0ZVRyYW5zZm9ybXMiLCJPUyIsInJlc3VsdCIsImNyZWF0ZUlkZW50aXR5TWF0cml4IiwiZm9yRWFjaCIsInRyYW5zZm9ybWF0aW9uIiwia2V5IiwiT2JqZWN0Iiwia2V5cyIsInZhbHVlIiwibXVsdGlwbHlJbnRvIiwiX211bHRpcGx5VHJhbnNmb3JtIiwicmV1c2VQZXJzcGVjdGl2ZUNvbW1hbmQiLCJyZXVzZVJvdGF0ZVhDb21tYW5kIiwiX2NvbnZlcnRUb1JhZGlhbnMiLCJyZXVzZVJvdGF0ZVlDb21tYW5kIiwicmV1c2VSb3RhdGVaQ29tbWFuZCIsInJldXNlU2NhbGVDb21tYW5kIiwicmV1c2VTY2FsZVhDb21tYW5kIiwicmV1c2VTY2FsZVlDb21tYW5kIiwicmV1c2VUcmFuc2xhdGUzZENvbW1hbmQiLCJyZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCIsInJldXNlU2tld1hDb21tYW5kIiwicmV1c2VTa2V3WUNvbW1hbmQiLCJFcnJvciIsIm1hdHJpeE1hdGhGdW5jdGlvbiIsImFyZ3MiLCJtYXRyaXhUb0FwcGx5IiwiYXJnc1dpdGhJZGVudGl0eSIsImNvbmNhdCIsImFwcGx5IiwiZmxvYXRWYWx1ZSIsInBhcnNlRmxvYXQiLCJpbmRleE9mIiwiTWF0aCIsIlBJIiwibGVuZ3RoIiwiX3ZhbGlkYXRlVHJhbnNmb3JtIiwiZ2V0VmFsdWUiLCJtdWx0aXZhbHVlVHJhbnNmb3JtcyIsIkFycmF5IiwiaXNBcnJheSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVVBOztBQUVBLElBQU1BLFVBQVUsR0FBR0MsT0FBTyxDQUFDLHlCQUFELENBQTFCOztBQUNBLElBQU1DLFFBQVEsR0FBR0Qs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QSxTQUFLLFFBQUw7QUFDQSxTQUFLLFFBQUw7QUFDRVYsTUFBQUEsU0FBUyxDQUNQLE9BQU9jLEtBQVAsS0FBaUIsUUFEVixFQUVQLGlEQUZPLEVBR1BILEdBSE8sRUFJUFYsYUFBYSxDQUFDUyxjQUFELENBSk4sQ0FBVDtBQU1BOztBQUNGO0FBQ0VWLE1BQUFBLFNBQVMsQ0FDUCxLQURPLEVBRVAsMEJBRk8sRUFHUFcsR0FITyxFQUlQVixhQUFhLENBQUNTLGNBQUQsQ0FKTixDQUFUO0FBNUVKO0FBbUZEOztBQUVEcUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCOUMsZ0JBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgTWF0cml4TWF0aCA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9NYXRyaXhNYXRoJyk7XG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoJy4uL1V0aWxpdGllcy9QbGF0Zm9ybScpO1xuXG5jb25zdCBpbnZhcmlhbnQgPSByZXF1aXJlKCdpbnZhcmlhbnQnKTtcbmNvbnN0IHN0cmluZ2lmeVNhZmUgPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvc3RyaW5naWZ5U2FmZScpO1xuXG4vKipcbiAqIEdlbmVyYXRlIGEgdHJhbnNmb3JtIG1hdHJpeCBiYXNlZCBvbiB0aGUgcHJvdmlkZWQgdHJhbnNmb3JtcywgYW5kIHVzZSB0aGF0XG4gKiB3aXRoaW4gdGhlIHN0eWxlIG9iamVjdCBpbnN0ZWFkLlxuICpcbiAqIFRoaXMgYWxsb3dzIHVzIHRvIHByb3ZpZGUgYW4gQVBJIHRoYXQgaXMgc2ltaWxhciB0byBDU1MsIHdoZXJlIHRyYW5zZm9ybXMgbWF5XG4gKiBiZSBhcHBsaWVkIGluIGFuIGFyYml0cmFyeSBvcmRlciwgYW5kIHlldCBoYXZlIGEgdW5pdmVyc2FsLCBzaW5ndWxhclxuICogaW50ZXJmYWNlIHRvIG5hdGl2ZSBjb2RlLlxuICovXG5mdW5jdGlvbiBwcm9jZXNzVHJhbnNmb3JtKFxuICB0cmFuc2Zvcm06IEFycmF5PE9iamVjdD4sXG4pOiBBcnJheTxPYmplY3Q+IHwgQXJyYXk8bnVtYmVyPiB7XG4gIGlmIChfX0RFVl9fKSB7XG4gICAgX3ZhbGlkYXRlVHJhbnNmb3Jtcyh0cmFuc2Zvcm0pO1xuICB9XG5cbiAgLy8gQW5kcm9pZCAmIGlPUyBpbXBsZW1lbnRhdGlvbnMgb2YgdHJhbnNmb3JtIHByb3BlcnR5IGFjY2VwdCB0aGUgbGlzdCBvZlxuICAvLyB0cmFuc2Zvcm0gcHJvcGVydGllcyBhcyBvcHBvc2VkIHRvIGEgdHJhbnNmb3JtIE1hdHJpeC4gVGhpcyBpcyBuZWNlc3NhcnlcbiAgLy8gdG8gY29udHJvbCB0cmFuc2Zvcm0gcHJvcGVydHkgdXBkYXRlcyBjb21wbGV0ZWx5IG9uIHRoZSBuYXRpdmUgdGhyZWFkLlxuICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyB8fCBQbGF0Zm9ybS5PUyA9PT0gJ2lvcycpIHtcbiAgICByZXR1cm4gdHJhbnNmb3JtO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0gTWF0cml4TWF0aC5jcmVhdGVJZGVudGl0eU1hdHJpeCgpO1xuXG4gIHRyYW5zZm9ybS5mb3JFYWNoKHRyYW5zZm9ybWF0aW9uID0+IHtcbiAgICBjb25zdCBrZXkgPSBPYmplY3Qua2V5cyh0cmFuc2Zvcm1hdGlvbilbMF07XG4gICAgY29uc3QgdmFsdWUgPSB0cmFuc2Zvcm1hdGlvbltrZXldO1xuXG4gICAgc3dpdGNoIChrZXkpIHtcbiAgICAgIGNhc2UgJ21hdHJpeCc6XG4gICAgICAgIE1hdHJpeE1hdGgubXVsdGlwbHlJbnRvKHJlc3VsdCwgcmVzdWx0LCB2YWx1ZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncGVyc3BlY3RpdmUnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlUGVyc3BlY3RpdmVDb21tYW5kLCBbdmFsdWVdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyb3RhdGVYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVJvdGF0ZVhDb21tYW5kLCBbXG4gICAgICAgICAgX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpLFxuICAgICAgICBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyb3RhdGVZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVJvdGF0ZVlDb21tYW5kLCBbXG4gICAgICAgICAgX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpLFxuICAgICAgICBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyb3RhdGUnOlxuICAgICAgY2FzZSAncm90YXRlWic6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VSb3RhdGVaQ29tbWFuZCwgW1xuICAgICAgICAgIF9jb252ZXJ0VG9SYWRpYW5zKHZhbHVlKSxcbiAgICAgICAgXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2NhbGUnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2NhbGVDb21tYW5kLCBbdmFsdWVdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzY2FsZVgnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2NhbGVYQ29tbWFuZCwgW3ZhbHVlXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2NhbGVZJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVNjYWxlWUNvbW1hbmQsIFt2YWx1ZV0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RyYW5zbGF0ZSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VUcmFuc2xhdGUzZENvbW1hbmQsIFtcbiAgICAgICAgICB2YWx1ZVswXSxcbiAgICAgICAgICB2YWx1ZVsxXSxcbiAgICAgICAgICB2YWx1ZVsyXSB8fCAwLFxuICAgICAgICBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICd0cmFuc2xhdGVYJzpcbiAgICAgICAgX211bHRpcGx5VHJhbnNmb3JtKHJlc3VsdCwgTWF0cml4TWF0aC5yZXVzZVRyYW5zbGF0ZTJkQ29tbWFuZCwgW1xuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIDAsXG4gICAgICAgIF0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RyYW5zbGF0ZVknOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlVHJhbnNsYXRlMmRDb21tYW5kLCBbXG4gICAgICAgICAgMCxcbiAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgXSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc2tld1gnOlxuICAgICAgICBfbXVsdGlwbHlUcmFuc2Zvcm0ocmVzdWx0LCBNYXRyaXhNYXRoLnJldXNlU2tld1hDb21tYW5kLCBbXG4gICAgICAgICAgX2NvbnZlcnRUb1JhZGlhbnModmFsdWUpLFxuICAgICAgICBdKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdza2V3WSc6XG4gICAgICAgIF9tdWx0aXBseVRyYW5zZm9ybShyZXN1bHQsIE1hdHJpeE1hdGgucmV1c2VTa2V3WUNvbW1hbmQsIFtcbiAgICAgICAgICBfY29udmVydFRvUmFkaWFucyh2YWx1ZSksXG4gICAgICAgIF0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCB0cmFuc2Zvcm0gbmFtZTogJyArIGtleSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIFBlcmZvcm1zIGEgZGVzdHJ1Y3RpdmUgb3BlcmF0aW9uIG9uIGEgdHJhbnNmb3JtIG1hdHJpeC5cbiAqL1xuZnVuY3Rpb24gX211bHRpcGx5VHJhbnNmb3JtKFxuICByZXN1bHQ6IEFycmF5PG51bWJlcj4sXG4gIG1hdHJpeE1hdGhGdW5jdGlvbjogRnVuY3Rpb24sXG4gIGFyZ3M6IEFycmF5PG51bWJlcj4sXG4pOiB2b2lkIHtcbiAgY29uc3QgbWF0cml4VG9BcHBseSA9IE1hdHJpeE1hdGguY3JlYXRlSWRlbnRpdHlNYXRyaXgoKTtcbiAgY29uc3QgYXJnc1dpdGhJZGVudGl0eSA9IFttYXRyaXhUb0FwcGx5XS5jb25jYXQoYXJncyk7XG4gIG1hdHJpeE1hdGhGdW5jdGlvbi5hcHBseSh0aGlzLCBhcmdzV2l0aElkZW50aXR5KTtcbiAgTWF0cml4TWF0aC5tdWx0aXBseUludG8ocmVzdWx0LCByZXN1bHQsIG1hdHJpeFRvQXBwbHkpO1xufVxuXG4vKipcbiAqIFBhcnNlcyBhIHN0cmluZyBsaWtlICcwLjVyYWQnIG9yICc2MGRlZycgaW50byByYWRpYW5zIGV4cHJlc3NlZCBpbiBhIGZsb2F0LlxuICogTm90ZSB0aGF0IHZhbGlkYXRpb24gb24gdGhlIHN0cmluZyBpcyBkb25lIGluIGBfdmFsaWRhdGVUcmFuc2Zvcm0oKWAuXG4gKi9cbmZ1bmN0aW9uIF9jb252ZXJ0VG9SYWRpYW5zKHZhbHVlOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCBmbG9hdFZhbHVlID0gcGFyc2VGbG9hdCh2YWx1ZSk7XG4gIHJldHVybiB2YWx1ZS5pbmRleE9mKCdyYWQnKSA+IC0xID8gZmxvYXRWYWx1ZSA6IChmbG9hdFZhbHVlICogTWF0aC5QSSkgLyAxODA7XG59XG5cbmZ1bmN0aW9uIF92YWxpZGF0ZVRyYW5zZm9ybXModHJhbnNmb3JtOiBBcnJheTxPYmplY3Q+KTogdm9pZCB7XG4gIHRyYW5zZm9ybS5mb3JFYWNoKHRyYW5zZm9ybWF0aW9uID0+IHtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModHJhbnNmb3JtYXRpb24pO1xuICAgIGludmFyaWFudChcbiAgICAgIGtleXMubGVuZ3RoID09PSAxLFxuICAgICAgJ1lvdSBtdXN0IHNwZWNpZnkgZXhhY3RseSBvbmUgcHJvcGVydHkgcGVyIHRyYW5zZm9ybSBvYmplY3QuIFBhc3NlZCBwcm9wZXJ0aWVzOiAlcycsXG4gICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICApO1xuICAgIGNvbnN0IGtleSA9IGtleXNbMF07XG4gICAgY29uc3QgdmFsdWUgPSB0cmFuc2Zvcm1hdGlvbltrZXldO1xuICAgIF92YWxpZGF0ZVRyYW5zZm9ybShrZXksIHZhbHVlLCB0cmFuc2Zvcm1hdGlvbik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBfdmFsaWRhdGVUcmFuc2Zvcm0oa2V5LCB2YWx1ZSwgdHJhbnNmb3JtYXRpb24pIHtcbiAgaW52YXJpYW50KFxuICAgICF2YWx1ZS5nZXRWYWx1ZSxcbiAgICAnWW91IHBhc3NlZCBhbiBBbmltYXRlZC5WYWx1ZSB0byBhIG5vcm1hbCBjb21wb25lbnQuICcgK1xuICAgICAgJ1lvdSBuZWVkIHRvIHdyYXAgdGhhdCBjb21wb25lbnQgaW4gYW4gQW5pbWF0ZWQuIEZvciBleGFtcGxlLCAnICtcbiAgICAgICdyZXBsYWNlIDxWaWV3IC8+IGJ5IDxBbmltYXRlZC5WaWV3IC8+LicsXG4gICk7XG5cbiAgY29uc3QgbXVsdGl2YWx1ZVRyYW5zZm9ybXMgPSBbJ21hdHJpeCcsICd0cmFuc2xhdGUnXTtcbiAgaWYgKG11bHRpdmFsdWVUcmFuc2Zvcm1zLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICBBcnJheS5pc0FycmF5KHZhbHVlKSxcbiAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgJXMgbXVzdCBoYXZlIGFuIGFycmF5IGFzIHRoZSB2YWx1ZTogJXMnLFxuICAgICAga2V5LFxuICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgKTtcbiAgfVxuICBzd2l0Y2ggKGtleSkge1xuICAgIGNhc2UgJ21hdHJpeCc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIC8qICRGbG93Rml4TWUoPj0wLjg4LjAgc2l0ZT1yZWFjdF9uYXRpdmVfZmIpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuXG4gICAgICAgICAqIGVycm9yIGZvdW5kIHdoZW4gRmxvdyB2MC44OCB3YXMgZGVwbG95ZWQuIFRvIHNlZSB0aGUgZXJyb3IsIGRlbGV0ZVxuICAgICAgICAgKiB0aGlzIGNvbW1lbnQgYW5kIHJ1biBGbG93LiAqL1xuICAgICAgICB2YWx1ZS5sZW5ndGggPT09IDkgfHwgdmFsdWUubGVuZ3RoID09PSAxNixcbiAgICAgICAgJ01hdHJpeCB0cmFuc2Zvcm0gbXVzdCBoYXZlIGEgbGVuZ3RoIG9mIDkgKDJkKSBvciAxNiAoM2QpLiAnICtcbiAgICAgICAgICAnUHJvdmlkZWQgbWF0cml4IGhhcyBhIGxlbmd0aCBvZiAlczogJXMnLFxuICAgICAgICAvKiAkRmxvd0ZpeE1lKD49MC44NC4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICAgKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODQgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGVcbiAgICAgICAgICogdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICAgICAgdmFsdWUubGVuZ3RoLFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd0cmFuc2xhdGUnOlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICAvKiAkRmxvd0ZpeE1lKD49MC44OC4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICAgKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODggd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGVcbiAgICAgICAgICogdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICAgICAgdmFsdWUubGVuZ3RoID09PSAyIHx8IHZhbHVlLmxlbmd0aCA9PT0gMyxcbiAgICAgICAgJ1RyYW5zZm9ybSB3aXRoIGtleSB0cmFuc2xhdGUgbXVzdCBiZSBhbiBhcnJheSBvZiBsZW5ndGggMiBvciAzLCBmb3VuZCAlczogJXMnLFxuICAgICAgICAvKiAkRmxvd0ZpeE1lKD49MC44NC4wIHNpdGU9cmVhY3RfbmF0aXZlX2ZiKSBUaGlzIGNvbW1lbnQgc3VwcHJlc3NlcyBhblxuICAgICAgICAgKiBlcnJvciBmb3VuZCB3aGVuIEZsb3cgdjAuODQgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yLCBkZWxldGVcbiAgICAgICAgICogdGhpcyBjb21tZW50IGFuZCBydW4gRmxvdy4gKi9cbiAgICAgICAgdmFsdWUubGVuZ3RoLFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdyb3RhdGVYJzpcbiAgICBjYXNlICdyb3RhdGVZJzpcbiAgICBjYXNlICdyb3RhdGVaJzpcbiAgICBjYXNlICdyb3RhdGUnOlxuICAgIGNhc2UgJ3NrZXdYJzpcbiAgICBjYXNlICdza2V3WSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIG11c3QgYmUgYSBzdHJpbmc6ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHZhbHVlLmluZGV4T2YoJ2RlZycpID4gLTEgfHwgdmFsdWUuaW5kZXhPZigncmFkJykgPiAtMSxcbiAgICAgICAgJ1JvdGF0ZSB0cmFuc2Zvcm0gbXVzdCBiZSBleHByZXNzZWQgaW4gZGVncmVlcyAoZGVnKSBvciByYWRpYW5zICcgK1xuICAgICAgICAgICcocmFkKTogJXMnLFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdwZXJzcGVjdGl2ZSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIG11c3QgYmUgYSBudW1iZXI6ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHZhbHVlICE9PSAwLFxuICAgICAgICAnVHJhbnNmb3JtIHdpdGgga2V5IG9mIFwiJXNcIiBjYW5ub3QgYmUgemVybzogJXMnLFxuICAgICAgICBrZXksXG4gICAgICAgIHN0cmluZ2lmeVNhZmUodHJhbnNmb3JtYXRpb24pLFxuICAgICAgKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3RyYW5zbGF0ZVgnOlxuICAgIGNhc2UgJ3RyYW5zbGF0ZVknOlxuICAgIGNhc2UgJ3NjYWxlJzpcbiAgICBjYXNlICdzY2FsZVgnOlxuICAgIGNhc2UgJ3NjYWxlWSc6XG4gICAgICBpbnZhcmlhbnQoXG4gICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicsXG4gICAgICAgICdUcmFuc2Zvcm0gd2l0aCBrZXkgb2YgXCIlc1wiIG11c3QgYmUgYSBudW1iZXI6ICVzJyxcbiAgICAgICAga2V5LFxuICAgICAgICBzdHJpbmdpZnlTYWZlKHRyYW5zZm9ybWF0aW9uKSxcbiAgICAgICk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgaW52YXJpYW50KFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgJ0ludmFsaWQgdHJhbnNmb3JtICVzOiAlcycsXG4gICAgICAgIGtleSxcbiAgICAgICAgc3RyaW5naWZ5U2FmZSh0cmFuc2Zvcm1hdGlvbiksXG4gICAgICApO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcHJvY2Vzc1RyYW5zZm9ybTtcbiJdfQ==