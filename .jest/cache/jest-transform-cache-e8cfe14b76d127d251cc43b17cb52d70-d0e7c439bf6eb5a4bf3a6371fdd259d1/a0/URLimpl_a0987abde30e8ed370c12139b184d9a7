289677c8fe3e7fd071b9844f5f3340ea
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var usm = require("./url-state-machine");

var urlencoded = require("./urlencoded");

var URLSearchParams = require("./URLSearchParams");

exports.implementation = function () {
  function URLImpl(constructorArgs) {
    (0, _classCallCheck2.default)(this, URLImpl);
    var url = constructorArgs[0];
    var base = constructorArgs[1];
    var parsedBase = null;

    if (base !== undefined) {
      parsedBase = usm.basicURLParse(base);

      if (parsedBase === null) {
        throw new TypeError("Invalid base URL");
      }
    }

    var parsedURL = usm.basicURLParse(url, {
      baseURL: parsedBase
    });

    if (parsedURL === null) {
      throw new TypeError("Invalid URL");
    }

    var query = parsedURL.query !== null ? parsedURL.query : "";
    this._url = parsedURL;
    this._query = URLSearchParams.createImpl([query], {
      doNotStripQMark: true
    });
    this._query._url = this;
  }

  (0, _createClass2.default)(URLImpl, [{
    key: "toJSON",
    value: function toJSON() {
      return this.href;
    }
  }, {
    key: "href",
    get: function get() {
      return usm.serializeURL(this._url);
    },
    set: function set(v) {
      var parsedURL = usm.basicURLParse(v);

      if (parsedURL === null) {
        throw new TypeError("Invalid URL");
      }

      this._url = parsedURL;

      this._query._list.splice(0);

      var query = parsedURL.query;

      if (query !== null) {
        this._query._list = urlencoded.parseUrlencoded(query);
      }
    }
  }, {
    key: "origin",
    get: function get() {
      return usm.serializeURLOrigin(this._url);
    }
  }, {
    key: "protocol",
    get: function get() {
      return this._url.scheme + ":";
    },
    set: function set(v) {
      usm.basicURLParse(v + ":", {
        url: this._url,
        stateOverride: "scheme start"
      });
    }
  }, {
    key: "username",
    get: function get() {
      return this._url.username;
    },
    set: function set(v) {
      if (usm.cannotHaveAUsernamePasswordPort(this._url)) {
        return;
      }

      usm.setTheUsername(this._url, v);
    }
  }, {
    key: "password",
    get: function get() {
      return this._url.password;
    },
    set: function set(v) {
      if (usm.cannotHaveAUsernamePasswordPort(this._url)) {
        return;
      }

      usm.setThePassword(this._url, v);
    }
  }, {
    key: "host",
    get: function get() {
      var url = this._url;

      if (url.host === null) {
        return "";
      }

      if (url.port === null) {
        return usm.serializeHost(url.host);
      }

      return usm.serializeHost(url.host) + ":" + usm.serializeInteger(url.port);
    },
    set: function set(v) {
      if (this._url.cannotBeABaseURL) {
        return;
      }

      usm.basicURLParse(v, {
        url: this._url,
        stateOverride: "host"
      });
    }
  }, {
    key: "hostname",
    get: function get() {
      if (this._url.host === null) {
        return "";
      }

      return usm.serializeHost(this._url.host);
    },
    set: function set(v) {
      if (this._url.cannotBeABaseURL) {
        return;
      }

      usm.basicURLParse(v, {
        url: this._url,
        stateOverride: "hostname"
      });
    }
  }, {
    key: "port",
    get: function get() {
      if (this._url.port === null) {
        return "";
      }

      return usm.serializeInteger(this._url.port);
    },
    set: function set(v) {
      if (usm.cannotHaveAUsernamePasswordPort(this._url)) {
        return;
      }

      if (v === "") {
        this._url.port = null;
      } else {
        usm.basicURLParse(v, {
          url: this._url,
          stateOverride: "port"
        });
      }
    }
  }, {
    key: "pathname",
    get: function get() {
      if (this._url.cannotBeABaseURL) {
        return this._url.path[0];
      }

      if (this._url.path.length === 0) {
        return "";
      }

      return "/" + this._url.path.join("/");
    },
    set: function set(v) {
      if (this._url.cannotBeABaseURL) {
        return;
      }

      this._url.path = [];
      usm.basicURLParse(v, {
        url: this._url,
        stateOverride: "path start"
      });
    }
  }, {
    key: "search",
    get: function get() {
      if (this._url.query === null || this._url.query === "") {
        return "";
      }

      return "?" + this._url.query;
    },
    set: function set(v) {
      var url = this._url;

      if (v === "") {
        url.query = null;
        this._query._list = [];
        return;
      }

      var input = v[0] === "?" ? v.substring(1) : v;
      url.query = "";
      usm.basicURLParse(input, {
        url: url,
        stateOverride: "query"
      });
      this._query._list = urlencoded.parseUrlencoded(input);
    }
  }, {
    key: "searchParams",
    get: function get() {
      return this._query;
    }
  }, {
    key: "hash",
    get: function get() {
      if (this._url.fragment === null || this._url.fragment === "") {
        return "";
      }

      return "#" + this._url.fragment;
    },
    set: function set(v) {
      if (v === "") {
        this._url.fragment = null;
        return;
      }

      var input = v[0] === "#" ? v.substring(1) : v;
      this._url.fragment = "";
      usm.basicURLParse(input, {
        url: this._url,
        stateOverride: "fragment"
      });
    }
  }]);
  return URLImpl;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlVSTC1pbXBsLmpzIl0sIm5hbWVzIjpbInVzbSIsInJlcXVpcmUiLCJ1cmxlbmNvZGVkIiwiVVJMU2VhcmNoUGFyYW1zIiwiZXhwb3J0cyIsImltcGxlbWVudGF0aW9uIiwiY29uc3RydWN0b3JBcmdzIiwidXJsIiwiYmFzZSIsInBhcnNlZEJhc2UiLCJ1bmRlZmluZWQiLCJiYXNpY1VSTFBhcnNlIiwiVHlwZUVycm9yIiwicGFyc2VkVVJMIiwiYmFzZVVSTCIsInF1ZXJ5IiwiX3VybCIsIl9xdWVyeSIsImNyZWF0ZUltcGwiLCJkb05vdFN0cmlwUU1hcmsiLCJocmVmIiwic2VyaWFsaXplVVJMIiwidiIsIl9saXN0Iiwic3BsaWNlIiwicGFyc2VVcmxlbmNvZGVkIiwic2VyaWFsaXplVVJMT3JpZ2luIiwic2NoZW1lIiwic3RhdGVPdmVycmlkZSIsInVzZXJuYW1lIiwiY2Fubm90SGF2ZUFVc2VybmFtZVBhc3N3b3JkUG9ydCIsInNldFRoZVVzZXJuYW1lIiwicGFzc3dvcmQiLCJzZXRUaGVQYXNzd29yZCIsImhvc3QiLCJwb3J0Iiwic2VyaWFsaXplSG9zdCIsInNlcmlhbGl6ZUludGVnZXIiLCJjYW5ub3RCZUFCYXNlVVJMIiwicGF0aCIsImxlbmd0aCIsImpvaW4iLCJpbnB1dCIsInN1YnN0cmluZyIsImZyYWdtZW50Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUFDQSxJQUFNQSxHQUFHLEdBQUdDLE9BQU8sQ0FBQyxxQkFBRCxDQUFuQjs7QUFDQSxJQUFNQyxVQUFVLEdBQUdELE9BQU8sQ0FBQyxjQUFELENBQTFCOztBQUNBLElBQU1FLGVBQWUsR0FBR0YsT0FBTyxDQUFDLG1CQUFELENBQS9COztBQUVBRyxPQUFPLENBQUNDLGNBQVI7QUFDRSxtQkFBWUMsZUFBWixFQUE2QjtBQUFBO0FBQzNCLFFBQU1DLEdBQUcsR0FBR0QsZUFBZSxDQUFDLENBQUQsQ0FBM0I7QUFDQSxRQUFNRSxJQUFJLEdBQUdGLGVBQWUsQ0FBQyxDQUFELENBQTVCO0FB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RTtBQUF0QixPQUF6QjtBQUNBLFdBQUtYLE1BQUwsQ0FBWU0sS0FBWixHQUFvQnJCLFVBQVUsQ0FBQ3VCLGVBQVgsQ0FBMkJpQixLQUEzQixDQUFwQjtBQUNEO0FBdkxIO0FBQUE7QUFBQSx3QkF5THFCO0FBQ2pCLGFBQU8sS0FBS3pCLE1BQVo7QUFDRDtBQTNMSDtBQUFBO0FBQUEsd0JBNkxhO0FBQ1QsVUFBSSxLQUFLRCxJQUFMLENBQVU0QixRQUFWLEtBQXVCLElBQXZCLElBQStCLEtBQUs1QixJQUFMLENBQVU0QixRQUFWLEtBQXVCLEVBQTFELEVBQThEO0FBQzVELGVBQU8sRUFBUDtBQUNEOztBQUVELGFBQU8sTUFBTSxLQUFLNUIsSUFBTCxDQUFVNEIsUUFBdkI7QUFDRCxLQW5NSDtBQUFBLHNCQXFNV3RCLENBck1YLEVBcU1jO0FBQ1YsVUFBSUEsQ0FBQyxLQUFLLEVBQVYsRUFBYztBQUNaLGFBQUtOLElBQUwsQ0FBVTRCLFFBQVYsR0FBcUIsSUFBckI7QUFDQTtBQUNEOztBQUVELFVBQU1GLEtBQUssR0FBR3BCLENBQUMsQ0FBQyxDQUFELENBQUQsS0FBUyxHQUFULEdBQWVBLENBQUMsQ0FBQ3FCLFNBQUYsQ0FBWSxDQUFaLENBQWYsR0FBZ0NyQixDQUE5QztBQUNBLFdBQUtOLElBQUwsQ0FBVTRCLFFBQVYsR0FBcUIsRUFBckI7QUFDQTVDLE1BQUFBLEdBQUcsQ0FBQ1csYUFBSixDQUFrQitCLEtBQWxCLEVBQXlCO0FBQUVuQyxRQUFBQSxHQUFHLEVBQUUsS0FBS1MsSUFBWjtBQUFrQlksUUFBQUEsYUFBYSxFQUFFO0FBQWpDLE9BQXpCO0FBQ0Q7QUE5TUg7QUFBQTtBQUFBIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5jb25zdCB1c20gPSByZXF1aXJlKFwiLi91cmwtc3RhdGUtbWFjaGluZVwiKTtcbmNvbnN0IHVybGVuY29kZWQgPSByZXF1aXJlKFwiLi91cmxlbmNvZGVkXCIpO1xuY29uc3QgVVJMU2VhcmNoUGFyYW1zID0gcmVxdWlyZShcIi4vVVJMU2VhcmNoUGFyYW1zXCIpO1xuXG5leHBvcnRzLmltcGxlbWVudGF0aW9uID0gY2xhc3MgVVJMSW1wbCB7XG4gIGNvbnN0cnVjdG9yKGNvbnN0cnVjdG9yQXJncykge1xuICAgIGNvbnN0IHVybCA9IGNvbnN0cnVjdG9yQXJnc1swXTtcbiAgICBjb25zdCBiYXNlID0gY29uc3RydWN0b3JBcmdzWzFdO1xuXG4gICAgbGV0IHBhcnNlZEJhc2UgPSBudWxsO1xuICAgIGlmIChiYXNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHBhcnNlZEJhc2UgPSB1c20uYmFzaWNVUkxQYXJzZShiYXNlKTtcbiAgICAgIGlmIChwYXJzZWRCYXNlID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGJhc2UgVVJMXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHBhcnNlZFVSTCA9IHVzbS5iYXNpY1VSTFBhcnNlKHVybCwgeyBiYXNlVVJMOiBwYXJzZWRCYXNlIH0pO1xuICAgIGlmIChwYXJzZWRVUkwgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIFVSTFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBxdWVyeSA9IHBhcnNlZFVSTC5xdWVyeSAhPT0gbnVsbCA/IHBhcnNlZFVSTC5xdWVyeSA6IFwiXCI7XG5cbiAgICB0aGlzLl91cmwgPSBwYXJzZWRVUkw7XG5cbiAgICAvLyBXZSBjYW5ub3QgaW52b2tlIHRoZSBcIm5ldyBVUkxTZWFyY2hQYXJhbXMgb2JqZWN0XCIgYWxnb3JpdGhtIHdpdGhvdXQgZ29pbmcgdGhyb3VnaCB0aGUgY29uc3RydWN0b3IsIHdoaWNoIHN0cmlwc1xuICAgIC8vIHF1ZXN0aW9uIG1hcmsgYnkgZGVmYXVsdC4gVGhlcmVmb3JlIHRoZSBkb05vdFN0cmlwUU1hcmsgaGFjayBpcyB1c2VkLlxuICAgIHRoaXMuX3F1ZXJ5ID0gVVJMU2VhcmNoUGFyYW1zLmNyZWF0ZUltcGwoW3F1ZXJ5XSwgeyBkb05vdFN0cmlwUU1hcms6IHRydWUgfSk7XG4gICAgdGhpcy5fcXVlcnkuX3VybCA9IHRoaXM7XG4gIH1cblxuICBnZXQgaHJlZigpIHtcbiAgICByZXR1cm4gdXNtLnNlcmlhbGl6ZVVSTCh0aGlzLl91cmwpO1xuICB9XG5cbiAgc2V0IGhyZWYodikge1xuICAgIGNvbnN0IHBhcnNlZFVSTCA9IHVzbS5iYXNpY1VSTFBhcnNlKHYpO1xuICAgIGlmIChwYXJzZWRVUkwgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIFVSTFwiKTtcbiAgICB9XG5cbiAgICB0aGlzLl91cmwgPSBwYXJzZWRVUkw7XG5cbiAgICB0aGlzLl9xdWVyeS5fbGlzdC5zcGxpY2UoMCk7XG4gICAgY29uc3QgeyBxdWVyeSB9ID0gcGFyc2VkVVJMO1xuICAgIGlmIChxdWVyeSAhPT0gbnVsbCkge1xuICAgICAgdGhpcy5fcXVlcnkuX2xpc3QgPSB1cmxlbmNvZGVkLnBhcnNlVXJsZW5jb2RlZChxdWVyeSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IG9yaWdpbigpIHtcbiAgICByZXR1cm4gdXNtLnNlcmlhbGl6ZVVSTE9yaWdpbih0aGlzLl91cmwpO1xuICB9XG5cbiAgZ2V0IHByb3RvY29sKCkge1xuICAgIHJldHVybiB0aGlzLl91cmwuc2NoZW1lICsgXCI6XCI7XG4gIH1cblxuICBzZXQgcHJvdG9jb2wodikge1xuICAgIHVzbS5iYXNpY1VSTFBhcnNlKHYgKyBcIjpcIiwgeyB1cmw6IHRoaXMuX3VybCwgc3RhdGVPdmVycmlkZTogXCJzY2hlbWUgc3RhcnRcIiB9KTtcbiAgfVxuXG4gIGdldCB1c2VybmFtZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdXJsLnVzZXJuYW1lO1xuICB9XG5cbiAgc2V0IHVzZXJuYW1lKHYpIHtcbiAgICBpZiAodXNtLmNhbm5vdEhhdmVBVXNlcm5hbWVQYXNzd29yZFBvcnQodGhpcy5fdXJsKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHVzbS5zZXRUaGVVc2VybmFtZSh0aGlzLl91cmwsIHYpO1xuICB9XG5cbiAgZ2V0IHBhc3N3b3JkKCkge1xuICAgIHJldHVybiB0aGlzLl91cmwucGFzc3dvcmQ7XG4gIH1cblxuICBzZXQgcGFzc3dvcmQodikge1xuICAgIGlmICh1c20uY2Fubm90SGF2ZUFVc2VybmFtZVBhc3N3b3JkUG9ydCh0aGlzLl91cmwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdXNtLnNldFRoZVBhc3N3b3JkKHRoaXMuX3VybCwgdik7XG4gIH1cblxuICBnZXQgaG9zdCgpIHtcbiAgICBjb25zdCB1cmwgPSB0aGlzLl91cmw7XG5cbiAgICBpZiAodXJsLmhvc3QgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGlmICh1cmwucG9ydCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHVzbS5zZXJpYWxpemVIb3N0KHVybC5ob3N0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdXNtLnNlcmlhbGl6ZUhvc3QodXJsLmhvc3QpICsgXCI6XCIgKyB1c20uc2VyaWFsaXplSW50ZWdlcih1cmwucG9ydCk7XG4gIH1cblxuICBzZXQgaG9zdCh2KSB7XG4gICAgaWYgKHRoaXMuX3VybC5jYW5ub3RCZUFCYXNlVVJMKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdXNtLmJhc2ljVVJMUGFyc2UodiwgeyB1cmw6IHRoaXMuX3VybCwgc3RhdGVPdmVycmlkZTogXCJob3N0XCIgfSk7XG4gIH1cblxuICBnZXQgaG9zdG5hbWUoKSB7XG4gICAgaWYgKHRoaXMuX3VybC5ob3N0ID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdXNtLnNlcmlhbGl6ZUhvc3QodGhpcy5fdXJsLmhvc3QpO1xuICB9XG5cbiAgc2V0IGhvc3RuYW1lKHYpIHtcbiAgICBpZiAodGhpcy5fdXJsLmNhbm5vdEJlQUJhc2VVUkwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB1c20uYmFzaWNVUkxQYXJzZSh2LCB7IHVybDogdGhpcy5fdXJsLCBzdGF0ZU92ZXJyaWRlOiBcImhvc3RuYW1lXCIgfSk7XG4gIH1cblxuICBnZXQgcG9ydCgpIHtcbiAgICBpZiAodGhpcy5fdXJsLnBvcnQgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIHJldHVybiB1c20uc2VyaWFsaXplSW50ZWdlcih0aGlzLl91cmwucG9ydCk7XG4gIH1cblxuICBzZXQgcG9ydCh2KSB7XG4gICAgaWYgKHVzbS5jYW5ub3RIYXZlQVVzZXJuYW1lUGFzc3dvcmRQb3J0KHRoaXMuX3VybCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodiA9PT0gXCJcIikge1xuICAgICAgdGhpcy5fdXJsLnBvcnQgPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICB1c20uYmFzaWNVUkxQYXJzZSh2LCB7IHVybDogdGhpcy5fdXJsLCBzdGF0ZU92ZXJyaWRlOiBcInBvcnRcIiB9KTtcbiAgICB9XG4gIH1cblxuICBnZXQgcGF0aG5hbWUoKSB7XG4gICAgaWYgKHRoaXMuX3VybC5jYW5ub3RCZUFCYXNlVVJMKSB7XG4gICAgICByZXR1cm4gdGhpcy5fdXJsLnBhdGhbMF07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX3VybC5wYXRoLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiL1wiICsgdGhpcy5fdXJsLnBhdGguam9pbihcIi9cIik7XG4gIH1cblxuICBzZXQgcGF0aG5hbWUodikge1xuICAgIGlmICh0aGlzLl91cmwuY2Fubm90QmVBQmFzZVVSTCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX3VybC5wYXRoID0gW107XG4gICAgdXNtLmJhc2ljVVJMUGFyc2UodiwgeyB1cmw6IHRoaXMuX3VybCwgc3RhdGVPdmVycmlkZTogXCJwYXRoIHN0YXJ0XCIgfSk7XG4gIH1cblxuICBnZXQgc2VhcmNoKCkge1xuICAgIGlmICh0aGlzLl91cmwucXVlcnkgPT09IG51bGwgfHwgdGhpcy5fdXJsLnF1ZXJ5ID09PSBcIlwiKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gXCI/XCIgKyB0aGlzLl91cmwucXVlcnk7XG4gIH1cblxuICBzZXQgc2VhcmNoKHYpIHtcbiAgICBjb25zdCB1cmwgPSB0aGlzLl91cmw7XG5cbiAgICBpZiAodiA9PT0gXCJcIikge1xuICAgICAgdXJsLnF1ZXJ5ID0gbnVsbDtcbiAgICAgIHRoaXMuX3F1ZXJ5Ll9saXN0ID0gW107XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgaW5wdXQgPSB2WzBdID09PSBcIj9cIiA/IHYuc3Vic3RyaW5nKDEpIDogdjtcbiAgICB1cmwucXVlcnkgPSBcIlwiO1xuICAgIHVzbS5iYXNpY1VSTFBhcnNlKGlucHV0LCB7IHVybCwgc3RhdGVPdmVycmlkZTogXCJxdWVyeVwiIH0pO1xuICAgIHRoaXMuX3F1ZXJ5Ll9saXN0ID0gdXJsZW5jb2RlZC5wYXJzZVVybGVuY29kZWQoaW5wdXQpO1xuICB9XG5cbiAgZ2V0IHNlYXJjaFBhcmFtcygpIHtcbiAgICByZXR1cm4gdGhpcy5fcXVlcnk7XG4gIH1cblxuICBnZXQgaGFzaCgpIHtcbiAgICBpZiAodGhpcy5fdXJsLmZyYWdtZW50ID09PSBudWxsIHx8IHRoaXMuX3VybC5mcmFnbWVudCA9PT0gXCJcIikge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiI1wiICsgdGhpcy5fdXJsLmZyYWdtZW50O1xuICB9XG5cbiAgc2V0IGhhc2godikge1xuICAgIGlmICh2ID09PSBcIlwiKSB7XG4gICAgICB0aGlzLl91cmwuZnJhZ21lbnQgPSBudWxsO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGlucHV0ID0gdlswXSA9PT0gXCIjXCIgPyB2LnN1YnN0cmluZygxKSA6IHY7XG4gICAgdGhpcy5fdXJsLmZyYWdtZW50ID0gXCJcIjtcbiAgICB1c20uYmFzaWNVUkxQYXJzZShpbnB1dCwgeyB1cmw6IHRoaXMuX3VybCwgc3RhdGVPdmVycmlkZTogXCJmcmFnbWVudFwiIH0pO1xuICB9XG5cbiAgdG9KU09OKCkge1xuICAgIHJldHVybiB0aGlzLmhyZWY7XG4gIH1cbn07XG4iXX0=