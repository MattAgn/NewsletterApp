6cf42ac0632f99136d01574dc5cac99d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _require = require('./request-utils'),
    normalizeUrl = _require.normalizeUrl;

var FetchMock = {};

var _require2 = require('./compile-route'),
    sanitizeRoute = _require2.sanitizeRoute;

var generateMatcher = require('./generate-matcher');

var isName = function isName(nameOrMatcher) {
  return typeof nameOrMatcher === 'string' && /^[\da-zA-Z\-]+$/.test(nameOrMatcher);
};

var filterCallsWithMatcher = function filterCallsWithMatcher(matcher) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  var calls = arguments.length > 2 ? arguments[2] : undefined;
  matcher = generateMatcher(sanitizeRoute((0, _extends2.default)({
    matcher: matcher
  }, options)));
  return calls.filter(function (_ref) {
    var _ref2 = (0, _slicedToArray2.default)(_ref, 2),
        url = _ref2[0],
        options = _ref2[1];

    return matcher(normalizeUrl(url), options);
  });
};

FetchMock.filterCalls = function (nameOrMatcher, options) {
  var calls = this._calls;
  var matcher = '*';

  if (nameOrMatcher === true) {
    calls = calls.filter(function (_ref3) {
      var isUnmatched = _ref3.isUnmatched;
      return !isUnmatched;
    });
  } else if (nameOrMatcher === false) {
    calls = calls.filter(function (_ref4) {
      var isUnmatched = _ref4.isUnmatched;
      return isUnmatched;
    });
  } else if (typeof nameOrMatcher === 'undefined') {
    calls = calls;
  } else if (isName(nameOrMatcher)) {
    calls = calls.filter(function (_ref5) {
      var identifier = _ref5.identifier;
      return identifier === nameOrMatcher;
    });
  } else {
    matcher = normalizeUrl(nameOrMatcher);

    if (this.routes.some(function (_ref6) {
      var identifier = _ref6.identifier;
      return identifier === matcher;
    })) {
      calls = calls.filter(function (call) {
        return call.identifier === matcher;
      });
    }
  }

  if ((options || matcher !== '*') && calls.length) {
    if (typeof options === 'string') {
      options = {
        method: options
      };
    }

    calls = filterCallsWithMatcher(matcher, options, calls);
  }

  return calls;
};

FetchMock.calls = function (nameOrMatcher, options) {
  return this.filterCalls(nameOrMatcher, options);
};

FetchMock.lastCall = function (nameOrMatcher, options) {
  return (0, _toConsumableArray2.default)(this.filterCalls(nameOrMatcher, options)).pop();
};

FetchMock.lastUrl = function (nameOrMatcher, options) {
  return (this.lastCall(nameOrMatcher, options) || [])[0];
};

FetchMock.lastOptions = function (nameOrMatcher, options) {
  return (this.lastCall(nameOrMatcher, options) || [])[1];
};

FetchMock.called = function (nameOrMatcher, options) {
  return !!this.filterCalls(nameOrMatcher, options).length;
};

FetchMock.flush = function (waitForResponseMethods) {
  var _this = this;

  var queuedPromises = this._holdingPromises;
  this._holdingPromises = [];
  return Promise.all(queuedPromises).then(function () {
    if (waitForResponseMethods && _this._holdingPromises.length) {
      return _this.flush(waitForResponseMethods);
    }
  });
};

FetchMock.done = function (nameOrMatcher) {
  var _this2 = this;

  var routesToCheck = nameOrMatcher && typeof nameOrMatcher !== 'boolean' ? [{
    identifier: nameOrMatcher
  }] : this.routes;
  return routesToCheck.map(function (_ref7) {
    var identifier = _ref7.identifier;

    if (!_this2.called(identifier)) {
      console.warn("Warning: " + identifier + " not called");
      return false;
    }

    var expectedTimes = (_this2.routes.find(function (r) {
      return r.identifier === identifier;
    }) || {}).repeat;

    if (!expectedTimes) {
      return true;
    }

    var actualTimes = _this2.filterCalls(identifier).length;

    if (expectedTimes > actualTimes) {
      console.warn("Warning: " + identifier + " only called " + actualTimes + " times, but " + expectedTimes + " expected");
      return false;
    } else {
      return true;
    }
  }).every(function (isDone) {
    return isDone;
  });
};

module.exports = FetchMock;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluc3BlY3RpbmcuanMiXSwibmFtZXMiOlsicmVxdWlyZSIsIm5vcm1hbGl6ZVVybCIsIkZldGNoTW9jayIsInNhbml0aXplUm91dGUiLCJnZW5lcmF0ZU1hdGNoZXIiLCJpc05hbWUiLCJuYW1lT3JNYXRjaGVyIiwidGVzdCIsImZpbHRlckNhbGxzV2l0aE1hdGNoZXIiLCJtYXRjaGVyIiwib3B0aW9ucyIsImNhbGxzIiwiZmlsdGVyIiwidXJsIiwiZmlsdGVyQ2FsbHMiLCJfY2FsbHMiLCJpc1VubWF0Y2hlZCIsImlkZW50aWZpZXIiLCJyb3V0ZXMiLCJzb21lIiwiY2FsbCIsImxlbmd0aCIsIm1ldGhvZCIsImxhc3RDYWxsIiwicG9wIiwibGFzdFVybCIsImxhc3RPcHRpb25zIiwiY2FsbGVkIiwiZmx1c2giLCJ3YWl0Rm9yUmVzcG9uc2VNZXRob2RzIiwicXVldWVkUHJvbWlzZXMiLCJfaG9sZGluZ1Byb21pc2VzIiwiUHJvbWlzZSIsImFsbCIsInRoZW4iLCJkb25lIiwicm91dGVzVG9DaGVjayIsIm1hcCIsImNvbnNvbGUiLCJ3YXJuIiwiZXhwZWN0ZWRUaW1lcyIsImZpbmQiLCJyIiwicmVwZWF0IiwiYWN0dWFsVGltZXMiLCJldmVyeSIsImlzRG9uZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2VBQXlCQSxPQUFPLENBQUMsaUJBQUQsQztJQUF4QkMsWSxZQUFBQSxZOztBQUNSLElBQU1DLFNBQVMsR0FBRyxFQUFsQjs7Z0JBQzBCRixPQUFPLENBQUMsaUJBQUQsQztJQUF6QkcsYSxhQUFBQSxhOztBQUNSLElBQU1DLGVBQWUsR0FBR0osT0FBTyxDQUFDLG9CQUFELENBQS9COztBQUNBLElBQU1LLE1BQU0sR0FBRyxTQUFUQSxNQUFTLENBQUFDLGFBQWE7QUFBQSxTQUMzQixPQUFPQSxhQUFQLEtBQXlCLFFBQXpCLElBQXFDLGtCQUFrQkMsSUFBbEIsQ0FBdUJELGFBQXZCLENBRFY7QUFBQSxDQUE1Qjs7QUFHQSxJ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cmVxdWVzdC11dGlscycpO1xuY29uc3QgRmV0Y2hNb2NrID0ge307XG5jb25zdCB7IHNhbml0aXplUm91dGUgfSA9IHJlcXVpcmUoJy4vY29tcGlsZS1yb3V0ZScpO1xuY29uc3QgZ2VuZXJhdGVNYXRjaGVyID0gcmVxdWlyZSgnLi9nZW5lcmF0ZS1tYXRjaGVyJyk7XG5jb25zdCBpc05hbWUgPSBuYW1lT3JNYXRjaGVyID0+XG5cdHR5cGVvZiBuYW1lT3JNYXRjaGVyID09PSAnc3RyaW5nJyAmJiAvXltcXGRhLXpBLVpcXC1dKyQvLnRlc3QobmFtZU9yTWF0Y2hlcik7XG5cbmNvbnN0IGZpbHRlckNhbGxzV2l0aE1hdGNoZXIgPSAobWF0Y2hlciwgb3B0aW9ucyA9IHt9LCBjYWxscykgPT4ge1xuXHRtYXRjaGVyID0gZ2VuZXJhdGVNYXRjaGVyKHNhbml0aXplUm91dGUoT2JqZWN0LmFzc2lnbih7IG1hdGNoZXIgfSwgb3B0aW9ucykpKTtcblx0cmV0dXJuIGNhbGxzLmZpbHRlcigoW3VybCwgb3B0aW9uc10pID0+IG1hdGNoZXIobm9ybWFsaXplVXJsKHVybCksIG9wdGlvbnMpKTtcbn07XG5cbkZldGNoTW9jay5maWx0ZXJDYWxscyA9IGZ1bmN0aW9uKG5hbWVPck1hdGNoZXIsIG9wdGlvbnMpIHtcblx0bGV0IGNhbGxzID0gdGhpcy5fY2FsbHM7XG5cdGxldCBtYXRjaGVyID0gJyonO1xuXG5cdGlmIChuYW1lT3JNYXRjaGVyID09PSB0cnVlKSB7XG5cdFx0Y2FsbHMgPSBjYWxscy5maWx0ZXIoKHsgaXNVbm1hdGNoZWQgfSkgPT4gIWlzVW5tYXRjaGVkKTtcblx0fSBlbHNlIGlmIChuYW1lT3JNYXRjaGVyID09PSBmYWxzZSkge1xuXHRcdGNhbGxzID0gY2FsbHMuZmlsdGVyKCh7IGlzVW5tYXRjaGVkIH0pID0+IGlzVW5tYXRjaGVkKTtcblx0fSBlbHNlIGlmICh0eXBlb2YgbmFtZU9yTWF0Y2hlciA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRjYWxscyA9IGNhbGxzO1xuXHR9IGVsc2UgaWYgKGlzTmFtZShuYW1lT3JNYXRjaGVyKSkge1xuXHRcdGNhbGxzID0gY2FsbHMuZmlsdGVyKCh7IGlkZW50aWZpZXIgfSkgPT4gaWRlbnRpZmllciA9PT0gbmFtZU9yTWF0Y2hlcik7XG5cdH0gZWxzZSB7XG5cdFx0bWF0Y2hlciA9IG5vcm1hbGl6ZVVybChuYW1lT3JNYXRjaGVyKTtcblx0XHRpZiAodGhpcy5yb3V0ZXMuc29tZSgoeyBpZGVudGlmaWVyIH0pID0+IGlkZW50aWZpZXIgPT09IG1hdGNoZXIpKSB7XG5cdFx0XHRjYWxscyA9IGNhbGxzLmZpbHRlcihjYWxsID0+IGNhbGwuaWRlbnRpZmllciA9PT0gbWF0Y2hlcik7XG5cdFx0fVxuXHR9XG5cblx0aWYgKChvcHRpb25zIHx8IG1hdGNoZXIgIT09ICcqJykgJiYgY2FsbHMubGVuZ3RoKSB7XG5cdFx0aWYgKHR5cGVvZiBvcHRpb25zID09PSAnc3RyaW5nJykge1xuXHRcdFx0b3B0aW9ucyA9IHsgbWV0aG9kOiBvcHRpb25zIH07XG5cdFx0fVxuXHRcdGNhbGxzID0gZmlsdGVyQ2FsbHNXaXRoTWF0Y2hlcihtYXRjaGVyLCBvcHRpb25zLCBjYWxscyk7XG5cdH1cblx0cmV0dXJuIGNhbGxzO1xufTtcblxuRmV0Y2hNb2NrLmNhbGxzID0gZnVuY3Rpb24obmFtZU9yTWF0Y2hlciwgb3B0aW9ucykge1xuXHRyZXR1cm4gdGhpcy5maWx0ZXJDYWxscyhuYW1lT3JNYXRjaGVyLCBvcHRpb25zKTtcbn07XG5cbkZldGNoTW9jay5sYXN0Q2FsbCA9IGZ1bmN0aW9uKG5hbWVPck1hdGNoZXIsIG9wdGlvbnMpIHtcblx0cmV0dXJuIFsuLi50aGlzLmZpbHRlckNhbGxzKG5hbWVPck1hdGNoZXIsIG9wdGlvbnMpXS5wb3AoKTtcbn07XG5cbkZldGNoTW9jay5sYXN0VXJsID0gZnVuY3Rpb24obmFtZU9yTWF0Y2hlciwgb3B0aW9ucykge1xuXHRyZXR1cm4gKHRoaXMubGFzdENhbGwobmFtZU9yTWF0Y2hlciwgb3B0aW9ucykgfHwgW10pWzBdO1xufTtcblxuRmV0Y2hNb2NrLmxhc3RPcHRpb25zID0gZnVuY3Rpb24obmFtZU9yTWF0Y2hlciwgb3B0aW9ucykge1xuXHRyZXR1cm4gKHRoaXMubGFzdENhbGwobmFtZU9yTWF0Y2hlciwgb3B0aW9ucykgfHwgW10pWzFdO1xufTtcblxuRmV0Y2hNb2NrLmNhbGxlZCA9IGZ1bmN0aW9uKG5hbWVPck1hdGNoZXIsIG9wdGlvbnMpIHtcblx0cmV0dXJuICEhdGhpcy5maWx0ZXJDYWxscyhuYW1lT3JNYXRjaGVyLCBvcHRpb25zKS5sZW5ndGg7XG59O1xuXG5GZXRjaE1vY2suZmx1c2ggPSBmdW5jdGlvbih3YWl0Rm9yUmVzcG9uc2VNZXRob2RzKSB7XG5cdGNvbnN0IHF1ZXVlZFByb21pc2VzID0gdGhpcy5faG9sZGluZ1Byb21pc2VzO1xuXHR0aGlzLl9ob2xkaW5nUHJvbWlzZXMgPSBbXTtcblxuXHRyZXR1cm4gUHJvbWlzZS5hbGwocXVldWVkUHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xuXHRcdGlmICh3YWl0Rm9yUmVzcG9uc2VNZXRob2RzICYmIHRoaXMuX2hvbGRpbmdQcm9taXNlcy5sZW5ndGgpIHtcblx0XHRcdHJldHVybiB0aGlzLmZsdXNoKHdhaXRGb3JSZXNwb25zZU1ldGhvZHMpO1xuXHRcdH1cblx0fSk7XG59O1xuXG5GZXRjaE1vY2suZG9uZSA9IGZ1bmN0aW9uKG5hbWVPck1hdGNoZXIpIHtcblx0Y29uc3Qgcm91dGVzVG9DaGVjayA9XG5cdFx0bmFtZU9yTWF0Y2hlciAmJiB0eXBlb2YgbmFtZU9yTWF0Y2hlciAhPT0gJ2Jvb2xlYW4nXG5cdFx0XHQ/IFt7IGlkZW50aWZpZXI6IG5hbWVPck1hdGNoZXIgfV1cblx0XHRcdDogdGhpcy5yb3V0ZXM7XG5cblx0Ly8gQ2FuJ3QgdXNlIGFycmF5LmV2ZXJ5IGJlY2F1c2Ugd291bGQgZXhpdCBhZnRlciBmaXJzdCBmYWlsdXJlLCB3aGljaCB3b3VsZFxuXHQvLyBicmVhayB0aGUgbG9nZ2luZ1xuXHRyZXR1cm4gcm91dGVzVG9DaGVja1xuXHRcdC5tYXAoKHsgaWRlbnRpZmllciB9KSA9PiB7XG5cdFx0XHRpZiAoIXRoaXMuY2FsbGVkKGlkZW50aWZpZXIpKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybihgV2FybmluZzogJHtpZGVudGlmaWVyfSBub3QgY2FsbGVkYCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBleHBlY3RlZFRpbWVzID0gKFxuXHRcdFx0XHR0aGlzLnJvdXRlcy5maW5kKHIgPT4gci5pZGVudGlmaWVyID09PSBpZGVudGlmaWVyKSB8fCB7fVxuXHRcdFx0KS5yZXBlYXQ7XG5cblx0XHRcdGlmICghZXhwZWN0ZWRUaW1lcykge1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHRcdGNvbnN0IGFjdHVhbFRpbWVzID0gdGhpcy5maWx0ZXJDYWxscyhpZGVudGlmaWVyKS5sZW5ndGg7XG5cdFx0XHRpZiAoZXhwZWN0ZWRUaW1lcyA+IGFjdHVhbFRpbWVzKSB7XG5cdFx0XHRcdGNvbnNvbGUud2Fybihcblx0XHRcdFx0XHRgV2FybmluZzogJHtpZGVudGlmaWVyfSBvbmx5IGNhbGxlZCAke2FjdHVhbFRpbWVzfSB0aW1lcywgYnV0ICR7ZXhwZWN0ZWRUaW1lc30gZXhwZWN0ZWRgXG5cdFx0XHRcdCk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmVcblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cdFx0fSlcblx0XHQuZXZlcnkoaXNEb25lID0+IGlzRG9uZSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZldGNoTW9jaztcbiJdfQ==