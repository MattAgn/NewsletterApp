{"version":3,"sources":["index.js"],"names":["styles","StyleSheet","create","container","flex","Provider","store","props","children","Component","childContextTypes","PropTypes","shape","subscribe","func","isRequired","dispatch","getState","AppRegistry","setWrapperComponentProvider","RootSiblingsWrapper","uuid","triggers","RootSiblings","_updatedSiblings","_siblings","_stores","_update","id","element","callback","siblings","stores","forceUpdate","push","splice","indexOf","elements","Object","keys","forEach","key","sibling","RootSiblingManager","update","trigger","destroy"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { StyleSheet, View, AppRegistry } from 'react-native';\nimport StaticContainer from 'static-container';\nimport PropTypes from 'prop-types';\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1\n  }\n});\n\nclass Provider extends Component {\n  static childContextTypes = {\n    store: PropTypes.shape({\n      subscribe: PropTypes.func.isRequired,\n      dispatch: PropTypes.func.isRequired,\n      getState: PropTypes.func.isRequired,\n    }),\n  };\n\n  getChildContext() {\n    return { store: this.props.store };\n  }\n\n  render() {\n    return this.props.children;\n  }\n}\n\nAppRegistry.setWrapperComponentProvider(function() {\n  return function RootSiblingsWrapper(props) {\n    return (\n      <View style={styles.container}>\n        {props.children}\n        <RootSiblings />\n      </View>\n    );\n  };\n});\n\nlet uuid = 0;\nconst triggers = [];\nclass RootSiblings extends Component {\n  _updatedSiblings = {};\n  _siblings = {};\n  _stores = {};\n\n  constructor(props) {\n    super(props);\n    this._siblings = {};\n    triggers.push(this._update);\n  }\n\n  componentWillUnmount() {\n    triggers.splice(triggers.indexOf(this._update), 1);\n  }\n\n  _update = (id, element, callback, store) => {\n    const siblings = { ...this._siblings };\n    const stores = { ...this._stores };\n    if (siblings[id] && !element) {\n      delete siblings[id];\n      delete stores[id];\n    } else if (element) {\n      siblings[id] = element;\n      stores[id] = store;\n    }\n    this._updatedSiblings[id] = true;\n    this._siblings = siblings;\n    this._stores = stores;\n    this.forceUpdate(callback);\n  };\n\n  render() {\n    const siblings = this._siblings;\n    const stores = this._stores;\n    const elements = [];\n    Object.keys(siblings).forEach(key => {\n      const element = siblings[key];\n      if (element) {\n        const sibling = (\n          <StaticContainer key={`root-sibling-${key}`} shouldUpdate={!!this._updatedSiblings[key]}>\n            {element}\n          </StaticContainer>\n        );\n\n        const store = stores[key];\n        if (store) {\n          elements.push(\n            <Provider store={store} key={`root-sibling-${key}-provider`}>\n              {sibling}\n            </Provider>\n          );\n        } else {\n          elements.push(sibling);\n        }\n      }\n    });\n    this._updatedSiblings = {};\n    return elements;\n  }\n}\n\nexport default class RootSiblingManager {\n  constructor(element, callback, store) {\n    const id = uuid++;\n    function update(element, callback, store) {\n      triggers.forEach(function(trigger) {\n        trigger(id, element, callback, store);\n      });\n    }\n\n    function destroy(callback) {\n      triggers.forEach(function(trigger) {\n        trigger(id, null, callback);\n      });\n    }\n\n    update(element, callback, store);\n    this.update = update;\n    this.destroy = destroy;\n  }\n}\n"]}