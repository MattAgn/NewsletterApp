a8f33d0670f8c27770a13560ade10c73
'use strict';

var NEWTON_ITERATIONS = 4;
var NEWTON_MIN_SLOPE = 0.001;
var SUBDIVISION_PRECISION = 0.0000001;
var SUBDIVISION_MAX_ITERATIONS = 10;
var kSplineTableSize = 11;
var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);
var float32ArraySupported = typeof Float32Array === 'function';

function A(aA1, aA2) {
  return 1.0 - 3.0 * aA2 + 3.0 * aA1;
}

function B(aA1, aA2) {
  return 3.0 * aA2 - 6.0 * aA1;
}

function C(aA1) {
  return 3.0 * aA1;
}

function calcBezier(aT, aA1, aA2) {
  return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT;
}

function getSlope(aT, aA1, aA2) {
  return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1);
}

function binarySubdivide(aX, _aA, _aB, mX1, mX2) {
  var currentX,
      currentT,
      i = 0,
      aA = _aA,
      aB = _aB;

  do {
    currentT = aA + (aB - aA) / 2.0;
    currentX = calcBezier(currentT, mX1, mX2) - aX;

    if (currentX > 0.0) {
      aB = currentT;
    } else {
      aA = currentT;
    }
  } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);

  return currentT;
}

function newtonRaphsonIterate(aX, _aGuessT, mX1, mX2) {
  var aGuessT = _aGuessT;

  for (var i = 0; i < NEWTON_ITERATIONS; ++i) {
    var currentSlope = getSlope(aGuessT, mX1, mX2);

    if (currentSlope === 0.0) {
      return aGuessT;
    }

    var currentX = calcBezier(aGuessT, mX1, mX2) - aX;
    aGuessT -= currentX / currentSlope;
  }

  return aGuessT;
}

module.exports = function bezier(mX1, mY1, mX2, mY2) {
  if (!(mX1 >= 0 && mX1 <= 1 && mX2 >= 0 && mX2 <= 1)) {
    throw new Error('bezier x values must be in [0, 1] range');
  }

  var sampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);

  if (mX1 !== mY1 || mX2 !== mY2) {
    for (var i = 0; i < kSplineTableSize; ++i) {
      sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);
    }
  }

  function getTForX(aX) {
    var intervalStart = 0.0;
    var currentSample = 1;
    var lastSample = kSplineTableSize - 1;

    for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {
      intervalStart += kSampleStepSize;
    }

    --currentSample;
    var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);
    var guessForT = intervalStart + dist * kSampleStepSize;
    var initialSlope = getSlope(guessForT, mX1, mX2);

    if (initialSlope >= NEWTON_MIN_SLOPE) {
      return newtonRaphsonIterate(aX, guessForT, mX1, mX2);
    } else if (initialSlope === 0.0) {
      return guessForT;
    } else {
      return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);
    }
  }

  return function BezierEasing(x) {
    if (mX1 === mY1 && mX2 === mY2) {
      return x;
    }

    if (x === 0) {
      return 0;
    }

    if (x === 1) {
      return 1;
    }

    return calcBezier(getTForX(x), mY1, mY2);
  };
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJlemllci5qcyJdLCJuYW1lcyI6WyJORVdUT05fSVRFUkFUSU9OUyIsIk5FV1RPTl9NSU5fU0xPUEUiLCJTVUJESVZJU0lPTl9QUkVDSVNJT04iLCJTVUJESVZJU0lPTl9NQVhfSVRFUkFUSU9OUyIsImtTcGxpbmVUYWJsZVNpemUiLCJrU2FtcGxlU3RlcFNpemUiLCJmbG9hdDMyQXJyYXlTdXBwb3J0ZWQiLCJGbG9hdDMyQXJyYXkiLCJBIiwiYUExIiwiYUEyIiwiQiIsIkMiLCJjYWxjQmV6aWVyIiwiYVQiLCJnZXRTbG9wZSIsImJpbmFyeVN1YmRpdmlkZSIsImFYIiwiX2FBIiwiX2FCIiwibVgxIiwibVgyIiwiY3VycmVudFgiLCJjdXJyZW50VCIsImkiLCJhQSIsImFCIiwiTWF0aCIsImFicyIsIm5ld3RvblJhcGhzb25JdGVyYXRlIiwiX2FHdWVzc1QiLCJhR3Vlc3NUIiwiY3VycmVudFNsb3BlIiwibW9kdWxlIiwiZXhwb3J0cyIsImJlemllciIsIm1ZMSIsIm1ZMiIsIkVycm9yIiwic2FtcGxlVmFsdWVzIiwiQXJyYXkiLCJnZXRURm9yWCIsImludGVydmFsU3RhcnQiLCJjdXJyZW50U2FtcGxlIiwibGFzdFNhbXBsZSIsImRpc3QiLCJndWVzc0ZvclQiLCJpbml0aWFsU2xvcGUiLCJCZXppZXJFYXNpbmciLCJ4Il0sIm1hcHBpbmdzIjoiQUFjQTs7QUFHQSxJQUFNQSxpQkFBaUIsR0FBRyxDQUExQjtBQUNBLElBQU1DLGdCQUFnQixHQUFHLEtBQXpCO0FBQ0EsSUFBTUMscUJBQXFCLEdBQUcsU0FBOUI7QUFDQSxJQUFNQywwQkFBMEIsR0FBRyxFQUFuQztBQUVBLElBQU1DLGdCQUFnQixHQUFHLEVBQXpCO0FBQ0EsSUFBTUMsZUFBZSxHQUFHLE9BQU9ELGdCQUFnQixHQUFHLEdBQTFCLENBQXhCO0FBRUEsSUFBTUUscUJBQXFCLEdBQUcsT0FBT0MsWUFBUCxLQUF3QixVQUF0RDs7QUFFQSxTQUFTQyxDQUFULENBQVdDLEdBQVgsRUFBZ0JDLEdB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QVksQ0FBQ0ksYUFBRCxDQUQvQyxDQURGO0FBR0EsUUFBTUcsU0FBUyxHQUFHSixhQUFhLEdBQUdHLElBQUksR0FBR3hDLGVBQXpDO0FBRUEsUUFBTTBDLFlBQVksR0FBR2hDLFFBQVEsQ0FBQytCLFNBQUQsRUFBWTFCLEdBQVosRUFBaUJDLEdBQWpCLENBQTdCOztBQUNBLFFBQUkwQixZQUFZLElBQUk5QyxnQkFBcEIsRUFBc0M7QUFDcEMsYUFBTzRCLG9CQUFvQixDQUFDWixFQUFELEVBQUs2QixTQUFMLEVBQWdCMUIsR0FBaEIsRUFBcUJDLEdBQXJCLENBQTNCO0FBQ0QsS0FGRCxNQUVPLElBQUkwQixZQUFZLEtBQUssR0FBckIsRUFBMEI7QUFDL0IsYUFBT0QsU0FBUDtBQUNELEtBRk0sTUFFQTtBQUNMLGFBQU85QixlQUFlLENBQ3BCQyxFQURvQixFQUVwQnlCLGFBRm9CLEVBR3BCQSxhQUFhLEdBQUdyQyxlQUhJLEVBSXBCZSxHQUpvQixFQUtwQkMsR0FMb0IsQ0FBdEI7QUFPRDtBQUNGOztBQUVELFNBQU8sU0FBUzJCLFlBQVQsQ0FBc0JDLENBQXRCLEVBQXlDO0FBQzlDLFFBQUk3QixHQUFHLEtBQUtnQixHQUFSLElBQWVmLEdBQUcsS0FBS2dCLEdBQTNCLEVBQWdDO0FBQzlCLGFBQU9ZLENBQVA7QUFDRDs7QUFFRCxRQUFJQSxDQUFDLEtBQUssQ0FBVixFQUFhO0FBQ1gsYUFBTyxDQUFQO0FBQ0Q7O0FBQ0QsUUFBSUEsQ0FBQyxLQUFLLENBQVYsRUFBYTtBQUNYLGFBQU8sQ0FBUDtBQUNEOztBQUNELFdBQU9wQyxVQUFVLENBQUM0QixRQUFRLENBQUNRLENBQUQsQ0FBVCxFQUFjYixHQUFkLEVBQW1CQyxHQUFuQixDQUFqQjtBQUNELEdBWkQ7QUFhRCxDQXJFRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQmV6aWVyRWFzaW5nIC0gdXNlIGJlemllciBjdXJ2ZSBmb3IgdHJhbnNpdGlvbiBlYXNpbmcgZnVuY3Rpb25cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ncmUvYmV6aWVyLWVhc2luZ1xuICpcbiAqIEBmbG93IHN0cmljdFxuICogQGZvcm1hdFxuICogQGNvcHlyaWdodCAyMDE0LTIwMTUgR2HDq3RhbiBSZW5hdWRlYXUuIE1JVCBMaWNlbnNlLlxuICovXG5cbid1c2Ugc3RyaWN0JztcblxuLy8gVGhlc2UgdmFsdWVzIGFyZSBlc3RhYmxpc2hlZCBieSBlbXBpcmljaXNtIHdpdGggdGVzdHMgKHRyYWRlb2ZmOiBwZXJmb3JtYW5jZSBWUyBwcmVjaXNpb24pXG5jb25zdCBORVdUT05fSVRFUkFUSU9OUyA9IDQ7XG5jb25zdCBORVdUT05fTUlOX1NMT1BFID0gMC4wMDE7XG5jb25zdCBTVUJESVZJU0lPTl9QUkVDSVNJT04gPSAwLjAwMDAwMDE7XG5jb25zdCBTVUJESVZJU0lPTl9NQVhfSVRFUkFUSU9OUyA9IDEwO1xuXG5jb25zdCBrU3BsaW5lVGFibGVTaXplID0gMTE7XG5jb25zdCBrU2FtcGxlU3RlcFNpemUgPSAxLjAgLyAoa1NwbGluZVRhYmxlU2l6ZSAtIDEuMCk7XG5cbmNvbnN0IGZsb2F0MzJBcnJheVN1cHBvcnRlZCA9IHR5cGVvZiBGbG9hdDMyQXJyYXkgPT09ICdmdW5jdGlvbic7XG5cbmZ1bmN0aW9uIEEoYUExLCBhQTIpIHtcbiAgcmV0dXJuIDEuMCAtIDMuMCAqIGFBMiArIDMuMCAqIGFBMTtcbn1cbmZ1bmN0aW9uIEIoYUExLCBhQTIpIHtcbiAgcmV0dXJuIDMuMCAqIGFBMiAtIDYuMCAqIGFBMTtcbn1cbmZ1bmN0aW9uIEMoYUExKSB7XG4gIHJldHVybiAzLjAgKiBhQTE7XG59XG5cbi8vIFJldHVybnMgeCh0KSBnaXZlbiB0LCB4MSwgYW5kIHgyLCBvciB5KHQpIGdpdmVuIHQsIHkxLCBhbmQgeTIuXG5mdW5jdGlvbiBjYWxjQmV6aWVyKGFULCBhQTEsIGFBMikge1xuICByZXR1cm4gKChBKGFBMSwgYUEyKSAqIGFUICsgQihhQTEsIGFBMikpICogYVQgKyBDKGFBMSkpICogYVQ7XG59XG5cbi8vIFJldHVybnMgZHgvZHQgZ2l2ZW4gdCwgeDEsIGFuZCB4Miwgb3IgZHkvZHQgZ2l2ZW4gdCwgeTEsIGFuZCB5Mi5cbmZ1bmN0aW9uIGdldFNsb3BlKGFULCBhQTEsIGFBMikge1xuICByZXR1cm4gMy4wICogQShhQTEsIGFBMikgKiBhVCAqIGFUICsgMi4wICogQihhQTEsIGFBMikgKiBhVCArIEMoYUExKTtcbn1cblxuZnVuY3Rpb24gYmluYXJ5U3ViZGl2aWRlKGFYLCBfYUEsIF9hQiwgbVgxLCBtWDIpIHtcbiAgbGV0IGN1cnJlbnRYLFxuICAgIGN1cnJlbnRULFxuICAgIGkgPSAwLFxuICAgIGFBID0gX2FBLFxuICAgIGFCID0gX2FCO1xuICBkbyB7XG4gICAgY3VycmVudFQgPSBhQSArIChhQiAtIGFBKSAvIDIuMDtcbiAgICBjdXJyZW50WCA9IGNhbGNCZXppZXIoY3VycmVudFQsIG1YMSwgbVgyKSAtIGFYO1xuICAgIGlmIChjdXJyZW50WCA+IDAuMCkge1xuICAgICAgYUIgPSBjdXJyZW50VDtcbiAgICB9IGVsc2Uge1xuICAgICAgYUEgPSBjdXJyZW50VDtcbiAgICB9XG4gIH0gd2hpbGUgKFxuICAgIE1hdGguYWJzKGN1cnJlbnRYKSA+IFNVQkRJVklTSU9OX1BSRUNJU0lPTiAmJlxuICAgICsraSA8IFNVQkRJVklTSU9OX01BWF9JVEVSQVRJT05TXG4gICk7XG4gIHJldHVybiBjdXJyZW50VDtcbn1cblxuZnVuY3Rpb24gbmV3dG9uUmFwaHNvbkl0ZXJhdGUoYVgsIF9hR3Vlc3NULCBtWDEsIG1YMikge1xuICBsZXQgYUd1ZXNzVCA9IF9hR3Vlc3NUO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IE5FV1RPTl9JVEVSQVRJT05TOyArK2kpIHtcbiAgICBjb25zdCBjdXJyZW50U2xvcGUgPSBnZXRTbG9wZShhR3Vlc3NULCBtWDEsIG1YMik7XG4gICAgaWYgKGN1cnJlbnRTbG9wZSA9PT0gMC4wKSB7XG4gICAgICByZXR1cm4gYUd1ZXNzVDtcbiAgICB9XG4gICAgY29uc3QgY3VycmVudFggPSBjYWxjQmV6aWVyKGFHdWVzc1QsIG1YMSwgbVgyKSAtIGFYO1xuICAgIGFHdWVzc1QgLT0gY3VycmVudFggLyBjdXJyZW50U2xvcGU7XG4gIH1cbiAgcmV0dXJuIGFHdWVzc1Q7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYmV6aWVyKFxuICBtWDE6IG51bWJlcixcbiAgbVkxOiBudW1iZXIsXG4gIG1YMjogbnVtYmVyLFxuICBtWTI6IG51bWJlcixcbikge1xuICBpZiAoIShtWDEgPj0gMCAmJiBtWDEgPD0gMSAmJiBtWDIgPj0gMCAmJiBtWDIgPD0gMSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2JlemllciB4IHZhbHVlcyBtdXN0IGJlIGluIFswLCAxXSByYW5nZScpO1xuICB9XG5cbiAgLy8gUHJlY29tcHV0ZSBzYW1wbGVzIHRhYmxlXG4gIGNvbnN0IHNhbXBsZVZhbHVlcyA9IGZsb2F0MzJBcnJheVN1cHBvcnRlZFxuICAgID8gbmV3IEZsb2F0MzJBcnJheShrU3BsaW5lVGFibGVTaXplKVxuICAgIDogbmV3IEFycmF5KGtTcGxpbmVUYWJsZVNpemUpO1xuICBpZiAobVgxICE9PSBtWTEgfHwgbVgyICE9PSBtWTIpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGtTcGxpbmVUYWJsZVNpemU7ICsraSkge1xuICAgICAgc2FtcGxlVmFsdWVzW2ldID0gY2FsY0JlemllcihpICoga1NhbXBsZVN0ZXBTaXplLCBtWDEsIG1YMik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VEZvclgoYVgpIHtcbiAgICBsZXQgaW50ZXJ2YWxTdGFydCA9IDAuMDtcbiAgICBsZXQgY3VycmVudFNhbXBsZSA9IDE7XG4gICAgY29uc3QgbGFzdFNhbXBsZSA9IGtTcGxpbmVUYWJsZVNpemUgLSAxO1xuXG4gICAgZm9yIChcbiAgICAgIDtcbiAgICAgIGN1cnJlbnRTYW1wbGUgIT09IGxhc3RTYW1wbGUgJiYgc2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdIDw9IGFYO1xuICAgICAgKytjdXJyZW50U2FtcGxlXG4gICAgKSB7XG4gICAgICBpbnRlcnZhbFN0YXJ0ICs9IGtTYW1wbGVTdGVwU2l6ZTtcbiAgICB9XG4gICAgLS1jdXJyZW50U2FtcGxlO1xuXG4gICAgLy8gSW50ZXJwb2xhdGUgdG8gcHJvdmlkZSBhbiBpbml0aWFsIGd1ZXNzIGZvciB0XG4gICAgY29uc3QgZGlzdCA9XG4gICAgICAoYVggLSBzYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZV0pIC9cbiAgICAgIChzYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZSArIDFdIC0gc2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKTtcbiAgICBjb25zdCBndWVzc0ZvclQgPSBpbnRlcnZhbFN0YXJ0ICsgZGlzdCAqIGtTYW1wbGVTdGVwU2l6ZTtcblxuICAgIGNvbnN0IGluaXRpYWxTbG9wZSA9IGdldFNsb3BlKGd1ZXNzRm9yVCwgbVgxLCBtWDIpO1xuICAgIGlmIChpbml0aWFsU2xvcGUgPj0gTkVXVE9OX01JTl9TTE9QRSkge1xuICAgICAgcmV0dXJuIG5ld3RvblJhcGhzb25JdGVyYXRlKGFYLCBndWVzc0ZvclQsIG1YMSwgbVgyKTtcbiAgICB9IGVsc2UgaWYgKGluaXRpYWxTbG9wZSA9PT0gMC4wKSB7XG4gICAgICByZXR1cm4gZ3Vlc3NGb3JUO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYmluYXJ5U3ViZGl2aWRlKFxuICAgICAgICBhWCxcbiAgICAgICAgaW50ZXJ2YWxTdGFydCxcbiAgICAgICAgaW50ZXJ2YWxTdGFydCArIGtTYW1wbGVTdGVwU2l6ZSxcbiAgICAgICAgbVgxLFxuICAgICAgICBtWDIsXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiBCZXppZXJFYXNpbmcoeDogbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAobVgxID09PSBtWTEgJiYgbVgyID09PSBtWTIpIHtcbiAgICAgIHJldHVybiB4OyAvLyBsaW5lYXJcbiAgICB9XG4gICAgLy8gQmVjYXVzZSBKYXZhU2NyaXB0IG51bWJlciBhcmUgaW1wcmVjaXNlLCB3ZSBzaG91bGQgZ3VhcmFudGVlIHRoZSBleHRyZW1lcyBhcmUgcmlnaHQuXG4gICAgaWYgKHggPT09IDApIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBpZiAoeCA9PT0gMSkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHJldHVybiBjYWxjQmV6aWVyKGdldFRGb3JYKHgpLCBtWTEsIG1ZMik7XG4gIH07XG59O1xuIl19