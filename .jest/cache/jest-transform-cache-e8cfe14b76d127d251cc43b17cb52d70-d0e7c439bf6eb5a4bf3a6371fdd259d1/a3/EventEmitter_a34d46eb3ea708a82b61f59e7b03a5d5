195a5ffe4fe9f75793d356889d3c3004
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var EmitterSubscription = require('./EmitterSubscription');

var EventSubscriptionVendor = require('./EventSubscriptionVendor');

var invariant = require('invariant');

var sparseFilterPredicate = function sparseFilterPredicate() {
  return true;
};

var EventEmitter = function () {
  function EventEmitter(subscriber) {
    (0, _classCallCheck2.default)(this, EventEmitter);
    this._subscriber = subscriber || new EventSubscriptionVendor();
  }

  (0, _createClass2.default)(EventEmitter, [{
    key: "addListener",
    value: function addListener(eventType, listener, context) {
      return this._subscriber.addSubscription(eventType, new EmitterSubscription(this, this._subscriber, listener, context));
    }
  }, {
    key: "once",
    value: function once(eventType, listener, context) {
      var _this = this;

      return this.addListener(eventType, function () {
        _this.removeCurrentListener();

        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
          args[_key] = arguments[_key];
        }

        listener.apply(context, args);
      });
    }
  }, {
    key: "removeAllListeners",
    value: function removeAllListeners(eventType) {
      this._subscriber.removeAllSubscriptions(eventType);
    }
  }, {
    key: "removeCurrentListener",
    value: function removeCurrentListener() {
      invariant(!!this._currentSubscription, 'Not in an emitting cycle; there is no current subscription');
      this.removeSubscription(this._currentSubscription);
    }
  }, {
    key: "removeSubscription",
    value: function removeSubscription(subscription) {
      invariant(subscription.emitter === this, 'Subscription does not belong to this emitter.');

      this._subscriber.removeSubscription(subscription);
    }
  }, {
    key: "listeners",
    value: function listeners(eventType) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      return subscriptions ? subscriptions.filter(sparseFilterPredicate).map(function (subscription) {
        return subscription.listener;
      }) : [];
    }
  }, {
    key: "emit",
    value: function emit(eventType) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      if (subscriptions) {
        for (var i = 0, l = subscriptions.length; i < l; i++) {
          var subscription = subscriptions[i];

          if (subscription && subscription.listener) {
            this._currentSubscription = subscription;
            subscription.listener.apply(subscription.context, Array.prototype.slice.call(arguments, 1));
          }
        }

        this._currentSubscription = null;
      }
    }
  }, {
    key: "removeListener",
    value: function removeListener(eventType, listener) {
      var subscriptions = this._subscriber.getSubscriptionsForType(eventType);

      if (subscriptions) {
        for (var i = 0, l = subscriptions.length; i < l; i++) {
          var subscription = subscriptions[i];

          if (subscription && subscription.listener === listener) {
            subscription.remove();
          }
        }
      }
    }
  }]);
  return EventEmitter;
}();

module.exports = EventEmitter;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV2ZW50RW1pdHRlci5qcyJdLCJuYW1lcyI6WyJFbWl0dGVyU3Vic2NyaXB0aW9uIiwicmVxdWlyZSIsIkV2ZW50U3Vic2NyaXB0aW9uVmVuZG9yIiwiaW52YXJpYW50Iiwic3BhcnNlRmlsdGVyUHJlZGljYXRlIiwiRXZlbnRFbWl0dGVyIiwic3Vic2NyaWJlciIsIl9zdWJzY3JpYmVyIiwiZXZlbnRUeXBlIiwibGlzdGVuZXIiLCJjb250ZXh0IiwiYWRkU3Vic2NyaXB0aW9uIiwiYWRkTGlzdGVuZXIiLCJyZW1vdmVDdXJyZW50TGlzdGVuZXIiLCJhcmdzIiwiYXBwbHkiLCJyZW1vdmVBbGxTdWJzY3JpcHRpb25zIiwiX2N1cnJlbnRTdWJzY3JpcHRpb24iLCJyZW1vdmVTdWJzY3JpcHRpb24iLCJzdWJzY3JpcHRpb24iLCJlbWl0dGVyIiwic3Vic2NyaXB0aW9ucyIsImdldFN1YnNjcmlwdGlvbnNGb3JUeXBlIiwiZmlsdGVyIiwibWFwIiwiaSIsImwiLCJsZW5ndGgiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImFyZ3VtZW50cyIsInJlbW92ZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQVdBOzs7Ozs7OztBQUVBLElBQU1BLG1CQUFtQixHQUFHQyxPQUFPLENBQUMsdUJBQUQsQ0FBbkM7O0FBQ0EsSUFBTUMsdUJBQXVCLEdBQUdELE9BQU8sQ0FBQywyQkFBRCxDQUF2Qzs7QUFFQSxJQUFNRSxTQUFTLEdBQUdGLE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUVBLElBQU1HLHFCQUFxQixHQUFHLFNBQXhCQSxxQkFBd0I7QUFBQSxTQUFNLElBQU47QUFBQSxDQUE5Qjs7SUFlTUMsWTtBQVVKLHdCQUFZQyxVQUFaLEVBQWtEO0FBQUE7QUFDaEQsU0FBS0MsV0FBTCxHQUFtQkQsVUFBVSxJQUFJLElBQUlKLHVCQUFKLEVBQWpDO0FBQ0Q7Ozs7Z0NBaUJDTSxTLEVBQ0FDLFEsRUFDQUMsTyxFQUNxQjtBQUNyQixhQUFR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QUNGO0FBQ0Y7Ozs7O0FBR0hDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjlCLFlBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAbm9mbG93XG4gKiBAdHlwZWNoZWNrXG4gKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBFbWl0dGVyU3Vic2NyaXB0aW9uID0gcmVxdWlyZSgnLi9FbWl0dGVyU3Vic2NyaXB0aW9uJyk7XG5jb25zdCBFdmVudFN1YnNjcmlwdGlvblZlbmRvciA9IHJlcXVpcmUoJy4vRXZlbnRTdWJzY3JpcHRpb25WZW5kb3InKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5cbmNvbnN0IHNwYXJzZUZpbHRlclByZWRpY2F0ZSA9ICgpID0+IHRydWU7XG5cbi8qKlxuICogQGNsYXNzIEV2ZW50RW1pdHRlclxuICogQGRlc2NyaXB0aW9uXG4gKiBBbiBFdmVudEVtaXR0ZXIgaXMgcmVzcG9uc2libGUgZm9yIG1hbmFnaW5nIGEgc2V0IG9mIGxpc3RlbmVycyBhbmQgcHVibGlzaGluZ1xuICogZXZlbnRzIHRvIHRoZW0gd2hlbiBpdCBpcyB0b2xkIHRoYXQgc3VjaCBldmVudHMgaGFwcGVuZWQuIEluIGFkZGl0aW9uIHRvIHRoZVxuICogZGF0YSBmb3IgdGhlIGdpdmVuIGV2ZW50IGl0IGFsc28gc2VuZHMgYSBldmVudCBjb250cm9sIG9iamVjdCB3aGljaCBhbGxvd3NcbiAqIHRoZSBsaXN0ZW5lcnMvaGFuZGxlcnMgdG8gcHJldmVudCB0aGUgZGVmYXVsdCBiZWhhdmlvciBvZiB0aGUgZ2l2ZW4gZXZlbnQuXG4gKlxuICogVGhlIGVtaXR0ZXIgaXMgZGVzaWduZWQgdG8gYmUgZ2VuZXJpYyBlbm91Z2ggdG8gc3VwcG9ydCBhbGwgdGhlIGRpZmZlcmVudFxuICogY29udGV4dHMgaW4gd2hpY2ggb25lIG1pZ2h0IHdhbnQgdG8gZW1pdCBldmVudHMuIEl0IGlzIGEgc2ltcGxlIG11bHRpY2FzdFxuICogbWVjaGFuaXNtIG9uIHRvcCBvZiB3aGljaCBleHRyYSBmdW5jdGlvbmFsaXR5IGNhbiBiZSBjb21wb3NlZC4gRm9yIGV4YW1wbGUsIGFcbiAqIG1vcmUgYWR2YW5jZWQgZW1pdHRlciBtYXkgdXNlIGFuIEV2ZW50SG9sZGVyIGFuZCBFdmVudEZhY3RvcnkuXG4gKi9cbmNsYXNzIEV2ZW50RW1pdHRlciB7XG4gIF9zdWJzY3JpYmVyOiBFdmVudFN1YnNjcmlwdGlvblZlbmRvcjtcbiAgX2N1cnJlbnRTdWJzY3JpcHRpb246ID9FbWl0dGVyU3Vic2NyaXB0aW9uO1xuXG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICpcbiAgICogQHBhcmFtIHtFdmVudFN1YnNjcmlwdGlvblZlbmRvcn0gc3Vic2NyaWJlciAtIE9wdGlvbmFsIHN1YnNjcmliZXIgaW5zdGFuY2VcbiAgICogICB0byB1c2UuIElmIG9taXR0ZWQsIGEgbmV3IHN1YnNjcmliZXIgd2lsbCBiZSBjcmVhdGVkIGZvciB0aGUgZW1pdHRlci5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHN1YnNjcmliZXI6ID9FdmVudFN1YnNjcmlwdGlvblZlbmRvcikge1xuICAgIHRoaXMuX3N1YnNjcmliZXIgPSBzdWJzY3JpYmVyIHx8IG5ldyBFdmVudFN1YnNjcmlwdGlvblZlbmRvcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBsaXN0ZW5lciB0byBiZSBpbnZva2VkIHdoZW4gZXZlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdHlwZSBhcmVcbiAgICogZW1pdHRlZC4gQW4gb3B0aW9uYWwgY2FsbGluZyBjb250ZXh0IG1heSBiZSBwcm92aWRlZC4gVGhlIGRhdGEgYXJndW1lbnRzXG4gICAqIGVtaXR0ZWQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBUT0RPOiBBbm5vdGF0ZSB0aGUgbGlzdGVuZXIgYXJnJ3MgdHlwZS4gVGhpcyBpcyB0cmlja3kgYmVjYXVzZSBsaXN0ZW5lcnNcbiAgICogICAgICAgY2FuIGJlIGludm9rZWQgd2l0aCB2YXJhcmdzLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gdGhlIHNwZWNpZmllZCBldmVudCBpc1xuICAgKiAgIGVtaXR0ZWRcbiAgICogQHBhcmFtIHsqfSBjb250ZXh0IC0gT3B0aW9uYWwgY29udGV4dCBvYmplY3QgdG8gdXNlIHdoZW4gaW52b2tpbmcgdGhlXG4gICAqICAgbGlzdGVuZXJcbiAgICovXG4gIGFkZExpc3RlbmVyKFxuICAgIGV2ZW50VHlwZTogc3RyaW5nLFxuICAgIGxpc3RlbmVyOiBGdW5jdGlvbixcbiAgICBjb250ZXh0OiA/T2JqZWN0LFxuICApOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHtcbiAgICByZXR1cm4gKHRoaXMuX3N1YnNjcmliZXIuYWRkU3Vic2NyaXB0aW9uKFxuICAgICAgZXZlbnRUeXBlLFxuICAgICAgbmV3IEVtaXR0ZXJTdWJzY3JpcHRpb24odGhpcywgdGhpcy5fc3Vic2NyaWJlciwgbGlzdGVuZXIsIGNvbnRleHQpLFxuICAgICk6IGFueSk7XG4gIH1cblxuICAvKipcbiAgICogU2ltaWxhciB0byBhZGRMaXN0ZW5lciwgZXhjZXB0IHRoYXQgdGhlIGxpc3RlbmVyIGlzIHJlbW92ZWQgYWZ0ZXIgaXQgaXNcbiAgICogaW52b2tlZCBvbmNlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIG9ubHkgb25jZSB3aGVuIHRoZVxuICAgKiAgIHNwZWNpZmllZCBldmVudCBpcyBlbWl0dGVkXG4gICAqIEBwYXJhbSB7Kn0gY29udGV4dCAtIE9wdGlvbmFsIGNvbnRleHQgb2JqZWN0IHRvIHVzZSB3aGVuIGludm9raW5nIHRoZVxuICAgKiAgIGxpc3RlbmVyXG4gICAqL1xuICBvbmNlKFxuICAgIGV2ZW50VHlwZTogc3RyaW5nLFxuICAgIGxpc3RlbmVyOiBGdW5jdGlvbixcbiAgICBjb250ZXh0OiA/T2JqZWN0LFxuICApOiBFbWl0dGVyU3Vic2NyaXB0aW9uIHtcbiAgICByZXR1cm4gdGhpcy5hZGRMaXN0ZW5lcihldmVudFR5cGUsICguLi5hcmdzKSA9PiB7XG4gICAgICB0aGlzLnJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpO1xuICAgICAgbGlzdGVuZXIuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbGwgb2YgdGhlIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLCBpbmNsdWRpbmcgdGhvc2UgcmVnaXN0ZXJlZCBhc1xuICAgKiBsaXN0ZW5lciBtYXBzLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IGV2ZW50VHlwZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGV2ZW50IHdob3NlIHJlZ2lzdGVyZWRcbiAgICogICBsaXN0ZW5lcnMgdG8gcmVtb3ZlXG4gICAqL1xuICByZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnRUeXBlOiA/c3RyaW5nKSB7XG4gICAgdGhpcy5fc3Vic2NyaWJlci5yZW1vdmVBbGxTdWJzY3JpcHRpb25zKGV2ZW50VHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogUHJvdmlkZXMgYW4gQVBJIHRoYXQgY2FuIGJlIGNhbGxlZCBkdXJpbmcgYW4gZXZlbnRpbmcgY3ljbGUgdG8gcmVtb3ZlIHRoZVxuICAgKiBsYXN0IGxpc3RlbmVyIHRoYXQgd2FzIGludm9rZWQuIFRoaXMgYWxsb3dzIGEgZGV2ZWxvcGVyIHRvIHByb3ZpZGUgYW4gZXZlbnRcbiAgICogb2JqZWN0IHRoYXQgY2FuIHJlbW92ZSB0aGUgbGlzdGVuZXIgKG9yIGxpc3RlbmVyIG1hcCkgZHVyaW5nIHRoZVxuICAgKiBpbnZvY2F0aW9uLlxuICAgKlxuICAgKiBJZiBpdCBpcyBjYWxsZWQgd2hlbiBub3QgaW5zaWRlIG9mIGFuIGVtaXR0aW5nIGN5Y2xlIGl0IHdpbGwgdGhyb3cuXG4gICAqXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBXaGVuIGNhbGxlZCBub3QgZHVyaW5nIGFuIGV2ZW50aW5nIGN5Y2xlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgdmFyIHN1YnNjcmlwdGlvbiA9IGVtaXR0ZXIuYWRkTGlzdGVuZXJNYXAoe1xuICAgKiAgICAgc29tZUV2ZW50OiBmdW5jdGlvbihkYXRhLCBldmVudCkge1xuICAgKiAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICogICAgICAgZW1pdHRlci5yZW1vdmVDdXJyZW50TGlzdGVuZXIoKTtcbiAgICogICAgIH1cbiAgICogICB9KTtcbiAgICpcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdhYmMnKTsgLy8gbG9ncyAnYWJjJ1xuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2RlZicpOyAvLyBkb2VzIG5vdCBsb2cgYW55dGhpbmdcbiAgICovXG4gIHJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIXRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24sXG4gICAgICAnTm90IGluIGFuIGVtaXR0aW5nIGN5Y2xlOyB0aGVyZSBpcyBubyBjdXJyZW50IHN1YnNjcmlwdGlvbicsXG4gICAgKTtcbiAgICB0aGlzLnJlbW92ZVN1YnNjcmlwdGlvbih0aGlzLl9jdXJyZW50U3Vic2NyaXB0aW9uKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGEgc3BlY2lmaWMgc3Vic2NyaXB0aW9uLiBDYWxsZWQgYnkgdGhlIGByZW1vdmUoKWAgbWV0aG9kIG9mIHRoZVxuICAgKiBzdWJzY3JpcHRpb24gaXRzZWxmIHRvIGVuc3VyZSBhbnkgbmVjZXNzYXJ5IGNsZWFudXAgaXMgcGVyZm9ybWVkLlxuICAgKi9cbiAgcmVtb3ZlU3Vic2NyaXB0aW9uKHN1YnNjcmlwdGlvbjogRW1pdHRlclN1YnNjcmlwdGlvbikge1xuICAgIGludmFyaWFudChcbiAgICAgIHN1YnNjcmlwdGlvbi5lbWl0dGVyID09PSB0aGlzLFxuICAgICAgJ1N1YnNjcmlwdGlvbiBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBlbWl0dGVyLicsXG4gICAgKTtcbiAgICB0aGlzLl9zdWJzY3JpYmVyLnJlbW92ZVN1YnNjcmlwdGlvbihzdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIHRoYXQgYXJlIGN1cnJlbnRseSByZWdpc3RlcmVkIGZvciB0aGUgZ2l2ZW5cbiAgICogZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBxdWVyeVxuICAgKiBAcmV0dXJucyB7YXJyYXl9XG4gICAqL1xuICBsaXN0ZW5lcnMoZXZlbnRUeXBlOiBzdHJpbmcpOiBbRW1pdHRlclN1YnNjcmlwdGlvbl0ge1xuICAgIGNvbnN0IHN1YnNjcmlwdGlvbnMgPSB0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk7XG4gICAgcmV0dXJuIHN1YnNjcmlwdGlvbnNcbiAgICAgID8gc3Vic2NyaXB0aW9uc1xuICAgICAgICAgIC8vIFdlIGZpbHRlciBvdXQgbWlzc2luZyBlbnRyaWVzIGJlY2F1c2UgdGhlIGFycmF5IGlzIHNwYXJzZS5cbiAgICAgICAgICAvLyBcImNhbGxiYWNrZm4gaXMgY2FsbGVkIG9ubHkgZm9yIGVsZW1lbnRzIG9mIHRoZSBhcnJheSB3aGljaCBhY3R1YWxseVxuICAgICAgICAgIC8vIGV4aXN0OyBpdCBpcyBub3QgY2FsbGVkIGZvciBtaXNzaW5nIGVsZW1lbnRzIG9mIHRoZSBhcnJheS5cIlxuICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvOS4wL2luZGV4Lmh0bWwjc2VjLWFycmF5LnByb3RvdHlwZS5maWx0ZXJcbiAgICAgICAgICAuZmlsdGVyKHNwYXJzZUZpbHRlclByZWRpY2F0ZSlcbiAgICAgICAgICAubWFwKHN1YnNjcmlwdGlvbiA9PiBzdWJzY3JpcHRpb24ubGlzdGVuZXIpXG4gICAgICA6IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFuIGV2ZW50IG9mIHRoZSBnaXZlbiB0eXBlIHdpdGggdGhlIGdpdmVuIGRhdGEuIEFsbCBoYW5kbGVycyBvZiB0aGF0XG4gICAqIHBhcnRpY3VsYXIgdHlwZSB3aWxsIGJlIG5vdGlmaWVkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdFxuICAgKiBAcGFyYW0gey4uLip9IEFyYml0cmFyeSBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIGVhY2ggcmVnaXN0ZXJlZCBsaXN0ZW5lclxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgIGVtaXR0ZXIuYWRkTGlzdGVuZXIoJ3NvbWVFdmVudCcsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICogICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgKiAgIH0pO1xuICAgKlxuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2FiYycpOyAvLyBsb2dzICdhYmMnXG4gICAqL1xuICBlbWl0KGV2ZW50VHlwZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHRoaXMuX3N1YnNjcmliZXIuZ2V0U3Vic2NyaXB0aW9uc0ZvclR5cGUoZXZlbnRUeXBlKTtcbiAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzdWJzY3JpcHRpb25zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25zW2ldO1xuXG4gICAgICAgIC8vIFRoZSBzdWJzY3JpcHRpb24gbWF5IGhhdmUgYmVlbiByZW1vdmVkIGR1cmluZyB0aGlzIGV2ZW50IGxvb3AuXG4gICAgICAgIGlmIChzdWJzY3JpcHRpb24gJiYgc3Vic2NyaXB0aW9uLmxpc3RlbmVyKSB7XG4gICAgICAgICAgdGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbiA9IHN1YnNjcmlwdGlvbjtcbiAgICAgICAgICBzdWJzY3JpcHRpb24ubGlzdGVuZXIuYXBwbHkoXG4gICAgICAgICAgICBzdWJzY3JpcHRpb24uY29udGV4dCxcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fY3VycmVudFN1YnNjcmlwdGlvbiA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgdGhlIGdpdmVuIGxpc3RlbmVyIGZvciBldmVudCBvZiBzcGVjaWZpYyB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdFxuICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBsaXN0ZW5lciAtIEZ1bmN0aW9uIHRvIGludm9rZSB3aGVuIHRoZSBzcGVjaWZpZWQgZXZlbnQgaXNcbiAgICogICBlbWl0dGVkXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgZW1pdHRlci5yZW1vdmVMaXN0ZW5lcignc29tZUV2ZW50JywgZnVuY3Rpb24obWVzc2FnZSkge1xuICAgKiAgICAgY29uc29sZS5sb2cobWVzc2FnZSk7XG4gICAqICAgfSk7IC8vIHJlbW92ZXMgdGhlIGxpc3RlbmVyIGlmIGFscmVhZHkgcmVnaXN0ZXJlZFxuICAgKlxuICAgKi9cbiAgcmVtb3ZlTGlzdGVuZXIoZXZlbnRUeXBlOiBTdHJpbmcsIGxpc3RlbmVyKSB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9ucyA9IHRoaXMuX3N1YnNjcmliZXIuZ2V0U3Vic2NyaXB0aW9uc0ZvclR5cGUoZXZlbnRUeXBlKTtcbiAgICBpZiAoc3Vic2NyaXB0aW9ucykge1xuICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBzdWJzY3JpcHRpb25zLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25zW2ldO1xuXG4gICAgICAgIC8vIFRoZSBzdWJzY3JpcHRpb24gbWF5IGhhdmUgYmVlbiByZW1vdmVkIGR1cmluZyB0aGlzIGV2ZW50IGxvb3AuXG4gICAgICAgIC8vIGl0cyBsaXN0ZW5lciBtYXRjaGVzIHRoZSBsaXN0ZW5lciBpbiBtZXRob2QgcGFyYW1ldGVyc1xuICAgICAgICBpZiAoc3Vic2NyaXB0aW9uICYmIHN1YnNjcmlwdGlvbi5saXN0ZW5lciA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgICBzdWJzY3JpcHRpb24ucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG4iXX0=