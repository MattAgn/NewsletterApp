e3caa8e4e4c70985307579f547afc3fd
"use strict";

var Buffer = require("buffer").Buffer,
    Transform = require("stream").Transform;

module.exports = function (iconv) {
  iconv.encodeStream = function encodeStream(encoding, options) {
    return new IconvLiteEncoderStream(iconv.getEncoder(encoding, options), options);
  };

  iconv.decodeStream = function decodeStream(encoding, options) {
    return new IconvLiteDecoderStream(iconv.getDecoder(encoding, options), options);
  };

  iconv.supportsStreams = true;
  iconv.IconvLiteEncoderStream = IconvLiteEncoderStream;
  iconv.IconvLiteDecoderStream = IconvLiteDecoderStream;
  iconv._collect = IconvLiteDecoderStream.prototype.collect;
};

function IconvLiteEncoderStream(conv, options) {
  this.conv = conv;
  options = options || {};
  options.decodeStrings = false;
  Transform.call(this, options);
}

IconvLiteEncoderStream.prototype = Object.create(Transform.prototype, {
  constructor: {
    value: IconvLiteEncoderStream
  }
});

IconvLiteEncoderStream.prototype._transform = function (chunk, encoding, done) {
  if (typeof chunk != 'string') return done(new Error("Iconv encoding stream needs strings as its input."));

  try {
    var res = this.conv.write(chunk);
    if (res && res.length) this.push(res);
    done();
  } catch (e) {
    done(e);
  }
};

IconvLiteEncoderStream.prototype._flush = function (done) {
  try {
    var res = this.conv.end();
    if (res && res.length) this.push(res);
    done();
  } catch (e) {
    done(e);
  }
};

IconvLiteEncoderStream.prototype.collect = function (cb) {
  var chunks = [];
  this.on('error', cb);
  this.on('data', function (chunk) {
    chunks.push(chunk);
  });
  this.on('end', function () {
    cb(null, Buffer.concat(chunks));
  });
  return this;
};

function IconvLiteDecoderStream(conv, options) {
  this.conv = conv;
  options = options || {};
  options.encoding = this.encoding = 'utf8';
  Transform.call(this, options);
}

IconvLiteDecoderStream.prototype = Object.create(Transform.prototype, {
  constructor: {
    value: IconvLiteDecoderStream
  }
});

IconvLiteDecoderStream.prototype._transform = function (chunk, encoding, done) {
  if (!Buffer.isBuffer(chunk)) return done(new Error("Iconv decoding stream needs buffers as its input."));

  try {
    var res = this.conv.write(chunk);
    if (res && res.length) this.push(res, this.encoding);
    done();
  } catch (e) {
    done(e);
  }
};

IconvLiteDecoderStream.prototype._flush = function (done) {
  try {
    var res = this.conv.end();
    if (res && res.length) this.push(res, this.encoding);
    done();
  } catch (e) {
    done(e);
  }
};

IconvLiteDecoderStream.prototype.collect = function (cb) {
  var res = '';
  this.on('error', cb);
  this.on('data', function (chunk) {
    res += chunk;
  });
  this.on('end', function () {
    cb(null, res);
  });
  return this;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0cmVhbXMuanMiXSwibmFtZXMiOlsiQnVmZmVyIiwicmVxdWlyZSIsIlRyYW5zZm9ybSIsIm1vZHVsZSIsImV4cG9ydHMiLCJpY29udiIsImVuY29kZVN0cmVhbSIsImVuY29kaW5nIiwib3B0aW9ucyIsIkljb252TGl0ZUVuY29kZXJTdHJlYW0iLCJnZXRFbmNvZGVyIiwiZGVjb2RlU3RyZWFtIiwiSWNvbnZMaXRlRGVjb2RlclN0cmVhbSIsImdldERlY29kZXIiLCJzdXBwb3J0c1N0cmVhbXMiLCJfY29sbGVjdCIsInByb3RvdHlwZSIsImNvbGxlY3QiLCJjb252IiwiZGVjb2RlU3RyaW5ncyIsImNhbGwiLCJPYmplY3QiLCJjcmVhdGUiLCJjb25zdHJ1Y3RvciIsInZhbHVlIiwiX3RyYW5zZm9ybSIsImNodW5rIiwiZG9uZSIsIkVycm9yIiwicmVzIiwid3JpdGUiLCJsZW5ndGgiLCJwdXNoIiwiZSIsIl9mbHVzaCIsImVuZCIsImNiIiwiY2h1bmtzIiwib24iLCJjb25jYXQiLCJpc0J1ZmZlciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCRCxNQUEvQjtBQUFBLElBQ0lFLFNBQVMsR0FBR0QsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsU0FEbEM7O0FBS0FDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixVQUFTQyxLQUFULEVBQWdCO0FBRzdCQSxFQUFBQSxLQUFLLENBQUNDLFlBQU4sR0FBcUIsU0FBU0EsWUFBVCxDQUFzQkMsUUFBdEIsRUFBZ0NDLE9BQWhDLEVBQXlDO0FBQzFELFdBQU8sSUFBSUMsc0JBQUosQ0FBMkJKLEtBQUssQ0FBQ0ssVUFBTixDQUFpQkgsUUFBakIsRUFBMkJDLE9BQTNCLENBQTNCLEVBQWdFQSxPQUFoRSxDQUFQO0FBQ0gsR0FGRDs7QUFJQUgsRUFBQUEsS0FBSyxDQUFDTSxZQUFOLEdBQXFCLFNBQVNBLFlBQVQsQ0FBc0JKLFFBQXRCLEVBQWdD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aUIsR0FBVixFQUFWO0FBQ0EsUUFBSU4sR0FBRyxJQUFJQSxHQUFHLENBQUNFLE1BQWYsRUFBdUIsS0FBS0MsSUFBTCxDQUFVSCxHQUFWLEVBQWUsS0FBS3RCLFFBQXBCO0FBQ3ZCb0IsSUFBQUEsSUFBSTtBQUNQLEdBSkQsQ0FLQSxPQUFPTSxDQUFQLEVBQVU7QUFDTk4sSUFBQUEsSUFBSSxDQUFDTSxDQUFELENBQUo7QUFDSDtBQUNKLENBVEQ7O0FBV0FyQixzQkFBc0IsQ0FBQ0ksU0FBdkIsQ0FBaUNDLE9BQWpDLEdBQTJDLFVBQVNtQixFQUFULEVBQWE7QUFDcEQsTUFBSVAsR0FBRyxHQUFHLEVBQVY7QUFDQSxPQUFLUyxFQUFMLENBQVEsT0FBUixFQUFpQkYsRUFBakI7QUFDQSxPQUFLRSxFQUFMLENBQVEsTUFBUixFQUFnQixVQUFTWixLQUFULEVBQWdCO0FBQUVHLElBQUFBLEdBQUcsSUFBSUgsS0FBUDtBQUFlLEdBQWpEO0FBQ0EsT0FBS1ksRUFBTCxDQUFRLEtBQVIsRUFBZSxZQUFXO0FBQ3RCRixJQUFBQSxFQUFFLENBQUMsSUFBRCxFQUFPUCxHQUFQLENBQUY7QUFDSCxHQUZEO0FBR0EsU0FBTyxJQUFQO0FBQ0gsQ0FSRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgQnVmZmVyID0gcmVxdWlyZShcImJ1ZmZlclwiKS5CdWZmZXIsXG4gICAgVHJhbnNmb3JtID0gcmVxdWlyZShcInN0cmVhbVwiKS5UcmFuc2Zvcm07XG5cblxuLy8gPT0gRXhwb3J0cyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaWNvbnYpIHtcbiAgICBcbiAgICAvLyBBZGRpdGlvbmFsIFB1YmxpYyBBUEkuXG4gICAgaWNvbnYuZW5jb2RlU3RyZWFtID0gZnVuY3Rpb24gZW5jb2RlU3RyZWFtKGVuY29kaW5nLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgSWNvbnZMaXRlRW5jb2RlclN0cmVhbShpY29udi5nZXRFbmNvZGVyKGVuY29kaW5nLCBvcHRpb25zKSwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgaWNvbnYuZGVjb2RlU3RyZWFtID0gZnVuY3Rpb24gZGVjb2RlU3RyZWFtKGVuY29kaW5nLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBuZXcgSWNvbnZMaXRlRGVjb2RlclN0cmVhbShpY29udi5nZXREZWNvZGVyKGVuY29kaW5nLCBvcHRpb25zKSwgb3B0aW9ucyk7XG4gICAgfVxuXG4gICAgaWNvbnYuc3VwcG9ydHNTdHJlYW1zID0gdHJ1ZTtcblxuXG4gICAgLy8gTm90IHB1Ymxpc2hlZCB5ZXQuXG4gICAgaWNvbnYuSWNvbnZMaXRlRW5jb2RlclN0cmVhbSA9IEljb252TGl0ZUVuY29kZXJTdHJlYW07XG4gICAgaWNvbnYuSWNvbnZMaXRlRGVjb2RlclN0cmVhbSA9IEljb252TGl0ZURlY29kZXJTdHJlYW07XG4gICAgaWNvbnYuX2NvbGxlY3QgPSBJY29udkxpdGVEZWNvZGVyU3RyZWFtLnByb3RvdHlwZS5jb2xsZWN0O1xufTtcblxuXG4vLyA9PSBFbmNvZGVyIHN0cmVhbSA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5mdW5jdGlvbiBJY29udkxpdGVFbmNvZGVyU3RyZWFtKGNvbnYsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmNvbnYgPSBjb252O1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIG9wdGlvbnMuZGVjb2RlU3RyaW5ncyA9IGZhbHNlOyAvLyBXZSBhY2NlcHQgb25seSBzdHJpbmdzLCBzbyB3ZSBkb24ndCBuZWVkIHRvIGRlY29kZSB0aGVtLlxuICAgIFRyYW5zZm9ybS5jYWxsKHRoaXMsIG9wdGlvbnMpO1xufVxuXG5JY29udkxpdGVFbmNvZGVyU3RyZWFtLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoVHJhbnNmb3JtLnByb3RvdHlwZSwge1xuICAgIGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBJY29udkxpdGVFbmNvZGVyU3RyZWFtIH1cbn0pO1xuXG5JY29udkxpdGVFbmNvZGVyU3RyZWFtLnByb3RvdHlwZS5fdHJhbnNmb3JtID0gZnVuY3Rpb24oY2h1bmssIGVuY29kaW5nLCBkb25lKSB7XG4gICAgaWYgKHR5cGVvZiBjaHVuayAhPSAnc3RyaW5nJylcbiAgICAgICAgcmV0dXJuIGRvbmUobmV3IEVycm9yKFwiSWNvbnYgZW5jb2Rpbmcgc3RyZWFtIG5lZWRzIHN0cmluZ3MgYXMgaXRzIGlucHV0LlwiKSk7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIHJlcyA9IHRoaXMuY29udi53cml0ZShjaHVuayk7XG4gICAgICAgIGlmIChyZXMgJiYgcmVzLmxlbmd0aCkgdGhpcy5wdXNoKHJlcyk7XG4gICAgICAgIGRvbmUoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgZG9uZShlKTtcbiAgICB9XG59XG5cbkljb252TGl0ZUVuY29kZXJTdHJlYW0ucHJvdG90eXBlLl9mbHVzaCA9IGZ1bmN0aW9uKGRvbmUpIHtcbiAgICB0cnkge1xuICAgICAgICB2YXIgcmVzID0gdGhpcy5jb252LmVuZCgpO1xuICAgICAgICBpZiAocmVzICYmIHJlcy5sZW5ndGgpIHRoaXMucHVzaChyZXMpO1xuICAgICAgICBkb25lKCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGRvbmUoZSk7XG4gICAgfVxufVxuXG5JY29udkxpdGVFbmNvZGVyU3RyZWFtLnByb3RvdHlwZS5jb2xsZWN0ID0gZnVuY3Rpb24oY2IpIHtcbiAgICB2YXIgY2h1bmtzID0gW107XG4gICAgdGhpcy5vbignZXJyb3InLCBjYik7XG4gICAgdGhpcy5vbignZGF0YScsIGZ1bmN0aW9uKGNodW5rKSB7IGNodW5rcy5wdXNoKGNodW5rKTsgfSk7XG4gICAgdGhpcy5vbignZW5kJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGNiKG51bGwsIEJ1ZmZlci5jb25jYXQoY2h1bmtzKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXM7XG59XG5cblxuLy8gPT0gRGVjb2RlciBzdHJlYW0gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuZnVuY3Rpb24gSWNvbnZMaXRlRGVjb2RlclN0cmVhbShjb252LCBvcHRpb25zKSB7XG4gICAgdGhpcy5jb252ID0gY29udjtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBvcHRpb25zLmVuY29kaW5nID0gdGhpcy5lbmNvZGluZyA9ICd1dGY4JzsgLy8gV2Ugb3V0cHV0IHN0cmluZ3MuXG4gICAgVHJhbnNmb3JtLmNhbGwodGhpcywgb3B0aW9ucyk7XG59XG5cbkljb252TGl0ZURlY29kZXJTdHJlYW0ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShUcmFuc2Zvcm0ucHJvdG90eXBlLCB7XG4gICAgY29uc3RydWN0b3I6IHsgdmFsdWU6IEljb252TGl0ZURlY29kZXJTdHJlYW0gfVxufSk7XG5cbkljb252TGl0ZURlY29kZXJTdHJlYW0ucHJvdG90eXBlLl90cmFuc2Zvcm0gPSBmdW5jdGlvbihjaHVuaywgZW5jb2RpbmcsIGRvbmUpIHtcbiAgICBpZiAoIUJ1ZmZlci5pc0J1ZmZlcihjaHVuaykpXG4gICAgICAgIHJldHVybiBkb25lKG5ldyBFcnJvcihcIkljb252IGRlY29kaW5nIHN0cmVhbSBuZWVkcyBidWZmZXJzIGFzIGl0cyBpbnB1dC5cIikpO1xuICAgIHRyeSB7XG4gICAgICAgIHZhciByZXMgPSB0aGlzLmNvbnYud3JpdGUoY2h1bmspO1xuICAgICAgICBpZiAocmVzICYmIHJlcy5sZW5ndGgpIHRoaXMucHVzaChyZXMsIHRoaXMuZW5jb2RpbmcpO1xuICAgICAgICBkb25lKCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGRvbmUoZSk7XG4gICAgfVxufVxuXG5JY29udkxpdGVEZWNvZGVyU3RyZWFtLnByb3RvdHlwZS5fZmx1c2ggPSBmdW5jdGlvbihkb25lKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIHJlcyA9IHRoaXMuY29udi5lbmQoKTtcbiAgICAgICAgaWYgKHJlcyAmJiByZXMubGVuZ3RoKSB0aGlzLnB1c2gocmVzLCB0aGlzLmVuY29kaW5nKTsgICAgICAgICAgICAgICAgXG4gICAgICAgIGRvbmUoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgZG9uZShlKTtcbiAgICB9XG59XG5cbkljb252TGl0ZURlY29kZXJTdHJlYW0ucHJvdG90eXBlLmNvbGxlY3QgPSBmdW5jdGlvbihjYikge1xuICAgIHZhciByZXMgPSAnJztcbiAgICB0aGlzLm9uKCdlcnJvcicsIGNiKTtcbiAgICB0aGlzLm9uKCdkYXRhJywgZnVuY3Rpb24oY2h1bmspIHsgcmVzICs9IGNodW5rOyB9KTtcbiAgICB0aGlzLm9uKCdlbmQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY2IobnVsbCwgcmVzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbn1cblxuIl19