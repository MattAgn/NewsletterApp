67a5c7e99b4212324a0258ad9d31034d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var compileRoute = require('./compile-route');

var FetchMock = {};

FetchMock.mock = function (matcher, response) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  var route;

  if (matcher && response) {
    route = (0, _extends2.default)({
      matcher: matcher,
      response: response
    }, options);
  } else if (matcher && matcher.matcher) {
    route = matcher;
  } else {
    throw new Error('fetch-mock: Invalid parameters passed to fetch-mock');
  }

  this.addRoute(route);
  return this._mock();
};

FetchMock.addRoute = function (uncompiledRoute) {
  var _this = this;

  var route = this.compileRoute(uncompiledRoute);
  var clashes = this.routes.filter(function (_ref) {
    var identifier = _ref.identifier,
        method = _ref.method;
    return identifier === route.identifier && (!method || !route.method || method === route.method);
  });
  var overwriteRoutes = 'overwriteRoutes' in route ? route.overwriteRoutes : this.config.overwriteRoutes;

  if (overwriteRoutes === false || !clashes.length) {
    this._uncompiledRoutes.push(uncompiledRoute);

    return this.routes.push(route);
  }

  if (overwriteRoutes === true) {
    clashes.forEach(function (clash) {
      var index = _this.routes.indexOf(clash);

      _this._uncompiledRoutes.splice(index, 1, uncompiledRoute);

      _this.routes.splice(index, 1, route);
    });
    return this.routes;
  }

  if (clashes.length) {
    throw new Error('fetch-mock: Adding route with same name or matcher as existing route. See `overwriteRoutes` option.');
  }

  this._uncompiledRoutes.push(uncompiledRoute);

  this.routes.push(route);
};

FetchMock._mock = function () {
  if (!this.isSandbox) {
    this.realFetch = this.realFetch || this.global.fetch;
    this.global.fetch = this.fetchHandler;
  }

  return this;
};

FetchMock.catch = function (response) {
  if (this.fallbackResponse) {
    console.warn('calling fetchMock.catch() twice - are you sure you want to overwrite the previous fallback response');
  }

  this.fallbackResponse = response || 'ok';
  return this._mock();
};

FetchMock.spy = function () {
  this._mock();

  return this.catch(this.getNativeFetch());
};

FetchMock.compileRoute = compileRoute;

FetchMock.once = function (matcher, response) {
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  return this.mock(matcher, response, (0, _extends2.default)({}, options, {
    repeat: 1
  }));
};

['get', 'post', 'put', 'delete', 'head', 'patch'].forEach(function (method) {
  var extendOptions = function extendOptions(options) {
    return (0, _extends2.default)({}, options, {
      method: method.toUpperCase()
    });
  };

  FetchMock[method] = function (matcher, response) {
    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    return this.mock(matcher, response, extendOptions(options));
  };

  FetchMock[method + "Once"] = function (matcher, response) {
    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
    return this.once(matcher, response, extendOptions(options));
  };
});

FetchMock.resetBehavior = function () {
  if (this.realFetch) {
    this.global.fetch = this.realFetch;
    this.realFetch = undefined;
  }

  this.fallbackResponse = undefined;
  this.routes = [];
  this._uncompiledRoutes = [];
  return this;
};

FetchMock.resetHistory = function () {
  this._calls = [];
  this._holdingPromises = [];
  this.routes.forEach(function (route) {
    return route.reset && route.reset();
  });
  return this;
};

FetchMock.restore = FetchMock.reset = function () {
  this.resetBehavior();
  this.resetHistory();
  return this;
};

module.exports = FetchMock;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNldC11cC1hbmQtdGVhci1kb3duLmpzIl0sIm5hbWVzIjpbImNvbXBpbGVSb3V0ZSIsInJlcXVpcmUiLCJGZXRjaE1vY2siLCJtb2NrIiwibWF0Y2hlciIsInJlc3BvbnNlIiwib3B0aW9ucyIsInJvdXRlIiwiRXJyb3IiLCJhZGRSb3V0ZSIsIl9tb2NrIiwidW5jb21waWxlZFJvdXRlIiwiY2xhc2hlcyIsInJvdXRlcyIsImZpbHRlciIsImlkZW50aWZpZXIiLCJtZXRob2QiLCJvdmVyd3JpdGVSb3V0ZXMiLCJjb25maWciLCJsZW5ndGgiLCJfdW5jb21waWxlZFJvdXRlcyIsInB1c2giLCJmb3JFYWNoIiwiY2xhc2giLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJpc1NhbmRib3giLCJyZWFsRmV0Y2giLCJnbG9iYWwiLCJmZXRjaCIsImZldGNoSGFuZGxlciIsImNhdGNoIiwiZmFsbGJhY2tSZXNwb25zZSIsImNvbnNvbGUiLCJ3YXJuIiwic3B5IiwiZ2V0TmF0aXZlRmV0Y2giLCJvbmNlIiwicmVwZWF0IiwiZXh0ZW5kT3B0aW9ucyIsInRvVXBwZXJDYXNlIiwicmVzZXRCZWhhdmlvciIsInVuZGVmaW5lZCIsInJlc2V0SGlzdG9yeSIsIl9jYWxscyIsIl9ob2xkaW5nUHJvbWlzZXMiLCJyZXNldCIsInJlc3RvcmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsSUFBTUEsWUFBWSxHQUFHQyxPQUFPLENBQUMsaUJBQUQsQ0FBNUI7O0FBQ0EsSUFBTUMsU0FBUyxHQUFHLEVBQWxCOztBQUVBQSxTQUFTLENBQUNDLElBQVYsR0FBaUIsVUFBU0MsT0FBVCxFQUFrQkMsUUFBbEIsRUFBMEM7QUFBQSxNQUFkQyxPQUFjLHVFQUFKLEVBQUk7QUFDMUQsTUFBSUMsS0FBSjs7QUFHQSxNQUFJSCxPQUFPLElBQUlDLFFBQWYsRUFBeUI7QUFDeEJFLElBQUFBLEtBQUssR0FBRyx1QkFDUDtBQUNDSCxNQUFBQSxPQUFPLEVBQVBB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LEVBQUk7QUFDdEUsV0FBTyxLQUFLZ0MsSUFBTCxDQUFVbEMsT0FBVixFQUFtQkMsUUFBbkIsRUFBNkJtQyxhQUFhLENBQUNsQyxPQUFELENBQTFDLENBQVA7QUFDQSxHQUZEO0FBR0EsQ0FWRDs7QUFZQUosU0FBUyxDQUFDd0MsYUFBVixHQUEwQixZQUFXO0FBQ3BDLE1BQUksS0FBS2QsU0FBVCxFQUFvQjtBQUNuQixTQUFLQyxNQUFMLENBQVlDLEtBQVosR0FBb0IsS0FBS0YsU0FBekI7QUFDQSxTQUFLQSxTQUFMLEdBQWlCZSxTQUFqQjtBQUNBOztBQUNELE9BQUtWLGdCQUFMLEdBQXdCVSxTQUF4QjtBQUNBLE9BQUs5QixNQUFMLEdBQWMsRUFBZDtBQUNBLE9BQUtPLGlCQUFMLEdBQXlCLEVBQXpCO0FBQ0EsU0FBTyxJQUFQO0FBQ0EsQ0FURDs7QUFXQWxCLFNBQVMsQ0FBQzBDLFlBQVYsR0FBeUIsWUFBVztBQUNuQyxPQUFLQyxNQUFMLEdBQWMsRUFBZDtBQUNBLE9BQUtDLGdCQUFMLEdBQXdCLEVBQXhCO0FBQ0EsT0FBS2pDLE1BQUwsQ0FBWVMsT0FBWixDQUFvQixVQUFBZixLQUFLO0FBQUEsV0FBSUEsS0FBSyxDQUFDd0MsS0FBTixJQUFleEMsS0FBSyxDQUFDd0MsS0FBTixFQUFuQjtBQUFBLEdBQXpCO0FBQ0EsU0FBTyxJQUFQO0FBQ0EsQ0FMRDs7QUFPQTdDLFNBQVMsQ0FBQzhDLE9BQVYsR0FBb0I5QyxTQUFTLENBQUM2QyxLQUFWLEdBQWtCLFlBQVc7QUFDaEQsT0FBS0wsYUFBTDtBQUNBLE9BQUtFLFlBQUw7QUFDQSxTQUFPLElBQVA7QUFDQSxDQUpEOztBQU1BSyxNQUFNLENBQUNDLE9BQVAsR0FBaUJoRCxTQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNvbXBpbGVSb3V0ZSA9IHJlcXVpcmUoJy4vY29tcGlsZS1yb3V0ZScpO1xuY29uc3QgRmV0Y2hNb2NrID0ge307XG5cbkZldGNoTW9jay5tb2NrID0gZnVuY3Rpb24obWF0Y2hlciwgcmVzcG9uc2UsIG9wdGlvbnMgPSB7fSkge1xuXHRsZXQgcm91dGU7XG5cblx0Ly8gSGFuZGxlIHRoZSB2YXJpZXR5IG9mIHBhcmFtZXRlcnMgYWNjZXB0ZWQgYnkgbW9jayAoc2VlIFJFQURNRSlcblx0aWYgKG1hdGNoZXIgJiYgcmVzcG9uc2UpIHtcblx0XHRyb3V0ZSA9IE9iamVjdC5hc3NpZ24oXG5cdFx0XHR7XG5cdFx0XHRcdG1hdGNoZXIsXG5cdFx0XHRcdHJlc3BvbnNlXG5cdFx0XHR9LFxuXHRcdFx0b3B0aW9uc1xuXHRcdCk7XG5cdH0gZWxzZSBpZiAobWF0Y2hlciAmJiBtYXRjaGVyLm1hdGNoZXIpIHtcblx0XHRyb3V0ZSA9IG1hdGNoZXI7XG5cdH0gZWxzZSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdmZXRjaC1tb2NrOiBJbnZhbGlkIHBhcmFtZXRlcnMgcGFzc2VkIHRvIGZldGNoLW1vY2snKTtcblx0fVxuXG5cdHRoaXMuYWRkUm91dGUocm91dGUpO1xuXG5cdHJldHVybiB0aGlzLl9tb2NrKCk7XG59O1xuXG5GZXRjaE1vY2suYWRkUm91dGUgPSBmdW5jdGlvbih1bmNvbXBpbGVkUm91dGUpIHtcblx0Y29uc3Qgcm91dGUgPSB0aGlzLmNvbXBpbGVSb3V0ZSh1bmNvbXBpbGVkUm91dGUpO1xuXHRjb25zdCBjbGFzaGVzID0gdGhpcy5yb3V0ZXMuZmlsdGVyKFxuXHRcdCh7IGlkZW50aWZpZXIsIG1ldGhvZCB9KSA9PlxuXHRcdFx0aWRlbnRpZmllciA9PT0gcm91dGUuaWRlbnRpZmllciAmJlxuXHRcdFx0KCFtZXRob2QgfHwgIXJvdXRlLm1ldGhvZCB8fCBtZXRob2QgPT09IHJvdXRlLm1ldGhvZClcblx0KTtcblxuXHRjb25zdCBvdmVyd3JpdGVSb3V0ZXMgPVxuXHRcdCdvdmVyd3JpdGVSb3V0ZXMnIGluIHJvdXRlXG5cdFx0XHQ/IHJvdXRlLm92ZXJ3cml0ZVJvdXRlc1xuXHRcdFx0OiB0aGlzLmNvbmZpZy5vdmVyd3JpdGVSb3V0ZXM7XG5cblx0aWYgKG92ZXJ3cml0ZVJvdXRlcyA9PT0gZmFsc2UgfHwgIWNsYXNoZXMubGVuZ3RoKSB7XG5cdFx0dGhpcy5fdW5jb21waWxlZFJvdXRlcy5wdXNoKHVuY29tcGlsZWRSb3V0ZSk7XG5cdFx0cmV0dXJuIHRoaXMucm91dGVzLnB1c2gocm91dGUpO1xuXHR9XG5cblx0aWYgKG92ZXJ3cml0ZVJvdXRlcyA9PT0gdHJ1ZSkge1xuXHRcdGNsYXNoZXMuZm9yRWFjaChjbGFzaCA9PiB7XG5cdFx0XHRjb25zdCBpbmRleCA9IHRoaXMucm91dGVzLmluZGV4T2YoY2xhc2gpO1xuXHRcdFx0dGhpcy5fdW5jb21waWxlZFJvdXRlcy5zcGxpY2UoaW5kZXgsIDEsIHVuY29tcGlsZWRSb3V0ZSk7XG5cdFx0XHR0aGlzLnJvdXRlcy5zcGxpY2UoaW5kZXgsIDEsIHJvdXRlKTtcblx0XHR9KTtcblxuXHRcdHJldHVybiB0aGlzLnJvdXRlcztcblx0fVxuXG5cdGlmIChjbGFzaGVzLmxlbmd0aCkge1xuXHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdCdmZXRjaC1tb2NrOiBBZGRpbmcgcm91dGUgd2l0aCBzYW1lIG5hbWUgb3IgbWF0Y2hlciBhcyBleGlzdGluZyByb3V0ZS4gU2VlIGBvdmVyd3JpdGVSb3V0ZXNgIG9wdGlvbi4nXG5cdFx0KTtcblx0fVxuXG5cdHRoaXMuX3VuY29tcGlsZWRSb3V0ZXMucHVzaCh1bmNvbXBpbGVkUm91dGUpO1xuXHR0aGlzLnJvdXRlcy5wdXNoKHJvdXRlKTtcbn07XG5cbkZldGNoTW9jay5fbW9jayA9IGZ1bmN0aW9uKCkge1xuXHRpZiAoIXRoaXMuaXNTYW5kYm94KSB7XG5cdFx0Ly8gRG8gdGhpcyBoZXJlIHJhdGhlciB0aGFuIGluIHRoZSBjb25zdHJ1Y3RvciB0byBlbnN1cmUgaXQncyBzY29wZWQgdG8gdGhlIHRlc3Rcblx0XHR0aGlzLnJlYWxGZXRjaCA9IHRoaXMucmVhbEZldGNoIHx8IHRoaXMuZ2xvYmFsLmZldGNoO1xuXHRcdHRoaXMuZ2xvYmFsLmZldGNoID0gdGhpcy5mZXRjaEhhbmRsZXI7XG5cdH1cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5GZXRjaE1vY2suY2F0Y2ggPSBmdW5jdGlvbihyZXNwb25zZSkge1xuXHRpZiAodGhpcy5mYWxsYmFja1Jlc3BvbnNlKSB7XG5cdFx0Y29uc29sZS53YXJuKFxuXHRcdFx0J2NhbGxpbmcgZmV0Y2hNb2NrLmNhdGNoKCkgdHdpY2UgLSBhcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gb3ZlcndyaXRlIHRoZSBwcmV2aW91cyBmYWxsYmFjayByZXNwb25zZSdcblx0XHQpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG5cdH1cblx0dGhpcy5mYWxsYmFja1Jlc3BvbnNlID0gcmVzcG9uc2UgfHwgJ29rJztcblx0cmV0dXJuIHRoaXMuX21vY2soKTtcbn07XG5cbkZldGNoTW9jay5zcHkgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5fbW9jaygpO1xuXHRyZXR1cm4gdGhpcy5jYXRjaCh0aGlzLmdldE5hdGl2ZUZldGNoKCkpO1xufTtcblxuRmV0Y2hNb2NrLmNvbXBpbGVSb3V0ZSA9IGNvbXBpbGVSb3V0ZTtcblxuRmV0Y2hNb2NrLm9uY2UgPSBmdW5jdGlvbihtYXRjaGVyLCByZXNwb25zZSwgb3B0aW9ucyA9IHt9KSB7XG5cdHJldHVybiB0aGlzLm1vY2soXG5cdFx0bWF0Y2hlcixcblx0XHRyZXNwb25zZSxcblx0XHRPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zLCB7IHJlcGVhdDogMSB9KVxuXHQpO1xufTtcblxuWydnZXQnLCAncG9zdCcsICdwdXQnLCAnZGVsZXRlJywgJ2hlYWQnLCAncGF0Y2gnXS5mb3JFYWNoKG1ldGhvZCA9PiB7XG5cdGNvbnN0IGV4dGVuZE9wdGlvbnMgPSBvcHRpb25zID0+XG5cdFx0T2JqZWN0LmFzc2lnbih7fSwgb3B0aW9ucywgeyBtZXRob2Q6IG1ldGhvZC50b1VwcGVyQ2FzZSgpIH0pO1xuXG5cdEZldGNoTW9ja1ttZXRob2RdID0gZnVuY3Rpb24obWF0Y2hlciwgcmVzcG9uc2UsIG9wdGlvbnMgPSB7fSkge1xuXHRcdHJldHVybiB0aGlzLm1vY2sobWF0Y2hlciwgcmVzcG9uc2UsIGV4dGVuZE9wdGlvbnMob3B0aW9ucykpO1xuXHR9O1xuXHRGZXRjaE1vY2tbYCR7bWV0aG9kfU9uY2VgXSA9IGZ1bmN0aW9uKG1hdGNoZXIsIHJlc3BvbnNlLCBvcHRpb25zID0ge30pIHtcblx0XHRyZXR1cm4gdGhpcy5vbmNlKG1hdGNoZXIsIHJlc3BvbnNlLCBleHRlbmRPcHRpb25zKG9wdGlvbnMpKTtcblx0fTtcbn0pO1xuXG5GZXRjaE1vY2sucmVzZXRCZWhhdmlvciA9IGZ1bmN0aW9uKCkge1xuXHRpZiAodGhpcy5yZWFsRmV0Y2gpIHtcblx0XHR0aGlzLmdsb2JhbC5mZXRjaCA9IHRoaXMucmVhbEZldGNoO1xuXHRcdHRoaXMucmVhbEZldGNoID0gdW5kZWZpbmVkO1xuXHR9XG5cdHRoaXMuZmFsbGJhY2tSZXNwb25zZSA9IHVuZGVmaW5lZDtcblx0dGhpcy5yb3V0ZXMgPSBbXTtcblx0dGhpcy5fdW5jb21waWxlZFJvdXRlcyA9IFtdO1xuXHRyZXR1cm4gdGhpcztcbn07XG5cbkZldGNoTW9jay5yZXNldEhpc3RvcnkgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5fY2FsbHMgPSBbXTtcblx0dGhpcy5faG9sZGluZ1Byb21pc2VzID0gW107XG5cdHRoaXMucm91dGVzLmZvckVhY2gocm91dGUgPT4gcm91dGUucmVzZXQgJiYgcm91dGUucmVzZXQoKSk7XG5cdHJldHVybiB0aGlzO1xufTtcblxuRmV0Y2hNb2NrLnJlc3RvcmUgPSBGZXRjaE1vY2sucmVzZXQgPSBmdW5jdGlvbigpIHtcblx0dGhpcy5yZXNldEJlaGF2aW9yKCk7XG5cdHRoaXMucmVzZXRIaXN0b3J5KCk7XG5cdHJldHVybiB0aGlzO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBGZXRjaE1vY2s7XG4iXX0=