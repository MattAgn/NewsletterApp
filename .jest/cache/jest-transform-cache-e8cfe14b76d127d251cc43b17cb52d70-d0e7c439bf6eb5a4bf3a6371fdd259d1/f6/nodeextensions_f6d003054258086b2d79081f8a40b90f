618f37ffb9feea5d3e723b5a1edb1e31
'use strict';

var Promise = require('./core.js');

var asap = require('asap');

module.exports = Promise;

Promise.denodeify = function (fn, argumentCount) {
  if (typeof argumentCount === 'number' && argumentCount !== Infinity) {
    return denodeifyWithCount(fn, argumentCount);
  } else {
    return denodeifyWithoutCount(fn);
  }
};

var callbackFn = 'function (err, res) {' + 'if (err) { rj(err); } else { rs(res); }' + '}';

function denodeifyWithCount(fn, argumentCount) {
  var args = [];

  for (var i = 0; i < argumentCount; i++) {
    args.push('a' + i);
  }

  var body = ['return function (' + args.join(',') + ') {', 'var self = this;', 'return new Promise(function (rs, rj) {', 'var res = fn.call(', ['self'].concat(args).concat([callbackFn]).join(','), ');', 'if (res &&', '(typeof res === "object" || typeof res === "function") &&', 'typeof res.then === "function"', ') {rs(res);}', '});', '};'].join('');
  return Function(['Promise', 'fn'], body)(Promise, fn);
}

function denodeifyWithoutCount(fn) {
  var fnLength = Math.max(fn.length - 1, 3);
  var args = [];

  for (var i = 0; i < fnLength; i++) {
    args.push('a' + i);
  }

  var body = ['return function (' + args.join(',') + ') {', 'var self = this;', 'var args;', 'var argLength = arguments.length;', 'if (arguments.length > ' + fnLength + ') {', 'args = new Array(arguments.length + 1);', 'for (var i = 0; i < arguments.length; i++) {', 'args[i] = arguments[i];', '}', '}', 'return new Promise(function (rs, rj) {', 'var cb = ' + callbackFn + ';', 'var res;', 'switch (argLength) {', args.concat(['extra']).map(function (_, index) {
    return 'case ' + index + ':' + 'res = fn.call(' + ['self'].concat(args.slice(0, index)).concat('cb').join(',') + ');' + 'break;';
  }).join(''), 'default:', 'args[argLength] = cb;', 'res = fn.apply(self, args);', '}', 'if (res &&', '(typeof res === "object" || typeof res === "function") &&', 'typeof res.then === "function"', ') {rs(res);}', '});', '};'].join('');
  return Function(['Promise', 'fn'], body)(Promise, fn);
}

Promise.nodeify = function (fn) {
  return function () {
    var args = Array.prototype.slice.call(arguments);
    var callback = typeof args[args.length - 1] === 'function' ? args.pop() : null;
    var ctx = this;

    try {
      return fn.apply(this, arguments).nodeify(callback, ctx);
    } catch (ex) {
      if (callback === null || typeof callback == 'undefined') {
        return new Promise(function (resolve, reject) {
          reject(ex);
        });
      } else {
        asap(function () {
          callback.call(ctx, ex);
        });
      }
    }
  };
};

Promise.prototype.nodeify = function (callback, ctx) {
  if (typeof callback != 'function') return this;
  this.then(function (value) {
    asap(function () {
      callback.call(ctx, null, value);
    });
  }, function (err) {
    asap(function () {
      callback.call(ctx, err);
    });
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGUtZXh0ZW5zaW9ucy5qcyJdLCJuYW1lcyI6WyJQcm9taXNlIiwicmVxdWlyZSIsImFzYXAiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVub2RlaWZ5IiwiZm4iLCJhcmd1bWVudENvdW50IiwiSW5maW5pdHkiLCJkZW5vZGVpZnlXaXRoQ291bnQiLCJkZW5vZGVpZnlXaXRob3V0Q291bnQiLCJjYWxsYmFja0ZuIiwiYXJncyIsImkiLCJwdXNoIiwiYm9keSIsImpvaW4iLCJjb25jYXQiLCJGdW5jdGlvbiIsImZuTGVuZ3RoIiwiTWF0aCIsIm1heCIsImxlbmd0aCIsIm1hcCIsIl8iLCJpbmRleCIsInNsaWNlIiwibm9kZWlmeSIsIkFycmF5IiwicHJvdG90eXBlIiwiY2FsbCIsImFyZ3VtZW50cyIsImNhbGxiYWNrIiwicG9wIiwiY3R4IiwiYXBwbHkiLCJleCIsInJlc29sdmUiLCJyZWplY3QiLCJ0aGVuIiwidmFsdWUiLCJlcnIiXSwibWFwcGluZ3MiOiJBQUFBOztBQUtBLElBQUlBLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBckI7O0FBQ0EsSUFBSUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsTUFBRCxDQUFsQjs7QUFFQUUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCSixPQUFqQjs7QUFJQUEsT0FBTyxDQUFDSyxTQUFSLEdBQW9CLFVBQVVDLEVBQVYsRUFBY0MsYUFBZCxFQUE2QjtBQUMvQyxNQUNFLE9BQU9BLGFBQVAsS0FBeUIsUUFBekIsSUFBcUNBLGFBQWEsS0FBS0MsUUFEekQsRUFFRTtBQUNBLFdBQU9DLGtCQUFrQixDQUFDSCxFQUFELEVBQUtDLGFBQUwsQ0FBekI7QUFDRCxHQUpELE1BSU87QUFDTCxXQUFPRyxxQkFBcUIsQ0FBQ0osRUFBRCxDQUE1QjtBQUNEO0FBQ0YsQ0FSRDs7QUFVQSxJQUFJSyxVQUFVLEdBQ1osMEJBQ0EseUNBREEsR0FFQSxHQUhGOztBQUtBLFNBQVNGLGtCQUFULENBQTRCSCxFQUE1QixFQUFnQ0MsYUFBaEMs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LEtBRkcsQ0FBSjtBQUdELEdBSkQsRUFJRyxVQUFVQyxHQUFWLEVBQWU7QUFDaEJ2QyxJQUFBQSxJQUFJLENBQUMsWUFBWTtBQUNmOEIsTUFBQUEsUUFBUSxDQUFDRixJQUFULENBQWNJLEdBQWQsRUFBbUJPLEdBQW5CO0FBQ0QsS0FGRyxDQUFKO0FBR0QsR0FSRDtBQVNELENBWkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbi8vIFRoaXMgZmlsZSBjb250YWlucyB0aGVuL3Byb21pc2Ugc3BlY2lmaWMgZXh0ZW5zaW9ucyB0aGF0IGFyZSBvbmx5IHVzZWZ1bFxuLy8gZm9yIG5vZGUuanMgaW50ZXJvcFxuXG52YXIgUHJvbWlzZSA9IHJlcXVpcmUoJy4vY29yZS5qcycpO1xudmFyIGFzYXAgPSByZXF1aXJlKCdhc2FwJyk7XG5cbm1vZHVsZS5leHBvcnRzID0gUHJvbWlzZTtcblxuLyogU3RhdGljIEZ1bmN0aW9ucyAqL1xuXG5Qcm9taXNlLmRlbm9kZWlmeSA9IGZ1bmN0aW9uIChmbiwgYXJndW1lbnRDb3VudCkge1xuICBpZiAoXG4gICAgdHlwZW9mIGFyZ3VtZW50Q291bnQgPT09ICdudW1iZXInICYmIGFyZ3VtZW50Q291bnQgIT09IEluZmluaXR5XG4gICkge1xuICAgIHJldHVybiBkZW5vZGVpZnlXaXRoQ291bnQoZm4sIGFyZ3VtZW50Q291bnQpO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBkZW5vZGVpZnlXaXRob3V0Q291bnQoZm4pO1xuICB9XG59O1xuXG52YXIgY2FsbGJhY2tGbiA9IChcbiAgJ2Z1bmN0aW9uIChlcnIsIHJlcykgeycgK1xuICAnaWYgKGVycikgeyByaihlcnIpOyB9IGVsc2UgeyBycyhyZXMpOyB9JyArXG4gICd9J1xuKTtcbmZ1bmN0aW9uIGRlbm9kZWlmeVdpdGhDb3VudChmbiwgYXJndW1lbnRDb3VudCkge1xuICB2YXIgYXJncyA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGFyZ3VtZW50Q291bnQ7IGkrKykge1xuICAgIGFyZ3MucHVzaCgnYScgKyBpKTtcbiAgfVxuICB2YXIgYm9keSA9IFtcbiAgICAncmV0dXJuIGZ1bmN0aW9uICgnICsgYXJncy5qb2luKCcsJykgKyAnKSB7JyxcbiAgICAndmFyIHNlbGYgPSB0aGlzOycsXG4gICAgJ3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocnMsIHJqKSB7JyxcbiAgICAndmFyIHJlcyA9IGZuLmNhbGwoJyxcbiAgICBbJ3NlbGYnXS5jb25jYXQoYXJncykuY29uY2F0KFtjYWxsYmFja0ZuXSkuam9pbignLCcpLFxuICAgICcpOycsXG4gICAgJ2lmIChyZXMgJiYnLFxuICAgICcodHlwZW9mIHJlcyA9PT0gXCJvYmplY3RcIiB8fCB0eXBlb2YgcmVzID09PSBcImZ1bmN0aW9uXCIpICYmJyxcbiAgICAndHlwZW9mIHJlcy50aGVuID09PSBcImZ1bmN0aW9uXCInLFxuICAgICcpIHtycyhyZXMpO30nLFxuICAgICd9KTsnLFxuICAgICd9OydcbiAgXS5qb2luKCcnKTtcbiAgcmV0dXJuIEZ1bmN0aW9uKFsnUHJvbWlzZScsICdmbiddLCBib2R5KShQcm9taXNlLCBmbik7XG59XG5mdW5jdGlvbiBkZW5vZGVpZnlXaXRob3V0Q291bnQoZm4pIHtcbiAgdmFyIGZuTGVuZ3RoID0gTWF0aC5tYXgoZm4ubGVuZ3RoIC0gMSwgMyk7XG4gIHZhciBhcmdzID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgZm5MZW5ndGg7IGkrKykge1xuICAgIGFyZ3MucHVzaCgnYScgKyBpKTtcbiAgfVxuICB2YXIgYm9keSA9IFtcbiAgICAncmV0dXJuIGZ1bmN0aW9uICgnICsgYXJncy5qb2luKCcsJykgKyAnKSB7JyxcbiAgICAndmFyIHNlbGYgPSB0aGlzOycsXG4gICAgJ3ZhciBhcmdzOycsXG4gICAgJ3ZhciBhcmdMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOycsXG4gICAgJ2lmIChhcmd1bWVudHMubGVuZ3RoID4gJyArIGZuTGVuZ3RoICsgJykgeycsXG4gICAgJ2FyZ3MgPSBuZXcgQXJyYXkoYXJndW1lbnRzLmxlbmd0aCArIDEpOycsXG4gICAgJ2ZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7JyxcbiAgICAnYXJnc1tpXSA9IGFyZ3VtZW50c1tpXTsnLFxuICAgICd9JyxcbiAgICAnfScsXG4gICAgJ3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocnMsIHJqKSB7JyxcbiAgICAndmFyIGNiID0gJyArIGNhbGxiYWNrRm4gKyAnOycsXG4gICAgJ3ZhciByZXM7JyxcbiAgICAnc3dpdGNoIChhcmdMZW5ndGgpIHsnLFxuICAgIGFyZ3MuY29uY2F0KFsnZXh0cmEnXSkubWFwKGZ1bmN0aW9uIChfLCBpbmRleCkge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgJ2Nhc2UgJyArIChpbmRleCkgKyAnOicgK1xuICAgICAgICAncmVzID0gZm4uY2FsbCgnICsgWydzZWxmJ10uY29uY2F0KGFyZ3Muc2xpY2UoMCwgaW5kZXgpKS5jb25jYXQoJ2NiJykuam9pbignLCcpICsgJyk7JyArXG4gICAgICAgICdicmVhazsnXG4gICAgICApO1xuICAgIH0pLmpvaW4oJycpLFxuICAgICdkZWZhdWx0OicsXG4gICAgJ2FyZ3NbYXJnTGVuZ3RoXSA9IGNiOycsXG4gICAgJ3JlcyA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpOycsXG4gICAgJ30nLFxuICAgIFxuICAgICdpZiAocmVzICYmJyxcbiAgICAnKHR5cGVvZiByZXMgPT09IFwib2JqZWN0XCIgfHwgdHlwZW9mIHJlcyA9PT0gXCJmdW5jdGlvblwiKSAmJicsXG4gICAgJ3R5cGVvZiByZXMudGhlbiA9PT0gXCJmdW5jdGlvblwiJyxcbiAgICAnKSB7cnMocmVzKTt9JyxcbiAgICAnfSk7JyxcbiAgICAnfTsnXG4gIF0uam9pbignJyk7XG5cbiAgcmV0dXJuIEZ1bmN0aW9uKFxuICAgIFsnUHJvbWlzZScsICdmbiddLFxuICAgIGJvZHlcbiAgKShQcm9taXNlLCBmbik7XG59XG5cblByb21pc2Uubm9kZWlmeSA9IGZ1bmN0aW9uIChmbikge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICB2YXIgY2FsbGJhY2sgPVxuICAgICAgdHlwZW9mIGFyZ3NbYXJncy5sZW5ndGggLSAxXSA9PT0gJ2Z1bmN0aW9uJyA/IGFyZ3MucG9wKCkgOiBudWxsO1xuICAgIHZhciBjdHggPSB0aGlzO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKS5ub2RlaWZ5KGNhbGxiYWNrLCBjdHgpO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICBpZiAoY2FsbGJhY2sgPT09IG51bGwgfHwgdHlwZW9mIGNhbGxiYWNrID09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgcmVqZWN0KGV4KTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhc2FwKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjay5jYWxsKGN0eCwgZXgpO1xuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuUHJvbWlzZS5wcm90b3R5cGUubm9kZWlmeSA9IGZ1bmN0aW9uIChjYWxsYmFjaywgY3R4KSB7XG4gIGlmICh0eXBlb2YgY2FsbGJhY2sgIT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHRoaXM7XG5cbiAgdGhpcy50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGFzYXAoZnVuY3Rpb24gKCkge1xuICAgICAgY2FsbGJhY2suY2FsbChjdHgsIG51bGwsIHZhbHVlKTtcbiAgICB9KTtcbiAgfSwgZnVuY3Rpb24gKGVycikge1xuICAgIGFzYXAoZnVuY3Rpb24gKCkge1xuICAgICAgY2FsbGJhY2suY2FsbChjdHgsIGVycik7XG4gICAgfSk7XG4gIH0pO1xufTtcbiJdfQ==