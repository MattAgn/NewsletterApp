9f324ea23070bd8637fe429a01c7f661
module.exports = pathToRegexp;
module.exports.parse = parse;
module.exports.compile = compile;
module.exports.tokensToFunction = tokensToFunction;
module.exports.tokensToRegExp = tokensToRegExp;
var DEFAULT_DELIMITER = '/';
var DEFAULT_DELIMITERS = './';
var PATH_REGEXP = new RegExp(['(\\\\.)', '(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?'].join('|'), 'g');

function parse(str, options) {
  var tokens = [];
  var key = 0;
  var index = 0;
  var path = '';
  var defaultDelimiter = options && options.delimiter || DEFAULT_DELIMITER;
  var delimiters = options && options.delimiters || DEFAULT_DELIMITERS;
  var pathEscaped = false;
  var res;

  while ((res = PATH_REGEXP.exec(str)) !== null) {
    var m = res[0];
    var escaped = res[1];
    var offset = res.index;
    path += str.slice(index, offset);
    index = offset + m.length;

    if (escaped) {
      path += escaped[1];
      pathEscaped = true;
      continue;
    }

    var prev = '';
    var next = str[index];
    var name = res[2];
    var capture = res[3];
    var group = res[4];
    var modifier = res[5];

    if (!pathEscaped && path.length) {
      var k = path.length - 1;

      if (delimiters.indexOf(path[k]) > -1) {
        prev = path[k];
        path = path.slice(0, k);
      }
    }

    if (path) {
      tokens.push(path);
      path = '';
      pathEscaped = false;
    }

    var partial = prev !== '' && next !== undefined && next !== prev;
    var repeat = modifier === '+' || modifier === '*';
    var optional = modifier === '?' || modifier === '*';
    var delimiter = prev || defaultDelimiter;
    var pattern = capture || group;
    tokens.push({
      name: name || key++,
      prefix: prev,
      delimiter: delimiter,
      optional: optional,
      repeat: repeat,
      partial: partial,
      pattern: pattern ? escapeGroup(pattern) : '[^' + escapeString(delimiter) + ']+?'
    });
  }

  if (path || index < str.length) {
    tokens.push(path + str.substr(index));
  }

  return tokens;
}

function compile(str, options) {
  return tokensToFunction(parse(str, options));
}

function tokensToFunction(tokens) {
  var matches = new Array(tokens.length);

  for (var i = 0; i < tokens.length; i++) {
    if (typeof tokens[i] === 'object') {
      matches[i] = new RegExp('^(?:' + tokens[i].pattern + ')$');
    }
  }

  return function (data, options) {
    var path = '';
    var encode = options && options.encode || encodeURIComponent;

    for (var i = 0; i < tokens.length; i++) {
      var token = tokens[i];

      if (typeof token === 'string') {
        path += token;
        continue;
      }

      var value = data ? data[token.name] : undefined;
      var segment;

      if (Array.isArray(value)) {
        if (!token.repeat) {
          throw new TypeError('Expected "' + token.name + '" to not repeat, but got array');
        }

        if (value.length === 0) {
          if (token.optional) continue;
          throw new TypeError('Expected "' + token.name + '" to not be empty');
        }

        for (var j = 0; j < value.length; j++) {
          segment = encode(value[j], token);

          if (!matches[i].test(segment)) {
            throw new TypeError('Expected all "' + token.name + '" to match "' + token.pattern + '"');
          }

          path += (j === 0 ? token.prefix : token.delimiter) + segment;
        }

        continue;
      }

      if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {
        segment = encode(String(value), token);

        if (!matches[i].test(segment)) {
          throw new TypeError('Expected "' + token.name + '" to match "' + token.pattern + '", but got "' + segment + '"');
        }

        path += token.prefix + segment;
        continue;
      }

      if (token.optional) {
        if (token.partial) path += token.prefix;
        continue;
      }

      throw new TypeError('Expected "' + token.name + '" to be ' + (token.repeat ? 'an array' : 'a string'));
    }

    return path;
  };
}

function escapeString(str) {
  return str.replace(/([.+*?=^!:${}()[\]|/\\])/g, '\\$1');
}

function escapeGroup(group) {
  return group.replace(/([=!:$/()])/g, '\\$1');
}

function flags(options) {
  return options && options.sensitive ? '' : 'i';
}

function regexpToRegexp(path, keys) {
  if (!keys) return path;
  var groups = path.source.match(/\((?!\?)/g);

  if (groups) {
    for (var i = 0; i < groups.length; i++) {
      keys.push({
        name: i,
        prefix: null,
        delimiter: null,
        optional: false,
        repeat: false,
        partial: false,
        pattern: null
      });
    }
  }

  return path;
}

function arrayToRegexp(path, keys, options) {
  var parts = [];

  for (var i = 0; i < path.length; i++) {
    parts.push(pathToRegexp(path[i], keys, options).source);
  }

  return new RegExp('(?:' + parts.join('|') + ')', flags(options));
}

function stringToRegexp(path, keys, options) {
  return tokensToRegExp(parse(path, options), keys, options);
}

function tokensToRegExp(tokens, keys, options) {
  options = options || {};
  var strict = options.strict;
  var start = options.start !== false;
  var end = options.end !== false;
  var delimiter = escapeString(options.delimiter || DEFAULT_DELIMITER);
  var delimiters = options.delimiters || DEFAULT_DELIMITERS;
  var endsWith = [].concat(options.endsWith || []).map(escapeString).concat('$').join('|');
  var route = start ? '^' : '';
  var isEndDelimited = tokens.length === 0;

  for (var i = 0; i < tokens.length; i++) {
    var token = tokens[i];

    if (typeof token === 'string') {
      route += escapeString(token);
      isEndDelimited = i === tokens.length - 1 && delimiters.indexOf(token[token.length - 1]) > -1;
    } else {
      var capture = token.repeat ? '(?:' + token.pattern + ')(?:' + escapeString(token.delimiter) + '(?:' + token.pattern + '))*' : token.pattern;
      if (keys) keys.push(token);

      if (token.optional) {
        if (token.partial) {
          route += escapeString(token.prefix) + '(' + capture + ')?';
        } else {
          route += '(?:' + escapeString(token.prefix) + '(' + capture + '))?';
        }
      } else {
        route += escapeString(token.prefix) + '(' + capture + ')';
      }
    }
  }

  if (end) {
    if (!strict) route += '(?:' + delimiter + ')?';
    route += endsWith === '$' ? '$' : '(?=' + endsWith + ')';
  } else {
    if (!strict) route += '(?:' + delimiter + '(?=' + endsWith + '))?';
    if (!isEndDelimited) route += '(?=' + delimiter + '|' + endsWith + ')';
  }

  return new RegExp(route, flags(options));
}

function pathToRegexp(path, keys, options) {
  if (path instanceof RegExp) {
    return regexpToRegexp(path, keys);
  }

  if (Array.isArray(path)) {
    return arrayToRegexp(path, keys, options);
  }

  return stringToRegexp(path, keys, options);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIm1vZHVsZSIsImV4cG9ydHMiLCJwYXRoVG9SZWdleHAiLCJwYXJzZSIsImNvbXBpbGUiLCJ0b2tlbnNUb0Z1bmN0aW9uIiwidG9rZW5zVG9SZWdFeHAiLCJERUZBVUxUX0RFTElNSVRFUiIsIkRFRkFVTFRfREVMSU1JVEVSUyIsIlBBVEhfUkVHRVhQIiwiUmVnRXhwIiwiam9pbiIsInN0ciIsIm9wdGlvbnMiLCJ0b2tlbnMiLCJrZXkiLCJpbmRleCIsInBhdGgiLCJkZWZhdWx0RGVsaW1pdGVyIiwiZGVsaW1pdGVyIiwiZGVsaW1pdGVycyIsInBhdGhFc2NhcGVkIiwicmVzIiwiZXhlYyIsIm0iLCJlc2NhcGVkIiwib2Zmc2V0Iiwic2xpY2UiLCJsZW5ndGgiLCJwcmV2IiwibmV4dCIsIm5hbWUiLCJjYXB0dXJlIiwiZ3JvdXAiLCJtb2RpZmllciIsImsiLCJpbmRleE9mIiwicHVzaCIsInBhcnRpYWwiLCJ1bmRlZmluZWQiLCJyZXBlYXQiLCJvcHRpb25hbCIsInBhdHRlcm4iLCJwcmVmaXgiLCJlc2NhcGVHcm91cCIsImVzY2FwZVN0cmluZyIsInN1YnN0ciIsIm1hdGNoZXMiLCJBcnJheSIsImkiLCJkYXRhIiwiZW5jb2RlIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwidG9rZW4iLCJ2YWx1ZSIsInNlZ21lbnQiLCJpc0FycmF5IiwiVHlwZUVycm9yIiwiaiIsInRlc3QiLCJTdHJpbmciLCJyZXBsYWNlIiwiZmxhZ3MiLCJzZW5zaXRpdmUiLCJyZWdleHBUb1JlZ2V4cCIsImtleXMiLCJncm91cHMiLCJzb3VyY2UiLCJtYXRjaCIsImFycmF5VG9SZWdleHAiLCJwYXJ0cyIsInN0cmluZ1RvUmVnZXhwIiwic3RyaWN0Iiwic3RhcnQiLCJlbmQiLCJlbmRzV2l0aCIsImNvbmNhdCIsIm1hcCIsInJvdXRlIiwiaXNFbmREZWxpbWl0ZWQiXSwibWFwcGluZ3MiOiJBQUdBQSxNQUFNLENBQUNDLE9BQVAsR0FBaUJDLFlBQWpCO0FBQ0FGLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlRSxLQUFmLEdBQXVCQSxLQUF2QjtBQUNBSCxNQUFNLENBQUNDLE9BQVAsQ0FBZUcsT0FBZixHQUF5QkEsT0FBekI7QUFDQUosTUFBTSxDQUFDQyxPQUFQLENBQWVJLGdCQUFmLEdBQWtDQSxnQkFBbEM7QUFDQUwsTUFBTSxDQUFDQyxPQUFQLENBQWVLLGNBQWYsR0FBZ0NBLGNBQWhDO0FBS0EsSUFBSUMsaUJBQWlCLEdBQUcsR0FBeEI7QUFDQSxJQUFJQyxrQkFBa0IsR0FBRyxJQUF6QjtBQU9BLElBQUlDLFdBQVcsR0FBRyxJQUFJQyxNQUFKLENBQVcsQ0FHM0IsU0FIMkIsRUFTM0IscUZBVDJCLEVBVTNCQyxJQVYyQixDQVV0QixHQVZzQixDQUFYLEVBVUwsR0FWSyxDQUFsQjs7QUFtQkEsU0FBU1IsS0FBVCxDQUFnQlMsR0FBaEIsRUFBcUJDLE9BQXJCLEVBQThCO0FBQzVCLE1BQUlDLE1BQU0sR0FBRyxFQUFiO0FBQ0EsTUFBSUMsR0FBRyxHQUFHLENBQVY7QUFDQSxNQUFJQyxLQUFLLEdBQUcsQ0FBWjtBQUNBLE1BQUlDLElBQUksR0FBRyxFQUFYO0FBQ0EsTUFBSUMsZ0JBQWdCLEdBQUlMLE9BQU8sSUFBSUEsT0FBTyxDQUFDTSxTQUFwQixJQUFrQ1osaUJBQXpEO0FBQ0EsTUFBSWEsVUFBVSxHQUFJUCxPQUFPLElBQUlBLE9BQU8sQ0FBQ08sVUFBcEIsSUFBbUNaLGtCQUFwRDtBQUNBLE1BQUlhLFdBQVcsR0FBRyxLQUFsQjtBQUNBLE1BQUlDLEdBQUo7O0FBRUEsU0FBTyxDQUFDQSxHQUFHLEdBQUdiLFdBQVcsQ0FBQ2MsSUFBWixDQUFpQlgsR0FBakIsQ0FBUCxNQUFrQyxJQUF6QyxFQUErQztBQUM3QyxRQUFJWSxDQUFDLEdBQUdGLEdBQUcsQ0FBQyxDQUFELENBQVg7QUFDQSxRQUFJRyxPQUFPLEdBQUdILEdBQUcsQ0FBQyxDQUFELENBQWpCO0FBQ0EsUUFBSUksTUFBTSxHQUFHSixHQUFHLENBQUNOLEtBQWpCO0FBQ0FDLElBQUFBLElBQUksSUFBSUwsR0FBRyxDQUFDZSxLQUFKLENBQVVYLEtBQVYsRUFBaUJVLE1BQWpCLENBQVI7QUFDQVYsSUFBQUEsS0FBSyxHQUFHVSxNQUFNLEdBQUdGLENBQUMsQ0FBQ0ksTUFBbkI7O0FBR0EsUUFBSUgsT0FBSixFQUFhO0FBQ1hSLE1BQUFBLElBQUksSUFBSVEsT0FBTyxDQUFDLENBQUQsQ0FBZjtBQUNBSixNQUFBQSxXQUFXLEdBQUcsSUFBZDtBQUNBO0FBQ0Q7O0FBRUQsUUFBSVEsSUFBSSxHQUFHLEVBQVg7QUFDQSxRQUFJQyxJQUFJLEdBQUdsQixHQUFHLENBQUNJLEtBQUQsQ0FBZDtBQUNBLFFBQUllLElBQUksR0FBR1QsR0FBRyxDQUFDLENBQUQsQ0FBZDtBQUNBLFFBQUlVLE9BQU8sR0FBR1YsR0FBRyxDQUFDLENBQUQsQ0FBakI7QUFDQSxRQUFJVyxLQUFLLEdBQUdYLEdBQUcsQ0FBQyxDQUFELENBQWY7QUFDQSxRQUFJWSxRQUFRLEdBQUdaLEdBQUcsQ0FBQyxDQUFELENBQWxCOztBQUVBLFFBQUksQ0FBQ0QsV0FBRCxJQUFnQkosSUFBSSxDQUFDVyxNQUF6QixFQUFpQztBQUMvQixVQUFJTyxDQUFDLEdBQUdsQixJQUFJLENBQUNXLE1BQUwsR0FBYyxDQUF0Qjs7QUFFQSxVQUFJUixVQUFVLENBQUNnQixPQUFYLENBQW1CbkIsSUFBSSxDQUFDa0IsQ0FBRCxDQUF2QixJQUE4QixDQUFDLENBQW5DLEVBQXNDO0FBQ3BDTixRQUFBQSxJQUFJLEdBQUdaLElBQUksQ0FBQ2tCLENBQUQsQ0FBWDtBQUNBbEIsUUFBQUEsSUFBSSxHQUFHQSxJQUFJLENBQUNVLEtBQUwsQ0FBVyxDQUFYLEVBQWNRLENBQWQsQ0FBUDtBQUNEO0FBQ0Y7O0FBR0QsUUFBSWxCLElBQUosRUFBVTtBQUNSSCxNQUFBQSxNQUFNLENBQUN1QixJQUFQLENBQVlwQixJQUFaO0FBQ0FBLE1BQUFBLElBQUksR0FBRyxFQUFQO0FBQ0FJLE1BQUFBLFdBQVcsR0FBRyxLQUFkO0FBQ0Q7O0FBRUQsUUFBSWlCLE9BQU8sR0FBR1QsSUFBSSxLQUFLLEVBQVQsSUFBZUMsSUFBSSxLQUFLUyxTQUF4QixJQUFxQ1QsSUFBSSxLQUFLRCxJQUE1RDtBQUNBLFFBQUlXLE1BQU0sR0FBR04sUUFBUSxLQUFLLEdBQWIsSUFBb0JBLFFBQVEsS0FBSyxHQUE5QztBQUNBLFFBQUlPLFFBQVEsR0FBR1AsUUFBUSxLQUFLLEdBQWIsSUFBb0JBLFFBQVEsS0FBSyxHQUFoRDtBQUNBLFFBQUlmLFNBQVMsR0FBR1UsSUFBSSxJQUFJWCxnQkFBeEI7QUFDQSxRQUFJd0IsT0FBTyxHQUFHVixPQUFPLElBQUlDLEtBQXpCO0FBRUFuQixJQUFBQSxNQUFNLENBQUN1QixJQUFQLENBQVk7QUFDVk4sTUFBQUEsSUFBSSxFQUFFQSxJQUFJLElBQUloQixHQUFHLEVBRFA7QUFFVjRCLE1BQUFBLE1BQU0sRUFBRWQsSUFGRTtBQUdWVixNQUFBQSxTQUFTLEVBQUVBLFNBSEQ7QUFJVnNCLE1BQUFBLFFBQVEsRUFBRUEsUUFKQTtBQUtWRCxNQUFBQSxNQUFNLEVBQUVBLE1BTEU7QUFNVkYsTUFBQUEsT0FBTyxFQUFFQSxPQU5DO0FBT1ZJLE1BQUFBLE9BQU8sRUFBRUEsT0FBTyxHQUFHRSxXQUFXLENBQUNGLE9BQUQsQ0FBZCxHQUEwQixPQUFPRyxZQUFZLENBQUMxQixTQUFELENBQW5CLEdBQWlDO0FBUGpFLEtBQVo7QUFTRDs7QUFHRCxNQUFJRixJQUFJLElBQUlELEtBQUssR0FBR0osR0FBRyxDQUFDZ0IsTUFBeEIsRUFBZ0M7QUFDOUJkLElBQUFBLE1BQU0sQ0FBQ3VCLElBQVAsQ0FBWXBCLElBQUksR0FBR0wsR0FBRyxDQUFDa0MsTUFBSixDQUFXOUIsS0FBWCxDQUFuQjtBQUNEOztBQUVELFNBQU9GLE1BQVA7QUFDRDs7QUFTRCxTQUFTVixPQUFULENBQWtCUSxHQUFsQixFQUF1QkMsT0FBdkIsRUFBZ0M7QUFDOUIsU0FBT1IsZ0JBQWdCLENBQUNGLEtBQUssQ0FBQ1MsR0FBRCxFQUFNQyxPQUFOLENBQU4sQ0FBdkI7QUFDRDs7QUFLRCxTQUFTUixnQkFBVCxDQUEyQlMsTUFBM0IsRUFBbUM7QUFFakMsTUFBSWlDLE9BQU8sR0FBRyxJQUFJQyxLQUFKLENBQVVsQyxNQUFNLENBQUNjLE1BQWpCLENBQWQ7O0FBR0EsT0FBSyxJQUFJcUIsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR25DLE1BQU0sQ0FBQ2MsTUFBM0IsRUFBbUNxQixDQUFDLEVBQXBDLEVBQXdDO0FBQ3RDLFFBQUksT0FBT25DLE1BQU0sQ0FBQ21DLENBQUQsQ0FBYixLQUFxQixRQUF6QixFQUFtQztBQUNqQ0YsTUFBQUEsT0FBTyxDQUFDRSxDQUFELENBQVAsR0FBYSxJQUFJdkMsTUFBSixDQUFXLFNBQVNJLE1BQU0sQ0FBQ21DLENBQUQsQ0FBTixDQUFVUCxPQUFuQixHQUE2QixJQUF4QyxDQUFiO0FBQ0Q7QUFDRjs7QUFFRCxTQUFPLFVBQVVRLElBQVYsRUFBZ0JyQyxPQUFoQixFQUF5QjtBQUM5QixRQUFJSSxJQUFJLEdBQUcsRUFBWDtBQUNBLFFBQUlrQyxNQUFNLEdBQUl0QyxPQUFPLElBQUlBLE9BQU8sQ0FBQ3NDLE1BQXBCLElBQStCQyxrQkFBNUM7O0FBRUEsU0FBSyxJQUFJSCxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHbkMsTUFBTSxDQUFDYyxNQUEzQixFQUFtQ3FCLENBQUMsRUFBcEMsRUFBd0M7QUFDdEMsVUFBSUksS0FBSyxHQUFHdkMsTUFBTSxDQUFDbUMsQ0FBRCxDQUFsQjs7QUFFQSxVQUFJLE9BQU9JLEtBQVAsS0FBaUIsUUFBckIsRUFBK0I7QUFDN0JwQyxRQUFBQSxJQUFJLElBQUlvQyxLQUFSO0FBQ0E7QUFDRDs7QUFFRCxVQUFJQyxLQUFLLEdBQUdKLElBQUksR0FBR0EsSUFBSSxDQUFDRyxLQUFLLENBQUN0QixJQUFQLENBQVAsR0FBc0JRLFNBQXRDO0FBQ0EsVUFBSWdCLE9BQUo7O0FBRUEsVUFBSVAsS0FBSyxDQUFDUSxPQUFOLENBQWNGLEtBQWQsQ0FBSixFQUEwQjtBQUN4QixZQUFJLENBQUNELEtBQUssQ0FBQ2IsTUFBWCxFQUFtQjtBQUNqQixnQkFBTSxJQUFJaUIsU0FBSixDQUFjLGVBQWVKLEtBQUssQ0FBQ3RCLElBQXJCLEdBQTRCLGdDQUExQyxDQUFOO0FBQ0Q7O0FBRUQsWUFBSXVCLEtBQUssQ0FBQzFCLE1BQU4sS0FBaUIsQ0FBckIsRUFBd0I7QUFDdEIsY0FBSXlCLEtBQUssQ0FBQ1osUUFBVixFQUFvQjtBQUVwQixnQkFBTSxJQUFJZ0IsU0FBSixDQUFjLGVBQWVKLEtBQUssQ0FBQ3RCLElBQXJCLEdBQTRCLG1CQUExQyxDQUFOO0FBQ0Q7O0FBRUQsYUFBSyxJQUFJMkIsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0osS0FBSyxDQUFDMUIsTUFBMUIsRUFBa0M4QixDQUFDLEVBQW5DLEVBQXVDO0FBQ3JDSCxVQUFBQSxPQUFPLEdBQUdKLE1BQU0sQ0FBQ0csS0FBSyxDQUFDSSxDQUFELENBQU4sRUFBV0wsS0FBWCxDQUFoQjs7QUFFQSxjQUFJLENBQUNOLE9BQU8sQ0FBQ0UsQ0FBRCxDQUFQLENBQVdVLElBQVgsQ0FBZ0JKLE9BQWhCLENBQUwsRUFBK0I7QUFDN0Isa0JBQU0sSUFBSUUsU0FBSixDQUFjLG1CQUFtQkosS0FBSyxDQUFDdEIsSUFBekIsR0FBZ0MsY0FBaEMsR0FBaURzQixLQUFLLENBQUNYLE9BQXZELEdBQWlFLEdBQS9FLENBQU47QUFDRDs7QUFFRHpCLFVBQUFBLElBQUksSUFBSSxDQUFDeUMsQ0FBQyxLQUFLLENBQU4sR0FBVUwsS0FBSyxDQUFDVixNQUFoQixHQUF5QlUsS0FBSyxDQUFDbEMsU0FBaEMsSUFBNkNvQyxPQUFyRDtBQUNEOztBQUVEO0FBQ0Q7O0FBRUQsVUFBSSxPQUFPRCxLQUFQLEtBQWlCLFFBQWpCLElBQTZCLE9BQU9BLEtBQVAsS0FBaUIsUUFBOUMsSUFBMEQsT0FBT0EsS0FBUCxLQUFpQixTQUEvRSxFQUEwRjtBQUN4RkMsUUFBQUEsT0FBTyxHQUFHSixNQUFNLENBQUNTLE1BQU0sQ0FBQ04sS0FBRCxDQUFQLEVBQWdCRCxLQUFoQixDQUFoQjs7QUFFQSxZQUFJLENBQUNOLE9BQU8sQ0FBQ0UsQ0FBRCxDQUFQLENBQVdVLElBQVgsQ0FBZ0JKLE9BQWhCLENBQUwsRUFBK0I7QUFDN0IsZ0JBQU0sSUFBSUUsU0FBSixDQUFjLGVBQWVKLEtBQUssQ0FBQ3RCLElBQXJCLEdBQTRCLGNBQTVCLEdBQTZDc0IsS0FBSyxDQUFDWCxPQUFuRCxHQUE2RCxjQUE3RCxHQUE4RWEsT0FBOUUsR0FBd0YsR0FBdEcsQ0FBTjtBQUNEOztBQUVEdEMsUUFBQUEsSUFBSSxJQUFJb0MsS0FBSyxDQUFDVixNQUFOLEdBQWVZLE9BQXZCO0FBQ0E7QUFDRDs7QUFFRCxVQUFJRixLQUFLLENBQUNaLFFBQVYsRUFBb0I7QUFFbEIsWUFBSVksS0FBSyxDQUFDZixPQUFWLEVBQW1CckIsSUFBSSxJQUFJb0MsS0FBSyxDQUFDVixNQUFkO0FBRW5CO0FBQ0Q7O0FBRUQsWUFBTSxJQUFJYyxTQUFKLENBQWMsZUFBZUosS0FBSyxDQUFDdEIsSUFBckIsR0FBNEIsVUFBNUIsSUFBMENzQixLQUFLLENBQUNiLE1BQU4sR0FBZSxVQUFmLEdBQTRCLFVBQXRFLENBQWQsQ0FBTjtBQUNEOztBQUVELFdBQU92QixJQUFQO0FBQ0QsR0E3REQ7QUE4REQ7O0FBUUQsU0FBUzRCLFlBQVQsQ0FBdUJqQyxHQUF2QixFQUE0QjtBQUMxQixTQUFPQSxHQUFHLENBQUNpRCxPQUFKLENBQVksMkJBQVosRUFBeUMsTUFBekMsQ0FBUDtBQUNEOztBQVFELFNBQVNqQixXQUFULENBQXNCWCxLQUF0QixFQUE2QjtBQUMzQixTQUFPQSxLQUFLLENBQUM0QixPQUFOLENBQWMsY0FBZCxFQUE4QixNQUE5QixDQUFQO0FBQ0Q7O0FBUUQsU0FBU0MsS0FBVCxDQUFnQmpELE9BQWhCLEVBQXlCO0FBQ3ZCLFNBQU9BLE9BQU8sSUFBSUEsT0FBTyxDQUFDa0QsU0FBbkIsR0FBK0IsRUFBL0IsR0FBb0MsR0FBM0M7QUFDRDs7QUFTRCxTQUFTQyxjQUFULENBQXlCL0MsSUFBekIsRUFBK0JnRCxJQUEvQixFQUFxQztBQUNuQyxNQUFJLENBQUNBLElBQUwsRUFBVyxPQUFPaEQsSUFBUDtBQUdYLE1BQUlpRCxNQUFNLEdBQUdqRCxJQUFJLENBQUNrRCxNQUFMLENBQVlDLEtBQVosQ0FBa0IsV0FBbEIsQ0FBYjs7QUFFQSxNQUFJRixNQUFKLEVBQVk7QUFDVixTQUFLLElBQUlqQixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHaUIsTUFBTSxDQUFDdEMsTUFBM0IsRUFBbUNxQixDQUFDLEVBQXBDLEVBQXdDO0FBQ3RDZ0IsTUFBQUEsSUFBSSxDQUFDNUIsSUFBTCxDQUFVO0FBQ1JOLFFBQUFBLElBQUksRUFBRWtCLENBREU7QUFFUk4sUUFBQUEsTUFBTSxFQUFFLElBRkE7QUFHUnhCLFFBQUFBLFNBQVMsRUFBRSxJQUhIO0FBSVJzQixRQUFBQSxRQUFRLEVBQUUsS0FKRjtBQUtSRCxRQUFBQSxNQUFNLEVBQUUsS0FMQTtBQU1SRixRQUFBQSxPQUFPLEVBQUUsS0FORDtBQU9SSSxRQUFBQSxPQUFPLEVBQUU7QUFQRCxPQUFWO0FBU0Q7QUFDRjs7QUFFRCxTQUFPekIsSUFBUDtBQUNEOztBQVVELFNBQVNvRCxhQUFULENBQXdCcEQsSUFBeEIsRUFBOEJnRCxJQUE5QixFQUFvQ3BELE9BQXBDLEVBQTZDO0FBQzNDLE1BQUl5RCxLQUFLLEdBQUcsRUFBWjs7QUFFQSxPQUFLLElBQUlyQixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHaEMsSUFBSSxDQUFDVyxNQUF6QixFQUFpQ3FCLENBQUMsRUFBbEMsRUFBc0M7QUFDcENxQixJQUFBQSxLQUFLLENBQUNqQyxJQUFOLENBQVduQyxZQUFZLENBQUNlLElBQUksQ0FBQ2dDLENBQUQsQ0FBTCxFQUFVZ0IsSUFBVixFQUFnQnBELE9BQWhCLENBQVosQ0FBcUNzRCxNQUFoRDtBQUNEOztBQUVELFNBQU8sSUFBSXpELE1BQUosQ0FBVyxRQUFRNEQsS0FBSyxDQUFDM0QsSUFBTixDQUFXLEdBQVgsQ0FBUixHQUEwQixHQUFyQyxFQUEwQ21ELEtBQUssQ0FBQ2pELE9BQUQsQ0FBL0MsQ0FBUDtBQUNEOztBQVVELFNBQVMwRCxjQUFULENBQXlCdEQsSUFBekIsRUFBK0JnRCxJQUEvQixFQUFxQ3BELE9BQXJDLEVBQThDO0FBQzVDLFNBQU9QLGNBQWMsQ0FBQ0gsS0FBSyxDQUFDYyxJQUFELEVBQU9KLE9BQVAsQ0FBTixFQUF1Qm9ELElBQXZCLEVBQTZCcEQsT0FBN0IsQ0FBckI7QUFDRDs7QUFVRCxTQUFTUCxjQUFULENBQXlCUSxNQUF6QixFQUFpQ21ELElBQWpDLEVBQXVDcEQsT0FBdkMsRUFBZ0Q7QUFDOUNBLEVBQUFBLE9BQU8sR0FBR0EsT0FBTyxJQUFJLEVBQXJCO0FBRUEsTUFBSTJELE1BQU0sR0FBRzNELE9BQU8sQ0FBQzJELE1BQXJCO0FBQ0EsTUFBSUMsS0FBSyxHQUFHNUQsT0FBTyxDQUFDNEQsS0FBUixLQUFrQixLQUE5QjtBQUNBLE1BQUlDLEdBQUcsR0FBRzdELE9BQU8sQ0FBQzZELEdBQVIsS0FBZ0IsS0FBMUI7QUFDQSxNQUFJdkQsU0FBUyxHQUFHMEIsWUFBWSxDQUFDaEMsT0FBTyxDQUFDTSxTQUFSLElBQXFCWixpQkFBdEIsQ0FBNUI7QUFDQSxNQUFJYSxVQUFVLEdBQUdQLE9BQU8sQ0FBQ08sVUFBUixJQUFzQlosa0JBQXZDO0FBQ0EsTUFBSW1FLFFBQVEsR0FBRyxHQUFHQyxNQUFILENBQVUvRCxPQUFPLENBQUM4RCxRQUFSLElBQW9CLEVBQTlCLEVBQWtDRSxHQUFsQyxDQUFzQ2hDLFlBQXRDLEVBQW9EK0IsTUFBcEQsQ0FBMkQsR0FBM0QsRUFBZ0VqRSxJQUFoRSxDQUFxRSxHQUFyRSxDQUFmO0FBQ0EsTUFBSW1FLEtBQUssR0FBR0wsS0FBSyxHQUFHLEdBQUgsR0FBUyxFQUExQjtBQUNBLE1BQUlNLGNBQWMsR0FBR2pFLE1BQU0sQ0FBQ2MsTUFBUCxLQUFrQixDQUF2Qzs7QUFHQSxPQUFLLElBQUlxQixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHbkMsTUFBTSxDQUFDYyxNQUEzQixFQUFtQ3FCLENBQUMsRUFBcEMsRUFBd0M7QUFDdEMsUUFBSUksS0FBSyxHQUFHdkMsTUFBTSxDQUFDbUMsQ0FBRCxDQUFsQjs7QUFFQSxRQUFJLE9BQU9JLEtBQVAsS0FBaUIsUUFBckIsRUFBK0I7QUFDN0J5QixNQUFBQSxLQUFLLElBQUlqQyxZQUFZLENBQUNRLEtBQUQsQ0FBckI7QUFDQTBCLE1BQUFBLGNBQWMsR0FBRzlCLENBQUMsS0FBS25DLE1BQU0sQ0FBQ2MsTUFBUCxHQUFnQixDQUF0QixJQUEyQlIsVUFBVSxDQUFDZ0IsT0FBWCxDQUFtQmlCLEtBQUssQ0FBQ0EsS0FBSyxDQUFDekIsTUFBTixHQUFlLENBQWhCLENBQXhCLElBQThDLENBQUMsQ0FBM0Y7QUFDRCxLQUhELE1BR087QUFDTCxVQUFJSSxPQUFPLEdBQUdxQixLQUFLLENBQUNiLE1BQU4sR0FDVixRQUFRYSxLQUFLLENBQUNYLE9BQWQsR0FBd0IsTUFBeEIsR0FBaUNHLFlBQVksQ0FBQ1EsS0FBSyxDQUFDbEMsU0FBUCxDQUE3QyxHQUFpRSxLQUFqRSxHQUF5RWtDLEtBQUssQ0FBQ1gsT0FBL0UsR0FBeUYsS0FEL0UsR0FFVlcsS0FBSyxDQUFDWCxPQUZWO0FBSUEsVUFBSXVCLElBQUosRUFBVUEsSUFBSSxDQUFDNUIsSUFBTCxDQUFVZ0IsS0FBVjs7QUFFVixVQUFJQSxLQUFLLENBQUNaLFFBQVYsRUFBb0I7QUFDbEIsWUFBSVksS0FBSyxDQUFDZixPQUFWLEVBQW1CO0FBQ2pCd0MsVUFBQUEsS0FBSyxJQUFJakMsWUFBWSxDQUFDUSxLQUFLLENBQUNWLE1BQVAsQ0FBWixHQUE2QixHQUE3QixHQUFtQ1gsT0FBbkMsR0FBNkMsSUFBdEQ7QUFDRCxTQUZELE1BRU87QUFDTDhDLFVBQUFBLEtBQUssSUFBSSxRQUFRakMsWUFBWSxDQUFDUSxLQUFLLENBQUNWLE1BQVAsQ0FBcEIsR0FBcUMsR0FBckMsR0FBMkNYLE9BQTNDLEdBQXFELEtBQTlEO0FBQ0Q7QUFDRixPQU5ELE1BTU87QUFDTDhDLFFBQUFBLEtBQUssSUFBSWpDLFlBQVksQ0FBQ1EsS0FBSyxDQUFDVixNQUFQLENBQVosR0FBNkIsR0FBN0IsR0FBbUNYLE9BQW5DLEdBQTZDLEdBQXREO0FBQ0Q7QUFDRjtBQUNGOztBQUVELE1BQUkwQyxHQUFKLEVBQVM7QUFDUCxRQUFJLENBQUNGLE1BQUwsRUFBYU0sS0FBSyxJQUFJLFFBQVEzRCxTQUFSLEdBQW9CLElBQTdCO0FBRWIyRCxJQUFBQSxLQUFLLElBQUlILFFBQVEsS0FBSyxHQUFiLEdBQW1CLEdBQW5CLEdBQXlCLFFBQVFBLFFBQVIsR0FBbUIsR0FBckQ7QUFDRCxHQUpELE1BSU87QUFDTCxRQUFJLENBQUNILE1BQUwsRUFBYU0sS0FBSyxJQUFJLFFBQVEzRCxTQUFSLEdBQW9CLEtBQXBCLEdBQTRCd0QsUUFBNUIsR0FBdUMsS0FBaEQ7QUFDYixRQUFJLENBQUNJLGNBQUwsRUFBcUJELEtBQUssSUFBSSxRQUFRM0QsU0FBUixHQUFvQixHQUFwQixHQUEwQndELFFBQTFCLEdBQXFDLEdBQTlDO0FBQ3RCOztBQUVELFNBQU8sSUFBSWpFLE1BQUosQ0FBV29FLEtBQVgsRUFBa0JoQixLQUFLLENBQUNqRCxPQUFELENBQXZCLENBQVA7QUFDRDs7QUFjRCxTQUFTWCxZQUFULENBQXVCZSxJQUF2QixFQUE2QmdELElBQTdCLEVBQW1DcEQsT0FBbkMsRUFBNEM7QUFDMUMsTUFBSUksSUFBSSxZQUFZUCxNQUFwQixFQUE0QjtBQUMxQixXQUFPc0QsY0FBYyxDQUFDL0MsSUFBRCxFQUFPZ0QsSUFBUCxDQUFyQjtBQUNEOztBQUVELE1BQUlqQixLQUFLLENBQUNRLE9BQU4sQ0FBY3ZDLElBQWQsQ0FBSixFQUF5QjtBQUN2QixXQUFPb0QsYUFBYSxDQUF3QnBELElBQXhCLEVBQStCZ0QsSUFBL0IsRUFBcUNwRCxPQUFyQyxDQUFwQjtBQUNEOztBQUVELFNBQU8wRCxjQUFjLENBQXdCdEQsSUFBeEIsRUFBK0JnRCxJQUEvQixFQUFxQ3BELE9BQXJDLENBQXJCO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEV4cG9zZSBgcGF0aFRvUmVnZXhwYC5cbiAqL1xubW9kdWxlLmV4cG9ydHMgPSBwYXRoVG9SZWdleHBcbm1vZHVsZS5leHBvcnRzLnBhcnNlID0gcGFyc2Vcbm1vZHVsZS5leHBvcnRzLmNvbXBpbGUgPSBjb21waWxlXG5tb2R1bGUuZXhwb3J0cy50b2tlbnNUb0Z1bmN0aW9uID0gdG9rZW5zVG9GdW5jdGlvblxubW9kdWxlLmV4cG9ydHMudG9rZW5zVG9SZWdFeHAgPSB0b2tlbnNUb1JlZ0V4cFxuXG4vKipcbiAqIERlZmF1bHQgY29uZmlncy5cbiAqL1xudmFyIERFRkFVTFRfREVMSU1JVEVSID0gJy8nXG52YXIgREVGQVVMVF9ERUxJTUlURVJTID0gJy4vJ1xuXG4vKipcbiAqIFRoZSBtYWluIHBhdGggbWF0Y2hpbmcgcmVnZXhwIHV0aWxpdHkuXG4gKlxuICogQHR5cGUge1JlZ0V4cH1cbiAqL1xudmFyIFBBVEhfUkVHRVhQID0gbmV3IFJlZ0V4cChbXG4gIC8vIE1hdGNoIGVzY2FwZWQgY2hhcmFjdGVycyB0aGF0IHdvdWxkIG90aGVyd2lzZSBhcHBlYXIgaW4gZnV0dXJlIG1hdGNoZXMuXG4gIC8vIFRoaXMgYWxsb3dzIHRoZSB1c2VyIHRvIGVzY2FwZSBzcGVjaWFsIGNoYXJhY3RlcnMgdGhhdCB3b24ndCB0cmFuc2Zvcm0uXG4gICcoXFxcXFxcXFwuKScsXG4gIC8vIE1hdGNoIEV4cHJlc3Mtc3R5bGUgcGFyYW1ldGVycyBhbmQgdW4tbmFtZWQgcGFyYW1ldGVycyB3aXRoIGEgcHJlZml4XG4gIC8vIGFuZCBvcHRpb25hbCBzdWZmaXhlcy4gTWF0Y2hlcyBhcHBlYXIgYXM6XG4gIC8vXG4gIC8vIFwiOnRlc3QoXFxcXGQrKT9cIiA9PiBbXCJ0ZXN0XCIsIFwiXFxkK1wiLCB1bmRlZmluZWQsIFwiP1wiXVxuICAvLyBcIihcXFxcZCspXCIgID0+IFt1bmRlZmluZWQsIHVuZGVmaW5lZCwgXCJcXGQrXCIsIHVuZGVmaW5lZF1cbiAgJyg/OlxcXFw6KFxcXFx3KykoPzpcXFxcKCgoPzpcXFxcXFxcXC58W15cXFxcXFxcXCgpXSkrKVxcXFwpKT98XFxcXCgoKD86XFxcXFxcXFwufFteXFxcXFxcXFwoKV0pKylcXFxcKSkoWysqP10pPydcbl0uam9pbignfCcpLCAnZycpXG5cbi8qKlxuICogUGFyc2UgYSBzdHJpbmcgZm9yIHRoZSByYXcgdG9rZW5zLlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gIHN0clxuICogQHBhcmFtICB7T2JqZWN0PX0gb3B0aW9uc1xuICogQHJldHVybiB7IUFycmF5fVxuICovXG5mdW5jdGlvbiBwYXJzZSAoc3RyLCBvcHRpb25zKSB7XG4gIHZhciB0b2tlbnMgPSBbXVxuICB2YXIga2V5ID0gMFxuICB2YXIgaW5kZXggPSAwXG4gIHZhciBwYXRoID0gJydcbiAgdmFyIGRlZmF1bHREZWxpbWl0ZXIgPSAob3B0aW9ucyAmJiBvcHRpb25zLmRlbGltaXRlcikgfHwgREVGQVVMVF9ERUxJTUlURVJcbiAgdmFyIGRlbGltaXRlcnMgPSAob3B0aW9ucyAmJiBvcHRpb25zLmRlbGltaXRlcnMpIHx8IERFRkFVTFRfREVMSU1JVEVSU1xuICB2YXIgcGF0aEVzY2FwZWQgPSBmYWxzZVxuICB2YXIgcmVzXG5cbiAgd2hpbGUgKChyZXMgPSBQQVRIX1JFR0VYUC5leGVjKHN0cikpICE9PSBudWxsKSB7XG4gICAgdmFyIG0gPSByZXNbMF1cbiAgICB2YXIgZXNjYXBlZCA9IHJlc1sxXVxuICAgIHZhciBvZmZzZXQgPSByZXMuaW5kZXhcbiAgICBwYXRoICs9IHN0ci5zbGljZShpbmRleCwgb2Zmc2V0KVxuICAgIGluZGV4ID0gb2Zmc2V0ICsgbS5sZW5ndGhcblxuICAgIC8vIElnbm9yZSBhbHJlYWR5IGVzY2FwZWQgc2VxdWVuY2VzLlxuICAgIGlmIChlc2NhcGVkKSB7XG4gICAgICBwYXRoICs9IGVzY2FwZWRbMV1cbiAgICAgIHBhdGhFc2NhcGVkID0gdHJ1ZVxuICAgICAgY29udGludWVcbiAgICB9XG5cbiAgICB2YXIgcHJldiA9ICcnXG4gICAgdmFyIG5leHQgPSBzdHJbaW5kZXhdXG4gICAgdmFyIG5hbWUgPSByZXNbMl1cbiAgICB2YXIgY2FwdHVyZSA9IHJlc1szXVxuICAgIHZhciBncm91cCA9IHJlc1s0XVxuICAgIHZhciBtb2RpZmllciA9IHJlc1s1XVxuXG4gICAgaWYgKCFwYXRoRXNjYXBlZCAmJiBwYXRoLmxlbmd0aCkge1xuICAgICAgdmFyIGsgPSBwYXRoLmxlbmd0aCAtIDFcblxuICAgICAgaWYgKGRlbGltaXRlcnMuaW5kZXhPZihwYXRoW2tdKSA+IC0xKSB7XG4gICAgICAgIHByZXYgPSBwYXRoW2tdXG4gICAgICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIGspXG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUHVzaCB0aGUgY3VycmVudCBwYXRoIG9udG8gdGhlIHRva2Vucy5cbiAgICBpZiAocGF0aCkge1xuICAgICAgdG9rZW5zLnB1c2gocGF0aClcbiAgICAgIHBhdGggPSAnJ1xuICAgICAgcGF0aEVzY2FwZWQgPSBmYWxzZVxuICAgIH1cblxuICAgIHZhciBwYXJ0aWFsID0gcHJldiAhPT0gJycgJiYgbmV4dCAhPT0gdW5kZWZpbmVkICYmIG5leHQgIT09IHByZXZcbiAgICB2YXIgcmVwZWF0ID0gbW9kaWZpZXIgPT09ICcrJyB8fCBtb2RpZmllciA9PT0gJyonXG4gICAgdmFyIG9wdGlvbmFsID0gbW9kaWZpZXIgPT09ICc/JyB8fCBtb2RpZmllciA9PT0gJyonXG4gICAgdmFyIGRlbGltaXRlciA9IHByZXYgfHwgZGVmYXVsdERlbGltaXRlclxuICAgIHZhciBwYXR0ZXJuID0gY2FwdHVyZSB8fCBncm91cFxuXG4gICAgdG9rZW5zLnB1c2goe1xuICAgICAgbmFtZTogbmFtZSB8fCBrZXkrKyxcbiAgICAgIHByZWZpeDogcHJldixcbiAgICAgIGRlbGltaXRlcjogZGVsaW1pdGVyLFxuICAgICAgb3B0aW9uYWw6IG9wdGlvbmFsLFxuICAgICAgcmVwZWF0OiByZXBlYXQsXG4gICAgICBwYXJ0aWFsOiBwYXJ0aWFsLFxuICAgICAgcGF0dGVybjogcGF0dGVybiA/IGVzY2FwZUdyb3VwKHBhdHRlcm4pIDogJ1teJyArIGVzY2FwZVN0cmluZyhkZWxpbWl0ZXIpICsgJ10rPydcbiAgICB9KVxuICB9XG5cbiAgLy8gUHVzaCBhbnkgcmVtYWluaW5nIGNoYXJhY3RlcnMuXG4gIGlmIChwYXRoIHx8IGluZGV4IDwgc3RyLmxlbmd0aCkge1xuICAgIHRva2Vucy5wdXNoKHBhdGggKyBzdHIuc3Vic3RyKGluZGV4KSlcbiAgfVxuXG4gIHJldHVybiB0b2tlbnNcbn1cblxuLyoqXG4gKiBDb21waWxlIGEgc3RyaW5nIHRvIGEgdGVtcGxhdGUgZnVuY3Rpb24gZm9yIHRoZSBwYXRoLlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gICAgICAgICAgICAgc3RyXG4gKiBAcGFyYW0gIHtPYmplY3Q9fSAgICAgICAgICAgIG9wdGlvbnNcbiAqIEByZXR1cm4geyFmdW5jdGlvbihPYmplY3Q9LCBPYmplY3Q9KX1cbiAqL1xuZnVuY3Rpb24gY29tcGlsZSAoc3RyLCBvcHRpb25zKSB7XG4gIHJldHVybiB0b2tlbnNUb0Z1bmN0aW9uKHBhcnNlKHN0ciwgb3B0aW9ucykpXG59XG5cbi8qKlxuICogRXhwb3NlIGEgbWV0aG9kIGZvciB0cmFuc2Zvcm1pbmcgdG9rZW5zIGludG8gdGhlIHBhdGggZnVuY3Rpb24uXG4gKi9cbmZ1bmN0aW9uIHRva2Vuc1RvRnVuY3Rpb24gKHRva2Vucykge1xuICAvLyBDb21waWxlIGFsbCB0aGUgdG9rZW5zIGludG8gcmVnZXhwcy5cbiAgdmFyIG1hdGNoZXMgPSBuZXcgQXJyYXkodG9rZW5zLmxlbmd0aClcblxuICAvLyBDb21waWxlIGFsbCB0aGUgcGF0dGVybnMgYmVmb3JlIGNvbXBpbGF0aW9uLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgIGlmICh0eXBlb2YgdG9rZW5zW2ldID09PSAnb2JqZWN0Jykge1xuICAgICAgbWF0Y2hlc1tpXSA9IG5ldyBSZWdFeHAoJ14oPzonICsgdG9rZW5zW2ldLnBhdHRlcm4gKyAnKSQnKVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHZhciBwYXRoID0gJydcbiAgICB2YXIgZW5jb2RlID0gKG9wdGlvbnMgJiYgb3B0aW9ucy5lbmNvZGUpIHx8IGVuY29kZVVSSUNvbXBvbmVudFxuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXVxuXG4gICAgICBpZiAodHlwZW9mIHRva2VuID09PSAnc3RyaW5nJykge1xuICAgICAgICBwYXRoICs9IHRva2VuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIHZhciB2YWx1ZSA9IGRhdGEgPyBkYXRhW3Rva2VuLm5hbWVdIDogdW5kZWZpbmVkXG4gICAgICB2YXIgc2VnbWVudFxuXG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgaWYgKCF0b2tlbi5yZXBlYXQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCBcIicgKyB0b2tlbi5uYW1lICsgJ1wiIHRvIG5vdCByZXBlYXQsIGJ1dCBnb3QgYXJyYXknKVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGlmICh0b2tlbi5vcHRpb25hbCkgY29udGludWVcblxuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIFwiJyArIHRva2VuLm5hbWUgKyAnXCIgdG8gbm90IGJlIGVtcHR5JylcbiAgICAgICAgfVxuXG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdmFsdWUubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBzZWdtZW50ID0gZW5jb2RlKHZhbHVlW2pdLCB0b2tlbilcblxuICAgICAgICAgIGlmICghbWF0Y2hlc1tpXS50ZXN0KHNlZ21lbnQpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCBhbGwgXCInICsgdG9rZW4ubmFtZSArICdcIiB0byBtYXRjaCBcIicgKyB0b2tlbi5wYXR0ZXJuICsgJ1wiJylcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwYXRoICs9IChqID09PSAwID8gdG9rZW4ucHJlZml4IDogdG9rZW4uZGVsaW1pdGVyKSArIHNlZ21lbnRcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgc2VnbWVudCA9IGVuY29kZShTdHJpbmcodmFsdWUpLCB0b2tlbilcblxuICAgICAgICBpZiAoIW1hdGNoZXNbaV0udGVzdChzZWdtZW50KSkge1xuICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIFwiJyArIHRva2VuLm5hbWUgKyAnXCIgdG8gbWF0Y2ggXCInICsgdG9rZW4ucGF0dGVybiArICdcIiwgYnV0IGdvdCBcIicgKyBzZWdtZW50ICsgJ1wiJylcbiAgICAgICAgfVxuXG4gICAgICAgIHBhdGggKz0gdG9rZW4ucHJlZml4ICsgc2VnbWVudFxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuXG4gICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHtcbiAgICAgICAgLy8gUHJlcGVuZCBwYXJ0aWFsIHNlZ21lbnQgcHJlZml4ZXMuXG4gICAgICAgIGlmICh0b2tlbi5wYXJ0aWFsKSBwYXRoICs9IHRva2VuLnByZWZpeFxuXG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG5cbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0V4cGVjdGVkIFwiJyArIHRva2VuLm5hbWUgKyAnXCIgdG8gYmUgJyArICh0b2tlbi5yZXBlYXQgPyAnYW4gYXJyYXknIDogJ2Egc3RyaW5nJykpXG4gICAgfVxuXG4gICAgcmV0dXJuIHBhdGhcbiAgfVxufVxuXG4vKipcbiAqIEVzY2FwZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBzdHJpbmcuXG4gKlxuICogQHBhcmFtICB7c3RyaW5nfSBzdHJcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gZXNjYXBlU3RyaW5nIChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oWy4rKj89XiE6JHt9KClbXFxdfC9cXFxcXSkvZywgJ1xcXFwkMScpXG59XG5cbi8qKlxuICogRXNjYXBlIHRoZSBjYXB0dXJpbmcgZ3JvdXAgYnkgZXNjYXBpbmcgc3BlY2lhbCBjaGFyYWN0ZXJzIGFuZCBtZWFuaW5nLlxuICpcbiAqIEBwYXJhbSAge3N0cmluZ30gZ3JvdXBcbiAqIEByZXR1cm4ge3N0cmluZ31cbiAqL1xuZnVuY3Rpb24gZXNjYXBlR3JvdXAgKGdyb3VwKSB7XG4gIHJldHVybiBncm91cC5yZXBsYWNlKC8oWz0hOiQvKCldKS9nLCAnXFxcXCQxJylcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGZsYWdzIGZvciBhIHJlZ2V4cCBmcm9tIHRoZSBvcHRpb25zLlxuICpcbiAqIEBwYXJhbSAge09iamVjdH0gb3B0aW9uc1xuICogQHJldHVybiB7c3RyaW5nfVxuICovXG5mdW5jdGlvbiBmbGFncyAob3B0aW9ucykge1xuICByZXR1cm4gb3B0aW9ucyAmJiBvcHRpb25zLnNlbnNpdGl2ZSA/ICcnIDogJ2knXG59XG5cbi8qKlxuICogUHVsbCBvdXQga2V5cyBmcm9tIGEgcmVnZXhwLlxuICpcbiAqIEBwYXJhbSAgeyFSZWdFeHB9IHBhdGhcbiAqIEBwYXJhbSAge0FycmF5PX0gIGtleXNcbiAqIEByZXR1cm4geyFSZWdFeHB9XG4gKi9cbmZ1bmN0aW9uIHJlZ2V4cFRvUmVnZXhwIChwYXRoLCBrZXlzKSB7XG4gIGlmICgha2V5cykgcmV0dXJuIHBhdGhcblxuICAvLyBVc2UgYSBuZWdhdGl2ZSBsb29rYWhlYWQgdG8gbWF0Y2ggb25seSBjYXB0dXJpbmcgZ3JvdXBzLlxuICB2YXIgZ3JvdXBzID0gcGF0aC5zb3VyY2UubWF0Y2goL1xcKCg/IVxcPykvZylcblxuICBpZiAoZ3JvdXBzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGtleXMucHVzaCh7XG4gICAgICAgIG5hbWU6IGksXG4gICAgICAgIHByZWZpeDogbnVsbCxcbiAgICAgICAgZGVsaW1pdGVyOiBudWxsLFxuICAgICAgICBvcHRpb25hbDogZmFsc2UsXG4gICAgICAgIHJlcGVhdDogZmFsc2UsXG4gICAgICAgIHBhcnRpYWw6IGZhbHNlLFxuICAgICAgICBwYXR0ZXJuOiBudWxsXG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwYXRoXG59XG5cbi8qKlxuICogVHJhbnNmb3JtIGFuIGFycmF5IGludG8gYSByZWdleHAuXG4gKlxuICogQHBhcmFtICB7IUFycmF5fSAgcGF0aFxuICogQHBhcmFtICB7QXJyYXk9fSAga2V5c1xuICogQHBhcmFtICB7T2JqZWN0PX0gb3B0aW9uc1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gYXJyYXlUb1JlZ2V4cCAocGF0aCwga2V5cywgb3B0aW9ucykge1xuICB2YXIgcGFydHMgPSBbXVxuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgIHBhcnRzLnB1c2gocGF0aFRvUmVnZXhwKHBhdGhbaV0sIGtleXMsIG9wdGlvbnMpLnNvdXJjZSlcbiAgfVxuXG4gIHJldHVybiBuZXcgUmVnRXhwKCcoPzonICsgcGFydHMuam9pbignfCcpICsgJyknLCBmbGFncyhvcHRpb25zKSlcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBwYXRoIHJlZ2V4cCBmcm9tIHN0cmluZyBpbnB1dC5cbiAqXG4gKiBAcGFyYW0gIHtzdHJpbmd9ICBwYXRoXG4gKiBAcGFyYW0gIHtBcnJheT19ICBrZXlzXG4gKiBAcGFyYW0gIHtPYmplY3Q9fSBvcHRpb25zXG4gKiBAcmV0dXJuIHshUmVnRXhwfVxuICovXG5mdW5jdGlvbiBzdHJpbmdUb1JlZ2V4cCAocGF0aCwga2V5cywgb3B0aW9ucykge1xuICByZXR1cm4gdG9rZW5zVG9SZWdFeHAocGFyc2UocGF0aCwgb3B0aW9ucyksIGtleXMsIG9wdGlvbnMpXG59XG5cbi8qKlxuICogRXhwb3NlIGEgZnVuY3Rpb24gZm9yIHRha2luZyB0b2tlbnMgYW5kIHJldHVybmluZyBhIFJlZ0V4cC5cbiAqXG4gKiBAcGFyYW0gIHshQXJyYXl9ICB0b2tlbnNcbiAqIEBwYXJhbSAge0FycmF5PX0gIGtleXNcbiAqIEBwYXJhbSAge09iamVjdD19IG9wdGlvbnNcbiAqIEByZXR1cm4geyFSZWdFeHB9XG4gKi9cbmZ1bmN0aW9uIHRva2Vuc1RvUmVnRXhwICh0b2tlbnMsIGtleXMsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge31cblxuICB2YXIgc3RyaWN0ID0gb3B0aW9ucy5zdHJpY3RcbiAgdmFyIHN0YXJ0ID0gb3B0aW9ucy5zdGFydCAhPT0gZmFsc2VcbiAgdmFyIGVuZCA9IG9wdGlvbnMuZW5kICE9PSBmYWxzZVxuICB2YXIgZGVsaW1pdGVyID0gZXNjYXBlU3RyaW5nKG9wdGlvbnMuZGVsaW1pdGVyIHx8IERFRkFVTFRfREVMSU1JVEVSKVxuICB2YXIgZGVsaW1pdGVycyA9IG9wdGlvbnMuZGVsaW1pdGVycyB8fCBERUZBVUxUX0RFTElNSVRFUlNcbiAgdmFyIGVuZHNXaXRoID0gW10uY29uY2F0KG9wdGlvbnMuZW5kc1dpdGggfHwgW10pLm1hcChlc2NhcGVTdHJpbmcpLmNvbmNhdCgnJCcpLmpvaW4oJ3wnKVxuICB2YXIgcm91dGUgPSBzdGFydCA/ICdeJyA6ICcnXG4gIHZhciBpc0VuZERlbGltaXRlZCA9IHRva2Vucy5sZW5ndGggPT09IDBcblxuICAvLyBJdGVyYXRlIG92ZXIgdGhlIHRva2VucyBhbmQgY3JlYXRlIG91ciByZWdleHAgc3RyaW5nLlxuICBmb3IgKHZhciBpID0gMDsgaSA8IHRva2Vucy5sZW5ndGg7IGkrKykge1xuICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXVxuXG4gICAgaWYgKHR5cGVvZiB0b2tlbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJvdXRlICs9IGVzY2FwZVN0cmluZyh0b2tlbilcbiAgICAgIGlzRW5kRGVsaW1pdGVkID0gaSA9PT0gdG9rZW5zLmxlbmd0aCAtIDEgJiYgZGVsaW1pdGVycy5pbmRleE9mKHRva2VuW3Rva2VuLmxlbmd0aCAtIDFdKSA+IC0xXG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBjYXB0dXJlID0gdG9rZW4ucmVwZWF0XG4gICAgICAgID8gJyg/OicgKyB0b2tlbi5wYXR0ZXJuICsgJykoPzonICsgZXNjYXBlU3RyaW5nKHRva2VuLmRlbGltaXRlcikgKyAnKD86JyArIHRva2VuLnBhdHRlcm4gKyAnKSkqJ1xuICAgICAgICA6IHRva2VuLnBhdHRlcm5cblxuICAgICAgaWYgKGtleXMpIGtleXMucHVzaCh0b2tlbilcblxuICAgICAgaWYgKHRva2VuLm9wdGlvbmFsKSB7XG4gICAgICAgIGlmICh0b2tlbi5wYXJ0aWFsKSB7XG4gICAgICAgICAgcm91dGUgKz0gZXNjYXBlU3RyaW5nKHRva2VuLnByZWZpeCkgKyAnKCcgKyBjYXB0dXJlICsgJyk/J1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJvdXRlICs9ICcoPzonICsgZXNjYXBlU3RyaW5nKHRva2VuLnByZWZpeCkgKyAnKCcgKyBjYXB0dXJlICsgJykpPydcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm91dGUgKz0gZXNjYXBlU3RyaW5nKHRva2VuLnByZWZpeCkgKyAnKCcgKyBjYXB0dXJlICsgJyknXG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKGVuZCkge1xuICAgIGlmICghc3RyaWN0KSByb3V0ZSArPSAnKD86JyArIGRlbGltaXRlciArICcpPydcblxuICAgIHJvdXRlICs9IGVuZHNXaXRoID09PSAnJCcgPyAnJCcgOiAnKD89JyArIGVuZHNXaXRoICsgJyknXG4gIH0gZWxzZSB7XG4gICAgaWYgKCFzdHJpY3QpIHJvdXRlICs9ICcoPzonICsgZGVsaW1pdGVyICsgJyg/PScgKyBlbmRzV2l0aCArICcpKT8nXG4gICAgaWYgKCFpc0VuZERlbGltaXRlZCkgcm91dGUgKz0gJyg/PScgKyBkZWxpbWl0ZXIgKyAnfCcgKyBlbmRzV2l0aCArICcpJ1xuICB9XG5cbiAgcmV0dXJuIG5ldyBSZWdFeHAocm91dGUsIGZsYWdzKG9wdGlvbnMpKVxufVxuXG4vKipcbiAqIE5vcm1hbGl6ZSB0aGUgZ2l2ZW4gcGF0aCBzdHJpbmcsIHJldHVybmluZyBhIHJlZ3VsYXIgZXhwcmVzc2lvbi5cbiAqXG4gKiBBbiBlbXB0eSBhcnJheSBjYW4gYmUgcGFzc2VkIGluIGZvciB0aGUga2V5cywgd2hpY2ggd2lsbCBob2xkIHRoZVxuICogcGxhY2Vob2xkZXIga2V5IGRlc2NyaXB0aW9ucy4gRm9yIGV4YW1wbGUsIHVzaW5nIGAvdXNlci86aWRgLCBga2V5c2Agd2lsbFxuICogY29udGFpbiBgW3sgbmFtZTogJ2lkJywgZGVsaW1pdGVyOiAnLycsIG9wdGlvbmFsOiBmYWxzZSwgcmVwZWF0OiBmYWxzZSB9XWAuXG4gKlxuICogQHBhcmFtICB7KHN0cmluZ3xSZWdFeHB8QXJyYXkpfSBwYXRoXG4gKiBAcGFyYW0gIHtBcnJheT19ICAgICAgICAgICAgICAgIGtleXNcbiAqIEBwYXJhbSAge09iamVjdD19ICAgICAgICAgICAgICAgb3B0aW9uc1xuICogQHJldHVybiB7IVJlZ0V4cH1cbiAqL1xuZnVuY3Rpb24gcGF0aFRvUmVnZXhwIChwYXRoLCBrZXlzLCBvcHRpb25zKSB7XG4gIGlmIChwYXRoIGluc3RhbmNlb2YgUmVnRXhwKSB7XG4gICAgcmV0dXJuIHJlZ2V4cFRvUmVnZXhwKHBhdGgsIGtleXMpXG4gIH1cblxuICBpZiAoQXJyYXkuaXNBcnJheShwYXRoKSkge1xuICAgIHJldHVybiBhcnJheVRvUmVnZXhwKC8qKiBAdHlwZSB7IUFycmF5fSAqLyAocGF0aCksIGtleXMsIG9wdGlvbnMpXG4gIH1cblxuICByZXR1cm4gc3RyaW5nVG9SZWdleHAoLyoqIEB0eXBlIHtzdHJpbmd9ICovIChwYXRoKSwga2V5cywgb3B0aW9ucylcbn1cbiJdfQ==