da02fa6cbba4642329b29f2a6f09739b
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var EventEmitter = require('../vendor/emitter/EventEmitter');

var Platform = require('./Platform');

var RCTDeviceEventEmitter = require('../EventEmitter/RCTDeviceEventEmitter');

var invariant = require('invariant');

var eventEmitter = new EventEmitter();
var dimensionsInitialized = false;
var dimensions = {};

var Dimensions = function () {
  function Dimensions() {
    (0, _classCallCheck2.default)(this, Dimensions);
  }

  (0, _createClass2.default)(Dimensions, null, [{
    key: "set",
    value: function set(dims) {
      if (dims && dims.windowPhysicalPixels) {
        dims = JSON.parse(JSON.stringify(dims));
        var windowPhysicalPixels = dims.windowPhysicalPixels;
        dims.window = {
          width: windowPhysicalPixels.width / windowPhysicalPixels.scale,
          height: windowPhysicalPixels.height / windowPhysicalPixels.scale,
          scale: windowPhysicalPixels.scale,
          fontScale: windowPhysicalPixels.fontScale
        };

        if (Platform.OS === 'android') {
          var screenPhysicalPixels = dims.screenPhysicalPixels;
          dims.screen = {
            width: screenPhysicalPixels.width / screenPhysicalPixels.scale,
            height: screenPhysicalPixels.height / screenPhysicalPixels.scale,
            scale: screenPhysicalPixels.scale,
            fontScale: screenPhysicalPixels.fontScale
          };
          delete dims.screenPhysicalPixels;
        } else {
          dims.screen = dims.window;
        }

        delete dims.windowPhysicalPixels;
      }

      (0, _extends2.default)(dimensions, dims);

      if (dimensionsInitialized) {
        eventEmitter.emit('change', {
          window: dimensions.window,
          screen: dimensions.screen
        });
      } else {
        dimensionsInitialized = true;
      }
    }
  }, {
    key: "get",
    value: function get(dim) {
      invariant(dimensions[dim], 'No dimension set for key ' + dim);
      return dimensions[dim];
    }
  }, {
    key: "addEventListener",
    value: function addEventListener(type, handler) {
      invariant(type === 'change', 'Trying to subscribe to unknown event: "%s"', type);
      eventEmitter.addListener(type, handler);
    }
  }, {
    key: "removeEventListener",
    value: function removeEventListener(type, handler) {
      invariant(type === 'change', 'Trying to remove listener for unknown event: "%s"', type);
      eventEmitter.removeListener(type, handler);
    }
  }]);
  return Dimensions;
}();

var dims = global.nativeExtensions && global.nativeExtensions.DeviceInfo && global.nativeExtensions.DeviceInfo.Dimensions;
var nativeExtensionsEnabled = true;

if (!dims) {
  var DeviceInfo = require('./DeviceInfo');

  dims = DeviceInfo.Dimensions;
  nativeExtensionsEnabled = false;
}

invariant(dims, 'Either DeviceInfo native extension or DeviceInfo Native Module must be registered');
Dimensions.set(dims);

if (!nativeExtensionsEnabled) {
  RCTDeviceEventEmitter.addListener('didUpdateDimensions', function (update) {
    Dimensions.set(update);
  });
}

module.exports = Dimensions;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRpbWVuc2lvbnMuanMiXSwibmFtZXMiOlsiRXZlbnRFbWl0dGVyIiwicmVxdWlyZSIsIlBsYXRmb3JtIiwiUkNURGV2aWNlRXZlbnRFbWl0dGVyIiwiaW52YXJpYW50IiwiZXZlbnRFbWl0dGVyIiwiZGltZW5zaW9uc0luaXRpYWxpemVkIiwiZGltZW5zaW9ucyIsIkRpbWVuc2lvbnMiLCJkaW1zIiwid2luZG93UGh5c2ljYWxQaXhlbHMiLCJKU09OIiwicGFyc2UiLCJzdHJpbmdpZnkiLCJ3aW5kb3ciLCJ3aWR0aCIsInNjYWxlIiwiaGVpZ2h0IiwiZm9udFNjYWxlIiwiT1MiLCJzY3JlZW5QaHlzaWNhbFBpeGVscyIsInNjcmVlbiIsImVtaXQiLCJkaW0iLCJ0eXBlIiwiaGFuZGxlciIsImFkZExpc3RlbmVyIiwicmVtb3ZlTGlzdGVuZXIiLCJnbG9iYWwiLCJuYXRpdmVFeHRlbnNpb25zIiwiRGV2aWNlSW5mbyIsIm5hdGl2ZUV4dGVuc2lvbnNFbmFibGVkIiwic2V0IiwidXBkYXRlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBVUE7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxZQUFZLEdBQUdDLE9BQU8sQ0FBQyxnQ0FBRCxDQUE1Qjs7QUFDQSxJQUFNQyxRQUFRLEdBQUdELE9BQU8sQ0FBQyxZQUFELENBQXhCOztBQUNBLElBQU1FLHFCQUFxQixHQUFHRixPQUFPLENBQUMsdUNBQUQsQ0FBckM7O0FBRUEsSUFBTUcsU0FBUyxHQUFHSCxPQUFPLENBQUMsV0FBRCxDQUF6Qjs7QUFFQSxJQUFNSSxZQUFZLEdBQUcsSUFBSUwsWUFBSixFQUFyQjtBQUNBLElBQUlNLHFCQUFxQixHQUFHLEtBQTVCO0FBQ0EsSUFBTUMsVUFBVSxHQUFHLEVBQW5COztJQUNNQyxVOzs7Ozs7O3dCQU9PQyxJLEVBQWtDO0FBSTNDLFVBQUlBLElBQUksSUFBSUEsSUFBSSxDQUFDQyxvQkFBakIsRUFBdUM7QUFFckNELFFBQUFBLElBQUksR0FBR0UsSUFBSSxDQUFD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QXVCLEVBQUFBLHVCQUF1QixHQUFHLEtBQTFCO0FBQ0Q7O0FBRUQzQixTQUFTLENBQ1BLLElBRE8sRUFFUCxtRkFGTyxDQUFUO0FBSUFELFVBQVUsQ0FBQ3dCLEdBQVgsQ0FBZXZCLElBQWY7O0FBQ0EsSUFBSSxDQUFDc0IsdUJBQUwsRUFBOEI7QUFDNUI1QixFQUFBQSxxQkFBcUIsQ0FBQ3VCLFdBQXRCLENBQWtDLHFCQUFsQyxFQUF5RCxVQUFTTyxNQUFULEVBQWlCO0FBQ3hFekIsSUFBQUEsVUFBVSxDQUFDd0IsR0FBWCxDQUFlQyxNQUFmO0FBQ0QsR0FGRDtBQUdEOztBQUVEQyxNQUFNLENBQUNDLE9BQVAsR0FBaUIzQixVQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZvcm1hdFxuICogQGZsb3dcbiAqL1xuXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEV2ZW50RW1pdHRlciA9IHJlcXVpcmUoJy4uL3ZlbmRvci9lbWl0dGVyL0V2ZW50RW1pdHRlcicpO1xuY29uc3QgUGxhdGZvcm0gPSByZXF1aXJlKCcuL1BsYXRmb3JtJyk7XG5jb25zdCBSQ1REZXZpY2VFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCcuLi9FdmVudEVtaXR0ZXIvUkNURGV2aWNlRXZlbnRFbWl0dGVyJyk7XG5cbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5jb25zdCBldmVudEVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5sZXQgZGltZW5zaW9uc0luaXRpYWxpemVkID0gZmFsc2U7XG5jb25zdCBkaW1lbnNpb25zID0ge307XG5jbGFzcyBEaW1lbnNpb25zIHtcbiAgLyoqXG4gICAqIFRoaXMgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gbmF0aXZlIGNvZGUgYnkgc2VuZGluZyB0aGVcbiAgICogZGlkVXBkYXRlRGltZW5zaW9ucyBldmVudC5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGRpbXMgU2ltcGxlIHN0cmluZy1rZXllZCBvYmplY3Qgb2YgZGltZW5zaW9ucyB0byBzZXRcbiAgICovXG4gIHN0YXRpYyBzZXQoZGltczoge1trZXk6IHN0cmluZ106IGFueX0pOiB2b2lkIHtcbiAgICAvLyBXZSBjYWxjdWxhdGUgdGhlIHdpbmRvdyBkaW1lbnNpb25zIGluIEpTIHNvIHRoYXQgd2UgZG9uJ3QgZW5jb3VudGVyIGxvc3Mgb2ZcbiAgICAvLyBwcmVjaXNpb24gaW4gdHJhbnNmZXJyaW5nIHRoZSBkaW1lbnNpb25zICh3aGljaCBjb3VsZCBiZSBub24taW50ZWdlcnMpIG92ZXJcbiAgICAvLyB0aGUgYnJpZGdlLlxuICAgIGlmIChkaW1zICYmIGRpbXMud2luZG93UGh5c2ljYWxQaXhlbHMpIHtcbiAgICAgIC8vIHBhcnNlL3N0cmluZ2lmeSA9PiBDbG9uZSBoYWNrXG4gICAgICBkaW1zID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShkaW1zKSk7XG5cbiAgICAgIGNvbnN0IHdpbmRvd1BoeXNpY2FsUGl4ZWxzID0gZGltcy53aW5kb3dQaHlzaWNhbFBpeGVscztcbiAgICAgIGRpbXMud2luZG93ID0ge1xuICAgICAgICB3aWR0aDogd2luZG93UGh5c2ljYWxQaXhlbHMud2lkdGggLyB3aW5kb3dQaHlzaWNhbFBpeGVscy5zY2FsZSxcbiAgICAgICAgaGVpZ2h0OiB3aW5kb3dQaHlzaWNhbFBpeGVscy5oZWlnaHQgLyB3aW5kb3dQaHlzaWNhbFBpeGVscy5zY2FsZSxcbiAgICAgICAgc2NhbGU6IHdpbmRvd1BoeXNpY2FsUGl4ZWxzLnNjYWxlLFxuICAgICAgICBmb250U2NhbGU6IHdpbmRvd1BoeXNpY2FsUGl4ZWxzLmZvbnRTY2FsZSxcbiAgICAgIH07XG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgICAvLyBTY3JlZW4gYW5kIHdpbmRvdyBkaW1lbnNpb25zIGFyZSBkaWZmZXJlbnQgb24gYW5kcm9pZFxuICAgICAgICBjb25zdCBzY3JlZW5QaHlzaWNhbFBpeGVscyA9IGRpbXMuc2NyZWVuUGh5c2ljYWxQaXhlbHM7XG4gICAgICAgIGRpbXMuc2NyZWVuID0ge1xuICAgICAgICAgIHdpZHRoOiBzY3JlZW5QaHlzaWNhbFBpeGVscy53aWR0aCAvIHNjcmVlblBoeXNpY2FsUGl4ZWxzLnNjYWxlLFxuICAgICAgICAgIGhlaWdodDogc2NyZWVuUGh5c2ljYWxQaXhlbHMuaGVpZ2h0IC8gc2NyZWVuUGh5c2ljYWxQaXhlbHMuc2NhbGUsXG4gICAgICAgICAgc2NhbGU6IHNjcmVlblBoeXNpY2FsUGl4ZWxzLnNjYWxlLFxuICAgICAgICAgIGZvbnRTY2FsZTogc2NyZWVuUGh5c2ljYWxQaXhlbHMuZm9udFNjYWxlLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIGRlbGV0ZSBzbyBubyBjYWxsZXJzIHJlbHkgb24gdGhpcyBleGlzdGluZ1xuICAgICAgICBkZWxldGUgZGltcy5zY3JlZW5QaHlzaWNhbFBpeGVscztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpbXMuc2NyZWVuID0gZGltcy53aW5kb3c7XG4gICAgICB9XG4gICAgICAvLyBkZWxldGUgc28gbm8gY2FsbGVycyByZWx5IG9uIHRoaXMgZXhpc3RpbmdcbiAgICAgIGRlbGV0ZSBkaW1zLndpbmRvd1BoeXNpY2FsUGl4ZWxzO1xuICAgIH1cblxuICAgIE9iamVjdC5hc3NpZ24oZGltZW5zaW9ucywgZGltcyk7XG4gICAgaWYgKGRpbWVuc2lvbnNJbml0aWFsaXplZCkge1xuICAgICAgLy8gRG9uJ3QgZmlyZSAnY2hhbmdlJyB0aGUgZmlyc3QgdGltZSB0aGUgZGltZW5zaW9ucyBhcmUgc2V0LlxuICAgICAgZXZlbnRFbWl0dGVyLmVtaXQoJ2NoYW5nZScsIHtcbiAgICAgICAgd2luZG93OiBkaW1lbnNpb25zLndpbmRvdyxcbiAgICAgICAgc2NyZWVuOiBkaW1lbnNpb25zLnNjcmVlbixcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBkaW1lbnNpb25zSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsIGRpbWVuc2lvbnMgYXJlIHNldCBiZWZvcmUgYHJ1bkFwcGxpY2F0aW9uYCBpcyBjYWxsZWQgc28gdGhleSBzaG91bGRcbiAgICogYmUgYXZhaWxhYmxlIGJlZm9yZSBhbnkgb3RoZXIgcmVxdWlyZSdzIGFyZSBydW4sIGJ1dCBtYXkgYmUgdXBkYXRlZCBsYXRlci5cbiAgICpcbiAgICogTm90ZTogQWx0aG91Z2ggZGltZW5zaW9ucyBhcmUgYXZhaWxhYmxlIGltbWVkaWF0ZWx5LCB0aGV5IG1heSBjaGFuZ2UgKGUuZ1xuICAgKiBkdWUgdG8gZGV2aWNlIHJvdGF0aW9uKSBzbyBhbnkgcmVuZGVyaW5nIGxvZ2ljIG9yIHN0eWxlcyB0aGF0IGRlcGVuZCBvblxuICAgKiB0aGVzZSBjb25zdGFudHMgc2hvdWxkIHRyeSB0byBjYWxsIHRoaXMgZnVuY3Rpb24gb24gZXZlcnkgcmVuZGVyLCByYXRoZXJcbiAgICogdGhhbiBjYWNoaW5nIHRoZSB2YWx1ZSAoZm9yIGV4YW1wbGUsIHVzaW5nIGlubGluZSBzdHlsZXMgcmF0aGVyIHRoYW5cbiAgICogc2V0dGluZyBhIHZhbHVlIGluIGEgYFN0eWxlU2hlZXRgKS5cbiAgICpcbiAgICogRXhhbXBsZTogYHZhciB7aGVpZ2h0LCB3aWR0aH0gPSBEaW1lbnNpb25zLmdldCgnd2luZG93Jyk7YFxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZGltIE5hbWUgb2YgZGltZW5zaW9uIGFzIGRlZmluZWQgd2hlbiBjYWxsaW5nIGBzZXRgLlxuICAgKiBAcmV0dXJucyB7T2JqZWN0P30gVmFsdWUgZm9yIHRoZSBkaW1lbnNpb24uXG4gICAqL1xuICBzdGF0aWMgZ2V0KGRpbTogc3RyaW5nKTogT2JqZWN0IHtcbiAgICBpbnZhcmlhbnQoZGltZW5zaW9uc1tkaW1dLCAnTm8gZGltZW5zaW9uIHNldCBmb3Iga2V5ICcgKyBkaW0pO1xuICAgIHJldHVybiBkaW1lbnNpb25zW2RpbV07XG4gIH1cblxuICAvKipcbiAgICogQWRkIGFuIGV2ZW50IGhhbmRsZXIuIFN1cHBvcnRlZCBldmVudHM6XG4gICAqXG4gICAqIC0gYGNoYW5nZWA6IEZpcmVzIHdoZW4gYSBwcm9wZXJ0eSB3aXRoaW4gdGhlIGBEaW1lbnNpb25zYCBvYmplY3QgY2hhbmdlcy4gVGhlIGFyZ3VtZW50XG4gICAqICAgdG8gdGhlIGV2ZW50IGhhbmRsZXIgaXMgYW4gb2JqZWN0IHdpdGggYHdpbmRvd2AgYW5kIGBzY3JlZW5gIHByb3BlcnRpZXMgd2hvc2UgdmFsdWVzXG4gICAqICAgYXJlIHRoZSBzYW1lIGFzIHRoZSByZXR1cm4gdmFsdWVzIG9mIGBEaW1lbnNpb25zLmdldCgnd2luZG93JylgIGFuZFxuICAgKiAgIGBEaW1lbnNpb25zLmdldCgnc2NyZWVuJylgLCByZXNwZWN0aXZlbHkuXG4gICAqL1xuICBzdGF0aWMgYWRkRXZlbnRMaXN0ZW5lcih0eXBlOiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgdHlwZSA9PT0gJ2NoYW5nZScsXG4gICAgICAnVHJ5aW5nIHRvIHN1YnNjcmliZSB0byB1bmtub3duIGV2ZW50OiBcIiVzXCInLFxuICAgICAgdHlwZSxcbiAgICApO1xuICAgIGV2ZW50RW1pdHRlci5hZGRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgYW4gZXZlbnQgaGFuZGxlci5cbiAgICovXG4gIHN0YXRpYyByZW1vdmVFdmVudExpc3RlbmVyKHR5cGU6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlID09PSAnY2hhbmdlJyxcbiAgICAgICdUcnlpbmcgdG8gcmVtb3ZlIGxpc3RlbmVyIGZvciB1bmtub3duIGV2ZW50OiBcIiVzXCInLFxuICAgICAgdHlwZSxcbiAgICApO1xuICAgIGV2ZW50RW1pdHRlci5yZW1vdmVMaXN0ZW5lcih0eXBlLCBoYW5kbGVyKTtcbiAgfVxufVxuXG5sZXQgZGltczogP3tba2V5OiBzdHJpbmddOiBhbnl9ID1cbiAgZ2xvYmFsLm5hdGl2ZUV4dGVuc2lvbnMgJiZcbiAgZ2xvYmFsLm5hdGl2ZUV4dGVuc2lvbnMuRGV2aWNlSW5mbyAmJlxuICBnbG9iYWwubmF0aXZlRXh0ZW5zaW9ucy5EZXZpY2VJbmZvLkRpbWVuc2lvbnM7XG5sZXQgbmF0aXZlRXh0ZW5zaW9uc0VuYWJsZWQgPSB0cnVlO1xuaWYgKCFkaW1zKSB7XG4gIGNvbnN0IERldmljZUluZm8gPSByZXF1aXJlKCcuL0RldmljZUluZm8nKTtcbiAgZGltcyA9IERldmljZUluZm8uRGltZW5zaW9ucztcbiAgbmF0aXZlRXh0ZW5zaW9uc0VuYWJsZWQgPSBmYWxzZTtcbn1cblxuaW52YXJpYW50KFxuICBkaW1zLFxuICAnRWl0aGVyIERldmljZUluZm8gbmF0aXZlIGV4dGVuc2lvbiBvciBEZXZpY2VJbmZvIE5hdGl2ZSBNb2R1bGUgbXVzdCBiZSByZWdpc3RlcmVkJyxcbik7XG5EaW1lbnNpb25zLnNldChkaW1zKTtcbmlmICghbmF0aXZlRXh0ZW5zaW9uc0VuYWJsZWQpIHtcbiAgUkNURGV2aWNlRXZlbnRFbWl0dGVyLmFkZExpc3RlbmVyKCdkaWRVcGRhdGVEaW1lbnNpb25zJywgZnVuY3Rpb24odXBkYXRlKSB7XG4gICAgRGltZW5zaW9ucy5zZXQodXBkYXRlKTtcbiAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gRGltZW5zaW9ucztcbiJdfQ==