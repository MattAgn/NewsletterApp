b5fc33cf9d8313a90e774bec407d4f59
"use strict";

var Buffer = require("safer-buffer").Buffer;

var bomHandling = require("./bom-handling"),
    iconv = module.exports;

iconv.encodings = null;
iconv.defaultCharUnicode = '�';
iconv.defaultCharSingleByte = '?';

iconv.encode = function encode(str, encoding, options) {
  str = "" + (str || "");
  var encoder = iconv.getEncoder(encoding, options);
  var res = encoder.write(str);
  var trail = encoder.end();
  return trail && trail.length > 0 ? Buffer.concat([res, trail]) : res;
};

iconv.decode = function decode(buf, encoding, options) {
  if (typeof buf === 'string') {
    if (!iconv.skipDecodeWarning) {
      console.error('Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding');
      iconv.skipDecodeWarning = true;
    }

    buf = Buffer.from("" + (buf || ""), "binary");
  }

  var decoder = iconv.getDecoder(encoding, options);
  var res = decoder.write(buf);
  var trail = decoder.end();
  return trail ? res + trail : res;
};

iconv.encodingExists = function encodingExists(enc) {
  try {
    iconv.getCodec(enc);
    return true;
  } catch (e) {
    return false;
  }
};

iconv.toEncoding = iconv.encode;
iconv.fromEncoding = iconv.decode;
iconv._codecDataCache = {};

iconv.getCodec = function getCodec(encoding) {
  if (!iconv.encodings) iconv.encodings = require("../encodings");

  var enc = iconv._canonicalizeEncoding(encoding);

  var codecOptions = {};

  while (true) {
    var codec = iconv._codecDataCache[enc];
    if (codec) return codec;
    var codecDef = iconv.encodings[enc];

    switch (typeof codecDef) {
      case "string":
        enc = codecDef;
        break;

      case "object":
        for (var key in codecDef) {
          codecOptions[key] = codecDef[key];
        }

        if (!codecOptions.encodingName) codecOptions.encodingName = enc;
        enc = codecDef.type;
        break;

      case "function":
        if (!codecOptions.encodingName) codecOptions.encodingName = enc;
        codec = new codecDef(codecOptions, iconv);
        iconv._codecDataCache[codecOptions.encodingName] = codec;
        return codec;

      default:
        throw new Error("Encoding not recognized: '" + encoding + "' (searched as: '" + enc + "')");
    }
  }
};

iconv._canonicalizeEncoding = function (encoding) {
  return ('' + encoding).toLowerCase().replace(/:\d{4}$|[^0-9a-z]/g, "");
};

iconv.getEncoder = function getEncoder(encoding, options) {
  var codec = iconv.getCodec(encoding),
      encoder = new codec.encoder(options, codec);
  if (codec.bomAware && options && options.addBOM) encoder = new bomHandling.PrependBOM(encoder, options);
  return encoder;
};

iconv.getDecoder = function getDecoder(encoding, options) {
  var codec = iconv.getCodec(encoding),
      decoder = new codec.decoder(options, codec);
  if (codec.bomAware && !(options && options.stripBOM === false)) decoder = new bomHandling.StripBOM(decoder, options);
  return decoder;
};

var nodeVer = typeof process !== 'undefined' && process.versions && process.versions.node;

if (nodeVer) {
  var nodeVerArr = nodeVer.split(".").map(Number);

  if (nodeVerArr[0] > 0 || nodeVerArr[1] >= 10) {
    require("./streams")(iconv);
  }

  require("./extend-node")(iconv);
}

if ("Ā" != "\u0100") {
  console.error("iconv-lite warning: javascript files use encoding different from utf-8. See https://github.com/ashtuchkin/iconv-lite/wiki/Javascript-source-file-encodings for more info.");
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIkJ1ZmZlciIsInJlcXVpcmUiLCJib21IYW5kbGluZyIsImljb252IiwibW9kdWxlIiwiZXhwb3J0cyIsImVuY29kaW5ncyIsImRlZmF1bHRDaGFyVW5pY29kZSIsImRlZmF1bHRDaGFyU2luZ2xlQnl0ZSIsImVuY29kZSIsInN0ciIsImVuY29kaW5nIiwib3B0aW9ucyIsImVuY29kZXIiLCJnZXRFbmNvZGVyIiwicmVzIiwid3JpdGUiLCJ0cmFpbCIsImVuZCIsImxlbmd0aCIsImNvbmNhdCIsImRlY29kZSIsImJ1ZiIsInNraXBEZWNvZGVXYXJuaW5nIiwiY29uc29sZSIsImVycm9yIiwiZnJvbSIsImRlY29kZXIiLCJnZXREZWNvZGVyIiwiZW5jb2RpbmdFeGlzdHMiLCJlbmMiLCJnZXRDb2RlYyIsImUiLCJ0b0VuY29kaW5nIiwiZnJvbUVuY29kaW5nIiwiX2NvZGVjRGF0YUNhY2hlIiwiX2Nhbm9uaWNhbGl6ZUVuY29kaW5nIiwiY29kZWNPcHRpb25zIiwiY29kZWMiLCJjb2RlY0RlZiIsImtleSIsImVuY29kaW5nTmFtZSIsInR5cGUiLCJFcnJvciIsInRvTG93ZXJDYXNlIiwicmVwbGFjZSIsImJvbUF3YXJlIiwiYWRkQk9NIiwiUHJlcGVuZEJPTSIsInN0cmlwQk9NIiwiU3RyaXBCT00iLCJub2RlVmVyIiwicHJvY2VzcyIsInZlcnNpb25zIiwibm9kZSIsIm5vZGVWZXJBcnIiLCJzcGxpdCIsIm1hcCIsIk51bWJlciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBSUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsY0FBRCxDQUFQLENBQXdCRCxNQUFyQzs7QUFFQSxJQUFJRSxXQUFXLEdBQUdELE9BQU8sQ0FBQyxnQkFBRCxDQUF6QjtBQUFBLElBQ0lFLEtBQUssR0FBR0MsTUFBTSxDQUFDQyxPQURuQjs7QUFLQUYsS0FBSyxDQUFDRyxTQUFOLEdBQWtCLElBQWxCO0FBR0FILEtBQUssQ0FBQ0ksa0JBQU4sR0FB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QSxVQUFVLENBQUMsQ0FBRCxDQUFWLElBQWlCLEVBQTFDLEVBQThDO0FBQzFDdEQsSUFBQUEsT0FBTyxDQUFDLFdBQUQsQ0FBUCxDQUFxQkUsS0FBckI7QUFDSDs7QUFHREYsRUFBQUEsT0FBTyxDQUFDLGVBQUQsQ0FBUCxDQUF5QkUsS0FBekI7QUFDSDs7QUFFRCxJQUFJLE9BQU8sUUFBWCxFQUFxQjtBQUNqQnFCLEVBQUFBLE9BQU8sQ0FBQ0MsS0FBUixDQUFjLDJLQUFkO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLy8gU29tZSBlbnZpcm9ubWVudHMgZG9uJ3QgaGF2ZSBnbG9iYWwgQnVmZmVyIChlLmcuIFJlYWN0IE5hdGl2ZSkuXG4vLyBTb2x1dGlvbiB3b3VsZCBiZSBpbnN0YWxsaW5nIG5wbSBtb2R1bGVzIFwiYnVmZmVyXCIgYW5kIFwic3RyZWFtXCIgZXhwbGljaXRseS5cbnZhciBCdWZmZXIgPSByZXF1aXJlKFwic2FmZXItYnVmZmVyXCIpLkJ1ZmZlcjtcblxudmFyIGJvbUhhbmRsaW5nID0gcmVxdWlyZShcIi4vYm9tLWhhbmRsaW5nXCIpLFxuICAgIGljb252ID0gbW9kdWxlLmV4cG9ydHM7XG5cbi8vIEFsbCBjb2RlY3MgYW5kIGFsaWFzZXMgYXJlIGtlcHQgaGVyZSwga2V5ZWQgYnkgZW5jb2RpbmcgbmFtZS9hbGlhcy5cbi8vIFRoZXkgYXJlIGxhenkgbG9hZGVkIGluIGBpY29udi5nZXRDb2RlY2AgZnJvbSBgZW5jb2RpbmdzL2luZGV4LmpzYC5cbmljb252LmVuY29kaW5ncyA9IG51bGw7XG5cbi8vIENoYXJhY3RlcnMgZW1pdHRlZCBpbiBjYXNlIG9mIGVycm9yLlxuaWNvbnYuZGVmYXVsdENoYXJVbmljb2RlID0gJ++/vSc7XG5pY29udi5kZWZhdWx0Q2hhclNpbmdsZUJ5dGUgPSAnPyc7XG5cbi8vIFB1YmxpYyBBUEkuXG5pY29udi5lbmNvZGUgPSBmdW5jdGlvbiBlbmNvZGUoc3RyLCBlbmNvZGluZywgb3B0aW9ucykge1xuICAgIHN0ciA9IFwiXCIgKyAoc3RyIHx8IFwiXCIpOyAvLyBFbnN1cmUgc3RyaW5nLlxuXG4gICAgdmFyIGVuY29kZXIgPSBpY29udi5nZXRFbmNvZGVyKGVuY29kaW5nLCBvcHRpb25zKTtcblxuICAgIHZhciByZXMgPSBlbmNvZGVyLndyaXRlKHN0cik7XG4gICAgdmFyIHRyYWlsID0gZW5jb2Rlci5lbmQoKTtcbiAgICBcbiAgICByZXR1cm4gKHRyYWlsICYmIHRyYWlsLmxlbmd0aCA+IDApID8gQnVmZmVyLmNvbmNhdChbcmVzLCB0cmFpbF0pIDogcmVzO1xufVxuXG5pY29udi5kZWNvZGUgPSBmdW5jdGlvbiBkZWNvZGUoYnVmLCBlbmNvZGluZywgb3B0aW9ucykge1xuICAgIGlmICh0eXBlb2YgYnVmID09PSAnc3RyaW5nJykge1xuICAgICAgICBpZiAoIWljb252LnNraXBEZWNvZGVXYXJuaW5nKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJY29udi1saXRlIHdhcm5pbmc6IGRlY29kZSgpLWluZyBzdHJpbmdzIGlzIGRlcHJlY2F0ZWQuIFJlZmVyIHRvIGh0dHBzOi8vZ2l0aHViLmNvbS9hc2h0dWNoa2luL2ljb252LWxpdGUvd2lraS9Vc2UtQnVmZmVycy13aGVuLWRlY29kaW5nJyk7XG4gICAgICAgICAgICBpY29udi5za2lwRGVjb2RlV2FybmluZyA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBidWYgPSBCdWZmZXIuZnJvbShcIlwiICsgKGJ1ZiB8fCBcIlwiKSwgXCJiaW5hcnlcIik7IC8vIEVuc3VyZSBidWZmZXIuXG4gICAgfVxuXG4gICAgdmFyIGRlY29kZXIgPSBpY29udi5nZXREZWNvZGVyKGVuY29kaW5nLCBvcHRpb25zKTtcblxuICAgIHZhciByZXMgPSBkZWNvZGVyLndyaXRlKGJ1Zik7XG4gICAgdmFyIHRyYWlsID0gZGVjb2Rlci5lbmQoKTtcblxuICAgIHJldHVybiB0cmFpbCA/IChyZXMgKyB0cmFpbCkgOiByZXM7XG59XG5cbmljb252LmVuY29kaW5nRXhpc3RzID0gZnVuY3Rpb24gZW5jb2RpbmdFeGlzdHMoZW5jKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWNvbnYuZ2V0Q29kZWMoZW5jKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG4vLyBMZWdhY3kgYWxpYXNlcyB0byBjb252ZXJ0IGZ1bmN0aW9uc1xuaWNvbnYudG9FbmNvZGluZyA9IGljb252LmVuY29kZTtcbmljb252LmZyb21FbmNvZGluZyA9IGljb252LmRlY29kZTtcblxuLy8gU2VhcmNoIGZvciBhIGNvZGVjIGluIGljb252LmVuY29kaW5ncy4gQ2FjaGUgY29kZWMgZGF0YSBpbiBpY29udi5fY29kZWNEYXRhQ2FjaGUuXG5pY29udi5fY29kZWNEYXRhQ2FjaGUgPSB7fTtcbmljb252LmdldENvZGVjID0gZnVuY3Rpb24gZ2V0Q29kZWMoZW5jb2RpbmcpIHtcbiAgICBpZiAoIWljb252LmVuY29kaW5ncylcbiAgICAgICAgaWNvbnYuZW5jb2RpbmdzID0gcmVxdWlyZShcIi4uL2VuY29kaW5nc1wiKTsgLy8gTGF6eSBsb2FkIGFsbCBlbmNvZGluZyBkZWZpbml0aW9ucy5cbiAgICBcbiAgICAvLyBDYW5vbmljYWxpemUgZW5jb2RpbmcgbmFtZTogc3RyaXAgYWxsIG5vbi1hbHBoYW51bWVyaWMgY2hhcnMgYW5kIGFwcGVuZGVkIHllYXIuXG4gICAgdmFyIGVuYyA9IGljb252Ll9jYW5vbmljYWxpemVFbmNvZGluZyhlbmNvZGluZyk7XG5cbiAgICAvLyBUcmF2ZXJzZSBpY29udi5lbmNvZGluZ3MgdG8gZmluZCBhY3R1YWwgY29kZWMuXG4gICAgdmFyIGNvZGVjT3B0aW9ucyA9IHt9O1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIHZhciBjb2RlYyA9IGljb252Ll9jb2RlY0RhdGFDYWNoZVtlbmNdO1xuICAgICAgICBpZiAoY29kZWMpXG4gICAgICAgICAgICByZXR1cm4gY29kZWM7XG5cbiAgICAgICAgdmFyIGNvZGVjRGVmID0gaWNvbnYuZW5jb2RpbmdzW2VuY107XG5cbiAgICAgICAgc3dpdGNoICh0eXBlb2YgY29kZWNEZWYpIHtcbiAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjogLy8gRGlyZWN0IGFsaWFzIHRvIG90aGVyIGVuY29kaW5nLlxuICAgICAgICAgICAgICAgIGVuYyA9IGNvZGVjRGVmO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIFwib2JqZWN0XCI6IC8vIEFsaWFzIHdpdGggb3B0aW9ucy4gQ2FuIGJlIGxheWVyZWQuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIGNvZGVjRGVmKVxuICAgICAgICAgICAgICAgICAgICBjb2RlY09wdGlvbnNba2V5XSA9IGNvZGVjRGVmW2tleV07XG5cbiAgICAgICAgICAgICAgICBpZiAoIWNvZGVjT3B0aW9ucy5lbmNvZGluZ05hbWUpXG4gICAgICAgICAgICAgICAgICAgIGNvZGVjT3B0aW9ucy5lbmNvZGluZ05hbWUgPSBlbmM7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZW5jID0gY29kZWNEZWYudHlwZTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBcImZ1bmN0aW9uXCI6IC8vIENvZGVjIGl0c2VsZi5cbiAgICAgICAgICAgICAgICBpZiAoIWNvZGVjT3B0aW9ucy5lbmNvZGluZ05hbWUpXG4gICAgICAgICAgICAgICAgICAgIGNvZGVjT3B0aW9ucy5lbmNvZGluZ05hbWUgPSBlbmM7XG5cbiAgICAgICAgICAgICAgICAvLyBUaGUgY29kZWMgZnVuY3Rpb24gbXVzdCBsb2FkIGFsbCB0YWJsZXMgYW5kIHJldHVybiBvYmplY3Qgd2l0aCAuZW5jb2RlciBhbmQgLmRlY29kZXIgbWV0aG9kcy5cbiAgICAgICAgICAgICAgICAvLyBJdCdsbCBiZSBjYWxsZWQgb25seSBvbmNlIChmb3IgZWFjaCBkaWZmZXJlbnQgb3B0aW9ucyBvYmplY3QpLlxuICAgICAgICAgICAgICAgIGNvZGVjID0gbmV3IGNvZGVjRGVmKGNvZGVjT3B0aW9ucywgaWNvbnYpO1xuXG4gICAgICAgICAgICAgICAgaWNvbnYuX2NvZGVjRGF0YUNhY2hlW2NvZGVjT3B0aW9ucy5lbmNvZGluZ05hbWVdID0gY29kZWM7IC8vIFNhdmUgaXQgdG8gYmUgcmV1c2VkIGxhdGVyLlxuICAgICAgICAgICAgICAgIHJldHVybiBjb2RlYztcblxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbmNvZGluZyBub3QgcmVjb2duaXplZDogJ1wiICsgZW5jb2RpbmcgKyBcIicgKHNlYXJjaGVkIGFzOiAnXCIrZW5jK1wiJylcIik7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmljb252Ll9jYW5vbmljYWxpemVFbmNvZGluZyA9IGZ1bmN0aW9uKGVuY29kaW5nKSB7XG4gICAgLy8gQ2Fub25pY2FsaXplIGVuY29kaW5nIG5hbWU6IHN0cmlwIGFsbCBub24tYWxwaGFudW1lcmljIGNoYXJzIGFuZCBhcHBlbmRlZCB5ZWFyLlxuICAgIHJldHVybiAoJycrZW5jb2RpbmcpLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvOlxcZHs0fSR8W14wLTlhLXpdL2csIFwiXCIpO1xufVxuXG5pY29udi5nZXRFbmNvZGVyID0gZnVuY3Rpb24gZ2V0RW5jb2RlcihlbmNvZGluZywgb3B0aW9ucykge1xuICAgIHZhciBjb2RlYyA9IGljb252LmdldENvZGVjKGVuY29kaW5nKSxcbiAgICAgICAgZW5jb2RlciA9IG5ldyBjb2RlYy5lbmNvZGVyKG9wdGlvbnMsIGNvZGVjKTtcblxuICAgIGlmIChjb2RlYy5ib21Bd2FyZSAmJiBvcHRpb25zICYmIG9wdGlvbnMuYWRkQk9NKVxuICAgICAgICBlbmNvZGVyID0gbmV3IGJvbUhhbmRsaW5nLlByZXBlbmRCT00oZW5jb2Rlciwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gZW5jb2Rlcjtcbn1cblxuaWNvbnYuZ2V0RGVjb2RlciA9IGZ1bmN0aW9uIGdldERlY29kZXIoZW5jb2RpbmcsIG9wdGlvbnMpIHtcbiAgICB2YXIgY29kZWMgPSBpY29udi5nZXRDb2RlYyhlbmNvZGluZyksXG4gICAgICAgIGRlY29kZXIgPSBuZXcgY29kZWMuZGVjb2RlcihvcHRpb25zLCBjb2RlYyk7XG5cbiAgICBpZiAoY29kZWMuYm9tQXdhcmUgJiYgIShvcHRpb25zICYmIG9wdGlvbnMuc3RyaXBCT00gPT09IGZhbHNlKSlcbiAgICAgICAgZGVjb2RlciA9IG5ldyBib21IYW5kbGluZy5TdHJpcEJPTShkZWNvZGVyLCBvcHRpb25zKTtcblxuICAgIHJldHVybiBkZWNvZGVyO1xufVxuXG5cbi8vIExvYWQgZXh0ZW5zaW9ucyBpbiBOb2RlLiBBbGwgb2YgdGhlbSBhcmUgb21pdHRlZCBpbiBCcm93c2VyaWZ5IGJ1aWxkIHZpYSAnYnJvd3NlcicgZmllbGQgaW4gcGFja2FnZS5qc29uLlxudmFyIG5vZGVWZXIgPSB0eXBlb2YgcHJvY2VzcyAhPT0gJ3VuZGVmaW5lZCcgJiYgcHJvY2Vzcy52ZXJzaW9ucyAmJiBwcm9jZXNzLnZlcnNpb25zLm5vZGU7XG5pZiAobm9kZVZlcikge1xuXG4gICAgLy8gTG9hZCBzdHJlYW1pbmcgc3VwcG9ydCBpbiBOb2RlIHYwLjEwK1xuICAgIHZhciBub2RlVmVyQXJyID0gbm9kZVZlci5zcGxpdChcIi5cIikubWFwKE51bWJlcik7XG4gICAgaWYgKG5vZGVWZXJBcnJbMF0gPiAwIHx8IG5vZGVWZXJBcnJbMV0gPj0gMTApIHtcbiAgICAgICAgcmVxdWlyZShcIi4vc3RyZWFtc1wiKShpY29udik7XG4gICAgfVxuXG4gICAgLy8gTG9hZCBOb2RlIHByaW1pdGl2ZSBleHRlbnNpb25zLlxuICAgIHJlcXVpcmUoXCIuL2V4dGVuZC1ub2RlXCIpKGljb252KTtcbn1cblxuaWYgKFwixIBcIiAhPSBcIlxcdTAxMDBcIikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJpY29udi1saXRlIHdhcm5pbmc6IGphdmFzY3JpcHQgZmlsZXMgdXNlIGVuY29kaW5nIGRpZmZlcmVudCBmcm9tIHV0Zi04LiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2FzaHR1Y2hraW4vaWNvbnYtbGl0ZS93aWtpL0phdmFzY3JpcHQtc291cmNlLWZpbGUtZW5jb2RpbmdzIGZvciBtb3JlIGluZm8uXCIpO1xufVxuIl19