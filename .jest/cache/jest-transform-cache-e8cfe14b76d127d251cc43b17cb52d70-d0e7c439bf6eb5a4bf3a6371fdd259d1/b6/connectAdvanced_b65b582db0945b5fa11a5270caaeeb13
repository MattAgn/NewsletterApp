32e72686f64287e29c174fc3ac856588
"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports["default"] = connectAdvanced;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _hoistNonReactStatics = _interopRequireDefault(require("hoist-non-react-statics"));

var _invariant = _interopRequireDefault(require("invariant"));

var _react = _interopRequireWildcard(require("react"));

var _reactIs = require("react-is");

var _Subscription = _interopRequireDefault(require("../utils/Subscription"));

var _Context = require("./Context");

var EMPTY_ARRAY = [];
var NO_SUBSCRIPTION_ARRAY = [null, null];

var stringifyComponent = function stringifyComponent(Comp) {
  try {
    return JSON.stringify(Comp);
  } catch (err) {
    return String(Comp);
  }
};

function storeStateUpdatesReducer(state, action) {
  var updateCount = state[1];
  return [action.payload, updateCount + 1];
}

var initStateUpdates = function initStateUpdates() {
  return [null, 0];
};

var useIsomorphicLayoutEffect = typeof window !== 'undefined' && typeof window.document !== 'undefined' && typeof window.document.createElement !== 'undefined' ? _react.useLayoutEffect : _react.useEffect;

function connectAdvanced(selectorFactory, _ref) {
  if (_ref === void 0) {
    _ref = {};
  }

  var _ref2 = _ref,
      _ref2$getDisplayName = _ref2.getDisplayName,
      getDisplayName = _ref2$getDisplayName === void 0 ? function (name) {
    return "ConnectAdvanced(" + name + ")";
  } : _ref2$getDisplayName,
      _ref2$methodName = _ref2.methodName,
      methodName = _ref2$methodName === void 0 ? 'connectAdvanced' : _ref2$methodName,
      _ref2$renderCountProp = _ref2.renderCountProp,
      renderCountProp = _ref2$renderCountProp === void 0 ? undefined : _ref2$renderCountProp,
      _ref2$shouldHandleSta = _ref2.shouldHandleStateChanges,
      shouldHandleStateChanges = _ref2$shouldHandleSta === void 0 ? true : _ref2$shouldHandleSta,
      _ref2$storeKey = _ref2.storeKey,
      storeKey = _ref2$storeKey === void 0 ? 'store' : _ref2$storeKey,
      _ref2$withRef = _ref2.withRef,
      withRef = _ref2$withRef === void 0 ? false : _ref2$withRef,
      _ref2$forwardRef = _ref2.forwardRef,
      forwardRef = _ref2$forwardRef === void 0 ? false : _ref2$forwardRef,
      _ref2$context = _ref2.context,
      context = _ref2$context === void 0 ? _Context.ReactReduxContext : _ref2$context,
      connectOptions = (0, _objectWithoutPropertiesLoose2["default"])(_ref2, ["getDisplayName", "methodName", "renderCountProp", "shouldHandleStateChanges", "storeKey", "withRef", "forwardRef", "context"]);
  (0, _invariant["default"])(renderCountProp === undefined, "renderCountProp is removed. render counting is built into the latest React Dev Tools profiling extension");
  (0, _invariant["default"])(!withRef, 'withRef is removed. To access the wrapped instance, use a ref on the connected component');
  var customStoreWarningMessage = 'To use a custom Redux store for specific components, create a custom React context with ' + "React.createContext(), and pass the context object to React Redux's Provider and specific components" + ' like: <Provider context={MyContext}><ConnectedComponent context={MyContext} /></Provider>. ' + 'You may also pass a {context : MyContext} option to connect';
  (0, _invariant["default"])(storeKey === 'store', 'storeKey has been removed and does not do anything. ' + customStoreWarningMessage);
  var Context = context;
  return function wrapWithConnect(WrappedComponent) {
    if (process.env.NODE_ENV !== 'production') {
      (0, _invariant["default"])((0, _reactIs.isValidElementType)(WrappedComponent), "You must pass a component to the function returned by " + (methodName + ". Instead received " + stringifyComponent(WrappedComponent)));
    }

    var wrappedComponentName = WrappedComponent.displayName || WrappedComponent.name || 'Component';
    var displayName = getDisplayName(wrappedComponentName);
    var selectorFactoryOptions = (0, _extends2["default"])({}, connectOptions, {
      getDisplayName: getDisplayName,
      methodName: methodName,
      renderCountProp: renderCountProp,
      shouldHandleStateChanges: shouldHandleStateChanges,
      storeKey: storeKey,
      displayName: displayName,
      wrappedComponentName: wrappedComponentName,
      WrappedComponent: WrappedComponent
    });
    var pure = connectOptions.pure;

    function createChildSelector(store) {
      return selectorFactory(store.dispatch, selectorFactoryOptions);
    }

    var usePureOnlyMemo = pure ? _react.useMemo : function (callback) {
      return callback();
    };

    function ConnectFunction(props) {
      var _useMemo = (0, _react.useMemo)(function () {
        var forwardedRef = props.forwardedRef,
            wrapperProps = (0, _objectWithoutPropertiesLoose2["default"])(props, ["forwardedRef"]);
        return [props.context, forwardedRef, wrapperProps];
      }, [props]),
          propsContext = _useMemo[0],
          forwardedRef = _useMemo[1],
          wrapperProps = _useMemo[2];

      var ContextToUse = (0, _react.useMemo)(function () {
        return propsContext && propsContext.Consumer && (0, _reactIs.isContextConsumer)(_react["default"].createElement(propsContext.Consumer, null)) ? propsContext : Context;
      }, [propsContext, Context]);
      var contextValue = (0, _react.useContext)(ContextToUse);
      var didStoreComeFromProps = Boolean(props.store);
      var didStoreComeFromContext = Boolean(contextValue) && Boolean(contextValue.store);
      (0, _invariant["default"])(didStoreComeFromProps || didStoreComeFromContext, "Could not find \"store\" in the context of " + ("\"" + displayName + "\". Either wrap the root component in a <Provider>, ") + "or pass a custom React context provider to <Provider> and the corresponding " + ("React context consumer to " + displayName + " in connect options."));
      var store = props.store || contextValue.store;
      var childPropsSelector = (0, _react.useMemo)(function () {
        return createChildSelector(store);
      }, [store]);

      var _useMemo2 = (0, _react.useMemo)(function () {
        if (!shouldHandleStateChanges) return NO_SUBSCRIPTION_ARRAY;
        var subscription = new _Subscription["default"](store, didStoreComeFromProps ? null : contextValue.subscription);
        var notifyNestedSubs = subscription.notifyNestedSubs.bind(subscription);
        return [subscription, notifyNestedSubs];
      }, [store, didStoreComeFromProps, contextValue]),
          subscription = _useMemo2[0],
          notifyNestedSubs = _useMemo2[1];

      var overriddenContextValue = (0, _react.useMemo)(function () {
        if (didStoreComeFromProps) {
          return contextValue;
        }

        return (0, _extends2["default"])({}, contextValue, {
          subscription: subscription
        });
      }, [didStoreComeFromProps, contextValue, subscription]);

      var _useReducer = (0, _react.useReducer)(storeStateUpdatesReducer, EMPTY_ARRAY, initStateUpdates),
          _useReducer$ = _useReducer[0],
          previousStateUpdateResult = _useReducer$[0],
          forceComponentUpdateDispatch = _useReducer[1];

      if (previousStateUpdateResult && previousStateUpdateResult.error) {
        throw previousStateUpdateResult.error;
      }

      var lastChildProps = (0, _react.useRef)();
      var lastWrapperProps = (0, _react.useRef)(wrapperProps);
      var childPropsFromStoreUpdate = (0, _react.useRef)();
      var renderIsScheduled = (0, _react.useRef)(false);
      var actualChildProps = usePureOnlyMemo(function () {
        if (childPropsFromStoreUpdate.current && wrapperProps === lastWrapperProps.current) {
          return childPropsFromStoreUpdate.current;
        }

        return childPropsSelector(store.getState(), wrapperProps);
      }, [store, previousStateUpdateResult, wrapperProps]);
      useIsomorphicLayoutEffect(function () {
        lastWrapperProps.current = wrapperProps;
        lastChildProps.current = actualChildProps;
        renderIsScheduled.current = false;

        if (childPropsFromStoreUpdate.current) {
          childPropsFromStoreUpdate.current = null;
          notifyNestedSubs();
        }
      });
      useIsomorphicLayoutEffect(function () {
        if (!shouldHandleStateChanges) return;
        var didUnsubscribe = false;
        var lastThrownError = null;

        var checkForUpdates = function checkForUpdates() {
          if (didUnsubscribe) {
            return;
          }

          var latestStoreState = store.getState();
          var newChildProps, error;

          try {
            newChildProps = childPropsSelector(latestStoreState, lastWrapperProps.current);
          } catch (e) {
            error = e;
            lastThrownError = e;
          }

          if (!error) {
            lastThrownError = null;
          }

          if (newChildProps === lastChildProps.current) {
            if (!renderIsScheduled.current) {
              notifyNestedSubs();
            }
          } else {
            lastChildProps.current = newChildProps;
            childPropsFromStoreUpdate.current = newChildProps;
            renderIsScheduled.current = true;
            forceComponentUpdateDispatch({
              type: 'STORE_UPDATED',
              payload: {
                latestStoreState: latestStoreState,
                error: error
              }
            });
          }
        };

        subscription.onStateChange = checkForUpdates;
        subscription.trySubscribe();
        checkForUpdates();

        var unsubscribeWrapper = function unsubscribeWrapper() {
          didUnsubscribe = true;
          subscription.tryUnsubscribe();
          subscription.onStateChange = null;

          if (lastThrownError) {
            throw lastThrownError;
          }
        };

        return unsubscribeWrapper;
      }, [store, subscription, childPropsSelector]);
      var renderedWrappedComponent = (0, _react.useMemo)(function () {
        return _react["default"].createElement(WrappedComponent, (0, _extends2["default"])({}, actualChildProps, {
          ref: forwardedRef
        }));
      }, [forwardedRef, WrappedComponent, actualChildProps]);
      var renderedChild = (0, _react.useMemo)(function () {
        if (shouldHandleStateChanges) {
          return _react["default"].createElement(ContextToUse.Provider, {
            value: overriddenContextValue
          }, renderedWrappedComponent);
        }

        return renderedWrappedComponent;
      }, [ContextToUse, renderedWrappedComponent, overriddenContextValue]);
      return renderedChild;
    }

    var Connect = pure ? _react["default"].memo(ConnectFunction) : ConnectFunction;
    Connect.WrappedComponent = WrappedComponent;
    Connect.displayName = displayName;

    if (forwardRef) {
      var forwarded = _react["default"].forwardRef(function forwardConnectRef(props, ref) {
        return _react["default"].createElement(Connect, (0, _extends2["default"])({}, props, {
          forwardedRef: ref
        }));
      });

      forwarded.displayName = displayName;
      forwarded.WrappedComponent = WrappedComponent;
      return (0, _hoistNonReactStatics["default"])(forwarded, WrappedComponent);
    }

    return (0, _hoistNonReactStatics["default"])(Connect, WrappedComponent);
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3RBZHZhbmNlZC5qcyJdLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInJlcXVpcmUiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJjb25uZWN0QWR2YW5jZWQiLCJfZXh0ZW5kczIiLCJfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTIiLCJfaG9pc3ROb25SZWFjdFN0YXRpY3MiLCJfaW52YXJpYW50IiwiX3JlYWN0IiwiX3JlYWN0SXMiLCJfU3Vic2NyaXB0aW9uIiwiX0NvbnRleHQiLCJFTVBUWV9BUlJBWSIsIk5PX1NVQlNDUklQVElPTl9BUlJBWSIsInN0cmluZ2lmeUNvbXBvbmVudCIsIkNvbXAiLCJKU09OIiwic3RyaW5naWZ5IiwiZXJyIiwiU3RyaW5nIiwic3RvcmVTdGF0ZVVwZGF0ZXNSZWR1Y2VyIiwic3RhdGUiLCJhY3Rpb24iLCJ1cGRhdGVDb3VudCIsInBheWxvYWQiLCJpbml0U3RhdGVVcGRhdGVzIiwidXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCIsIndpbmRvdyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInVzZUxheW91dEVmZmVjdCIsInVzZUVmZmVjdCIsInNlbGVjdG9yRmFjdG9yeSIsIl9yZWYiLCJfcmVmMiIsIl9yZWYyJGdldERpc3BsYXlOYW1lIiwiZ2V0RGlzcGxheU5hbWUiLCJuYW1lIiwiX3JlZjIkbWV0aG9kTmFtZSIsIm1ldGhvZE5hbWUiLCJfcmVmMiRyZW5kZXJDb3VudFByb3AiLCJyZW5kZXJDb3VudFByb3AiLCJ1bmRlZmluZWQiLCJfcmVmMiRzaG91bGRIYW5kbGVTdGEiLCJzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMiLCJfcmVmMiRzdG9yZUtleSIsInN0b3JlS2V5IiwiX3JlZjIkd2l0aFJlZiIsIndpdGhSZWYiLCJfcmVmMiRmb3J3YXJkUmVmIiwiZm9yd2FyZFJlZiIsIl9yZWYyJGNvbnRleHQiLCJjb250ZXh0IiwiUmVhY3RSZWR1eENvbnRleHQiLCJjb25uZWN0T3B0aW9ucyIsImN1c3RvbVN0b3JlV2FybmluZ01lc3NhZ2UiLCJDb250ZXh0Iiwid3JhcFdpdGhDb25uZWN0IiwiV3JhcHBlZENvbXBvbmVudCIsInByb2Nlc3MiLCJlbnYiLCJOT0RFX0VOViIsImlzVmFsaWRFbGVtZW50VHlwZSIsIndyYXBwZWRDb21wb25lbnROYW1lIiwiZGlzcGxheU5hbWUiLCJzZWxlY3RvckZhY3RvcnlPcHRpb25zIiwicHVyZSIsImNyZWF0ZUNoaWxkU2VsZWN0b3IiLCJzdG9yZSIsImRpc3BhdGNoIiwidXNlUHVyZU9ubHlNZW1vIiwidXNlTWVtbyIsImNhbGxiYWNrIiwiQ29ubmVjdEZ1bmN0aW9uIiwicHJvcHMiLCJfdXNlTWVtbyIsImZvcndhcmRlZFJlZiIsIndyYXBwZXJQcm9wcyIsInByb3BzQ29udGV4dCIsIkNvbnRleHRUb1VzZSIsIkNvbnN1bWVyIiwiaXNDb250ZXh0Q29uc3VtZXIiLCJjb250ZXh0VmFsdWUiLCJ1c2VDb250ZXh0IiwiZGlkU3RvcmVDb21lRnJvbVByb3BzIiwiQm9vbGVhbiIsImRpZFN0b3JlQ29tZUZyb21Db250ZXh0IiwiY2hpbGRQcm9wc1NlbGVjdG9yIiwiX3VzZU1lbW8yIiwic3Vic2NyaXB0aW9uIiwibm90aWZ5TmVzdGVkU3VicyIsImJpbmQiLCJvdmVycmlkZGVuQ29udGV4dFZhbHVlIiwiX3VzZVJlZHVjZXIiLCJ1c2VSZWR1Y2VyIiwiX3VzZVJlZHVjZXIkIiwicHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdCIsImZvcmNlQ29tcG9uZW50VXBkYXRlRGlzcGF0Y2giLCJlcnJvciIsImxhc3RDaGlsZFByb3BzIiwidXNlUmVmIiwibGFzdFdyYXBwZXJQcm9wcyIsImNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUiLCJyZW5kZXJJc1NjaGVkdWxlZCIsImFjdHVhbENoaWxkUHJvcHMiLCJjdXJyZW50IiwiZ2V0U3RhdGUiLCJkaWRVbnN1YnNjcmliZSIsImxhc3RUaHJvd25FcnJvciIsImNoZWNrRm9yVXBkYXRlcyIsImxhdGVzdFN0b3JlU3RhdGUiLCJuZXdDaGlsZFByb3BzIiwiZSIsInR5cGUiLCJvblN0YXRlQ2hhbmdlIiwidHJ5U3Vic2NyaWJlIiwidW5zdWJzY3JpYmVXcmFwcGVyIiwidHJ5VW5zdWJzY3JpYmUiLCJyZW5kZXJlZFdyYXBwZWRDb21wb25lbnQiLCJyZWYiLCJyZW5kZXJlZENoaWxkIiwiUHJvdmlkZXIiLCJ2YWx1ZSIsIkNvbm5lY3QiLCJtZW1vIiwiZm9yd2FyZGVkIiwiZm9yd2FyZENvbm5lY3RSZWYiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQUlBLHVCQUF1QixHQUFHQyxPQUFPLENBQUMsK0NBQUQsQ0FBckM7O0FBRUEsSUFBSUMsc0JBQXNCLEdBQUdELE9BQU8sQ0FBQyw4Q0FBRCxDQUFwQzs7QUFFQUUsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQyxTQUFELENBQVAsR0FBcUJFLGVBQXJCOztBQUVBLElBQUlDLFNBQVMsR0FBR0osc0JBQXNCLENBQUNELE9BQU8sQ0FBQyxnQ0FBRCxDQUFSLENBQXRDOztBQUVBLElBQUlNLDhCQUE4QixHQUFHTCxzQkFBc0IsQ0FBQ0QsT0FBTyxDQUFDLHFEQUFELENBQVIsQ0FBM0Q7O0FBRUEsSUFBSU8scUJBQXFCLEdBQUdOLHNCQUFzQixDQUFDRCxPQUFPLENBQUMseUJBQUQsQ0FBUixDQUFsRDs7QUFFQSxJQUFJUSxVQUFVLEdBQUdQLHNCQUFzQixDQUFDRCxPQUFPLENBQUMsV0FBRCxDQUFSLENBQXZDOztBQUVBLElBQUlTLE1BQU0sR0FBR1YsdUJBQXVCLENBQUNDLE9BQU8sQ0FBQyxPQUFELENBQVIsQ0FBcEM7O0FBRUEsSUFBSVUsUUFBUSxHQUFHVixPQUFPLENBQUMsVUFBRCxDQUF0Qjs7QUFFQSxJQUFJVyxhQUFhLEdBQUdWLHNCQUFzQixDQUFDRCxPQUFPLENBQUMsdUJBQUQsQ0FBUixDQUExQzs7QUFFQSxJQUFJWSxRQUFRLEdBQUdaLE9BQU8sQ0FBQyxXQUFELENBQXRC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RUFBMUIsRUFBOEJzRSxLQUE5QixFQUFxQztBQUNuRkUsVUFBQUEsWUFBWSxFQUFFMkM7QUFEcUUsU0FBckMsQ0FBekMsQ0FBUDtBQUdELE9BSmUsQ0FBaEI7O0FBTUFNLE1BQUFBLFNBQVMsQ0FBQzdELFdBQVYsR0FBd0JBLFdBQXhCO0FBQ0E2RCxNQUFBQSxTQUFTLENBQUNuRSxnQkFBVixHQUE2QkEsZ0JBQTdCO0FBQ0EsYUFBTyxDQUFDLEdBQUdwRCxxQkFBcUIsQ0FBQyxTQUFELENBQXpCLEVBQXNDdUgsU0FBdEMsRUFBaURuRSxnQkFBakQsQ0FBUDtBQUNEOztBQUVELFdBQU8sQ0FBQyxHQUFHcEQscUJBQXFCLENBQUMsU0FBRCxDQUF6QixFQUFzQ3FILE9BQXRDLEVBQStDakUsZ0JBQS9DLENBQVA7QUFDRCxHQXJRRDtBQXNRRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkXCIpO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdFwiKTtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gY29ubmVjdEFkdmFuY2VkO1xuXG52YXIgX2V4dGVuZHMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9leHRlbmRzXCIpKTtcblxudmFyIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZVwiKSk7XG5cbnZhciBfaG9pc3ROb25SZWFjdFN0YXRpY3MgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJob2lzdC1ub24tcmVhY3Qtc3RhdGljc1wiKSk7XG5cbnZhciBfaW52YXJpYW50ID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiaW52YXJpYW50XCIpKTtcblxudmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJyZWFjdFwiKSk7XG5cbnZhciBfcmVhY3RJcyA9IHJlcXVpcmUoXCJyZWFjdC1pc1wiKTtcblxudmFyIF9TdWJzY3JpcHRpb24gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuLi91dGlscy9TdWJzY3JpcHRpb25cIikpO1xuXG52YXIgX0NvbnRleHQgPSByZXF1aXJlKFwiLi9Db250ZXh0XCIpO1xuXG4vLyBEZWZpbmUgc29tZSBjb25zdGFudCBhcnJheXMganVzdCB0byBhdm9pZCByZS1jcmVhdGluZyB0aGVzZVxudmFyIEVNUFRZX0FSUkFZID0gW107XG52YXIgTk9fU1VCU0NSSVBUSU9OX0FSUkFZID0gW251bGwsIG51bGxdO1xuXG52YXIgc3RyaW5naWZ5Q29tcG9uZW50ID0gZnVuY3Rpb24gc3RyaW5naWZ5Q29tcG9uZW50KENvbXApIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoQ29tcCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHJldHVybiBTdHJpbmcoQ29tcCk7XG4gIH1cbn07XG5cbmZ1bmN0aW9uIHN0b3JlU3RhdGVVcGRhdGVzUmVkdWNlcihzdGF0ZSwgYWN0aW9uKSB7XG4gIHZhciB1cGRhdGVDb3VudCA9IHN0YXRlWzFdO1xuICByZXR1cm4gW2FjdGlvbi5wYXlsb2FkLCB1cGRhdGVDb3VudCArIDFdO1xufVxuXG52YXIgaW5pdFN0YXRlVXBkYXRlcyA9IGZ1bmN0aW9uIGluaXRTdGF0ZVVwZGF0ZXMoKSB7XG4gIHJldHVybiBbbnVsbCwgMF07XG59OyAvLyBSZWFjdCBjdXJyZW50bHkgdGhyb3dzIGEgd2FybmluZyB3aGVuIHVzaW5nIHVzZUxheW91dEVmZmVjdCBvbiB0aGUgc2VydmVyLlxuLy8gVG8gZ2V0IGFyb3VuZCBpdCwgd2UgY2FuIGNvbmRpdGlvbmFsbHkgdXNlRWZmZWN0IG9uIHRoZSBzZXJ2ZXIgKG5vLW9wKSBhbmRcbi8vIHVzZUxheW91dEVmZmVjdCBpbiB0aGUgYnJvd3Nlci4gV2UgbmVlZCB1c2VMYXlvdXRFZmZlY3QgYmVjYXVzZSB3ZSB3YW50XG4vLyBgY29ubmVjdGAgdG8gcGVyZm9ybSBzeW5jIHVwZGF0ZXMgdG8gYSByZWYgdG8gc2F2ZSB0aGUgbGF0ZXN0IHByb3BzIGFmdGVyXG4vLyBhIHJlbmRlciBpcyBhY3R1YWxseSBjb21taXR0ZWQgdG8gdGhlIERPTS5cblxuXG52YXIgdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgPyBfcmVhY3QudXNlTGF5b3V0RWZmZWN0IDogX3JlYWN0LnVzZUVmZmVjdDtcblxuZnVuY3Rpb24gY29ubmVjdEFkdmFuY2VkKFxuLypcbiAgc2VsZWN0b3JGYWN0b3J5IGlzIGEgZnVuYyB0aGF0IGlzIHJlc3BvbnNpYmxlIGZvciByZXR1cm5pbmcgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uIHVzZWQgdG9cbiAgY29tcHV0ZSBuZXcgcHJvcHMgZnJvbSBzdGF0ZSwgcHJvcHMsIGFuZCBkaXNwYXRjaC4gRm9yIGV4YW1wbGU6XG4gICAgIGV4cG9ydCBkZWZhdWx0IGNvbm5lY3RBZHZhbmNlZCgoZGlzcGF0Y2gsIG9wdGlvbnMpID0+IChzdGF0ZSwgcHJvcHMpID0+ICh7XG4gICAgICB0aGluZzogc3RhdGUudGhpbmdzW3Byb3BzLnRoaW5nSWRdLFxuICAgICAgc2F2ZVRoaW5nOiBmaWVsZHMgPT4gZGlzcGF0Y2goYWN0aW9uQ3JlYXRvcnMuc2F2ZVRoaW5nKHByb3BzLnRoaW5nSWQsIGZpZWxkcykpLFxuICAgIH0pKShZb3VyQ29tcG9uZW50KVxuICAgQWNjZXNzIHRvIGRpc3BhdGNoIGlzIHByb3ZpZGVkIHRvIHRoZSBmYWN0b3J5IHNvIHNlbGVjdG9yRmFjdG9yaWVzIGNhbiBiaW5kIGFjdGlvbkNyZWF0b3JzXG4gIG91dHNpZGUgb2YgdGhlaXIgc2VsZWN0b3IgYXMgYW4gb3B0aW1pemF0aW9uLiBPcHRpb25zIHBhc3NlZCB0byBjb25uZWN0QWR2YW5jZWQgYXJlIHBhc3NlZCB0b1xuICB0aGUgc2VsZWN0b3JGYWN0b3J5LCBhbG9uZyB3aXRoIGRpc3BsYXlOYW1lIGFuZCBXcmFwcGVkQ29tcG9uZW50LCBhcyB0aGUgc2Vjb25kIGFyZ3VtZW50LlxuICAgTm90ZSB0aGF0IHNlbGVjdG9yRmFjdG9yeSBpcyByZXNwb25zaWJsZSBmb3IgYWxsIGNhY2hpbmcvbWVtb2l6YXRpb24gb2YgaW5ib3VuZCBhbmQgb3V0Ym91bmRcbiAgcHJvcHMuIERvIG5vdCB1c2UgY29ubmVjdEFkdmFuY2VkIGRpcmVjdGx5IHdpdGhvdXQgbWVtb2l6aW5nIHJlc3VsdHMgYmV0d2VlbiBjYWxscyB0byB5b3VyXG4gIHNlbGVjdG9yLCBvdGhlcndpc2UgdGhlIENvbm5lY3QgY29tcG9uZW50IHdpbGwgcmUtcmVuZGVyIG9uIGV2ZXJ5IHN0YXRlIG9yIHByb3BzIGNoYW5nZS5cbiovXG5zZWxlY3RvckZhY3RvcnksIC8vIG9wdGlvbnMgb2JqZWN0OlxuX3JlZikge1xuICBpZiAoX3JlZiA9PT0gdm9pZCAwKSB7XG4gICAgX3JlZiA9IHt9O1xuICB9XG5cbiAgdmFyIF9yZWYyID0gX3JlZixcbiAgICAgIF9yZWYyJGdldERpc3BsYXlOYW1lID0gX3JlZjIuZ2V0RGlzcGxheU5hbWUsXG4gICAgICBnZXREaXNwbGF5TmFtZSA9IF9yZWYyJGdldERpc3BsYXlOYW1lID09PSB2b2lkIDAgPyBmdW5jdGlvbiAobmFtZSkge1xuICAgIHJldHVybiBcIkNvbm5lY3RBZHZhbmNlZChcIiArIG5hbWUgKyBcIilcIjtcbiAgfSA6IF9yZWYyJGdldERpc3BsYXlOYW1lLFxuICAgICAgX3JlZjIkbWV0aG9kTmFtZSA9IF9yZWYyLm1ldGhvZE5hbWUsXG4gICAgICBtZXRob2ROYW1lID0gX3JlZjIkbWV0aG9kTmFtZSA9PT0gdm9pZCAwID8gJ2Nvbm5lY3RBZHZhbmNlZCcgOiBfcmVmMiRtZXRob2ROYW1lLFxuICAgICAgX3JlZjIkcmVuZGVyQ291bnRQcm9wID0gX3JlZjIucmVuZGVyQ291bnRQcm9wLFxuICAgICAgcmVuZGVyQ291bnRQcm9wID0gX3JlZjIkcmVuZGVyQ291bnRQcm9wID09PSB2b2lkIDAgPyB1bmRlZmluZWQgOiBfcmVmMiRyZW5kZXJDb3VudFByb3AsXG4gICAgICBfcmVmMiRzaG91bGRIYW5kbGVTdGEgPSBfcmVmMi5zaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMsXG4gICAgICBzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMgPSBfcmVmMiRzaG91bGRIYW5kbGVTdGEgPT09IHZvaWQgMCA/IHRydWUgOiBfcmVmMiRzaG91bGRIYW5kbGVTdGEsXG4gICAgICBfcmVmMiRzdG9yZUtleSA9IF9yZWYyLnN0b3JlS2V5LFxuICAgICAgc3RvcmVLZXkgPSBfcmVmMiRzdG9yZUtleSA9PT0gdm9pZCAwID8gJ3N0b3JlJyA6IF9yZWYyJHN0b3JlS2V5LFxuICAgICAgX3JlZjIkd2l0aFJlZiA9IF9yZWYyLndpdGhSZWYsXG4gICAgICB3aXRoUmVmID0gX3JlZjIkd2l0aFJlZiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmMiR3aXRoUmVmLFxuICAgICAgX3JlZjIkZm9yd2FyZFJlZiA9IF9yZWYyLmZvcndhcmRSZWYsXG4gICAgICBmb3J3YXJkUmVmID0gX3JlZjIkZm9yd2FyZFJlZiA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmMiRmb3J3YXJkUmVmLFxuICAgICAgX3JlZjIkY29udGV4dCA9IF9yZWYyLmNvbnRleHQsXG4gICAgICBjb250ZXh0ID0gX3JlZjIkY29udGV4dCA9PT0gdm9pZCAwID8gX0NvbnRleHQuUmVhY3RSZWR1eENvbnRleHQgOiBfcmVmMiRjb250ZXh0LFxuICAgICAgY29ubmVjdE9wdGlvbnMgPSAoMCwgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyW1wiZGVmYXVsdFwiXSkoX3JlZjIsIFtcImdldERpc3BsYXlOYW1lXCIsIFwibWV0aG9kTmFtZVwiLCBcInJlbmRlckNvdW50UHJvcFwiLCBcInNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlc1wiLCBcInN0b3JlS2V5XCIsIFwid2l0aFJlZlwiLCBcImZvcndhcmRSZWZcIiwgXCJjb250ZXh0XCJdKTtcbiAgKDAsIF9pbnZhcmlhbnRbXCJkZWZhdWx0XCJdKShyZW5kZXJDb3VudFByb3AgPT09IHVuZGVmaW5lZCwgXCJyZW5kZXJDb3VudFByb3AgaXMgcmVtb3ZlZC4gcmVuZGVyIGNvdW50aW5nIGlzIGJ1aWx0IGludG8gdGhlIGxhdGVzdCBSZWFjdCBEZXYgVG9vbHMgcHJvZmlsaW5nIGV4dGVuc2lvblwiKTtcbiAgKDAsIF9pbnZhcmlhbnRbXCJkZWZhdWx0XCJdKSghd2l0aFJlZiwgJ3dpdGhSZWYgaXMgcmVtb3ZlZC4gVG8gYWNjZXNzIHRoZSB3cmFwcGVkIGluc3RhbmNlLCB1c2UgYSByZWYgb24gdGhlIGNvbm5lY3RlZCBjb21wb25lbnQnKTtcbiAgdmFyIGN1c3RvbVN0b3JlV2FybmluZ01lc3NhZ2UgPSAnVG8gdXNlIGEgY3VzdG9tIFJlZHV4IHN0b3JlIGZvciBzcGVjaWZpYyBjb21wb25lbnRzLCBjcmVhdGUgYSBjdXN0b20gUmVhY3QgY29udGV4dCB3aXRoICcgKyBcIlJlYWN0LmNyZWF0ZUNvbnRleHQoKSwgYW5kIHBhc3MgdGhlIGNvbnRleHQgb2JqZWN0IHRvIFJlYWN0IFJlZHV4J3MgUHJvdmlkZXIgYW5kIHNwZWNpZmljIGNvbXBvbmVudHNcIiArICcgbGlrZTogPFByb3ZpZGVyIGNvbnRleHQ9e015Q29udGV4dH0+PENvbm5lY3RlZENvbXBvbmVudCBjb250ZXh0PXtNeUNvbnRleHR9IC8+PC9Qcm92aWRlcj4uICcgKyAnWW91IG1heSBhbHNvIHBhc3MgYSB7Y29udGV4dCA6IE15Q29udGV4dH0gb3B0aW9uIHRvIGNvbm5lY3QnO1xuICAoMCwgX2ludmFyaWFudFtcImRlZmF1bHRcIl0pKHN0b3JlS2V5ID09PSAnc3RvcmUnLCAnc3RvcmVLZXkgaGFzIGJlZW4gcmVtb3ZlZCBhbmQgZG9lcyBub3QgZG8gYW55dGhpbmcuICcgKyBjdXN0b21TdG9yZVdhcm5pbmdNZXNzYWdlKTtcbiAgdmFyIENvbnRleHQgPSBjb250ZXh0O1xuICByZXR1cm4gZnVuY3Rpb24gd3JhcFdpdGhDb25uZWN0KFdyYXBwZWRDb21wb25lbnQpIHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgKDAsIF9pbnZhcmlhbnRbXCJkZWZhdWx0XCJdKSgoMCwgX3JlYWN0SXMuaXNWYWxpZEVsZW1lbnRUeXBlKShXcmFwcGVkQ29tcG9uZW50KSwgXCJZb3UgbXVzdCBwYXNzIGEgY29tcG9uZW50IHRvIHRoZSBmdW5jdGlvbiByZXR1cm5lZCBieSBcIiArIChtZXRob2ROYW1lICsgXCIuIEluc3RlYWQgcmVjZWl2ZWQgXCIgKyBzdHJpbmdpZnlDb21wb25lbnQoV3JhcHBlZENvbXBvbmVudCkpKTtcbiAgICB9XG5cbiAgICB2YXIgd3JhcHBlZENvbXBvbmVudE5hbWUgPSBXcmFwcGVkQ29tcG9uZW50LmRpc3BsYXlOYW1lIHx8IFdyYXBwZWRDb21wb25lbnQubmFtZSB8fCAnQ29tcG9uZW50JztcbiAgICB2YXIgZGlzcGxheU5hbWUgPSBnZXREaXNwbGF5TmFtZSh3cmFwcGVkQ29tcG9uZW50TmFtZSk7XG4gICAgdmFyIHNlbGVjdG9yRmFjdG9yeU9wdGlvbnMgPSAoMCwgX2V4dGVuZHMyW1wiZGVmYXVsdFwiXSkoe30sIGNvbm5lY3RPcHRpb25zLCB7XG4gICAgICBnZXREaXNwbGF5TmFtZTogZ2V0RGlzcGxheU5hbWUsXG4gICAgICBtZXRob2ROYW1lOiBtZXRob2ROYW1lLFxuICAgICAgcmVuZGVyQ291bnRQcm9wOiByZW5kZXJDb3VudFByb3AsXG4gICAgICBzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXM6IHNob3VsZEhhbmRsZVN0YXRlQ2hhbmdlcyxcbiAgICAgIHN0b3JlS2V5OiBzdG9yZUtleSxcbiAgICAgIGRpc3BsYXlOYW1lOiBkaXNwbGF5TmFtZSxcbiAgICAgIHdyYXBwZWRDb21wb25lbnROYW1lOiB3cmFwcGVkQ29tcG9uZW50TmFtZSxcbiAgICAgIFdyYXBwZWRDb21wb25lbnQ6IFdyYXBwZWRDb21wb25lbnRcbiAgICB9KTtcbiAgICB2YXIgcHVyZSA9IGNvbm5lY3RPcHRpb25zLnB1cmU7XG5cbiAgICBmdW5jdGlvbiBjcmVhdGVDaGlsZFNlbGVjdG9yKHN0b3JlKSB7XG4gICAgICByZXR1cm4gc2VsZWN0b3JGYWN0b3J5KHN0b3JlLmRpc3BhdGNoLCBzZWxlY3RvckZhY3RvcnlPcHRpb25zKTtcbiAgICB9IC8vIElmIHdlIGFyZW4ndCBydW5uaW5nIGluIFwicHVyZVwiIG1vZGUsIHdlIGRvbid0IHdhbnQgdG8gbWVtb2l6ZSB2YWx1ZXMuXG4gICAgLy8gVG8gYXZvaWQgY29uZGl0aW9uYWxseSBjYWxsaW5nIGhvb2tzLCB3ZSBmYWxsIGJhY2sgdG8gYSB0aW55IHdyYXBwZXJcbiAgICAvLyB0aGF0IGp1c3QgZXhlY3V0ZXMgdGhlIGdpdmVuIGNhbGxiYWNrIGltbWVkaWF0ZWx5LlxuXG5cbiAgICB2YXIgdXNlUHVyZU9ubHlNZW1vID0gcHVyZSA/IF9yZWFjdC51c2VNZW1vIDogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gQ29ubmVjdEZ1bmN0aW9uKHByb3BzKSB7XG4gICAgICB2YXIgX3VzZU1lbW8gPSAoMCwgX3JlYWN0LnVzZU1lbW8pKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gRGlzdGluZ3Vpc2ggYmV0d2VlbiBhY3R1YWwgXCJkYXRhXCIgcHJvcHMgdGhhdCB3ZXJlIHBhc3NlZCB0byB0aGUgd3JhcHBlciBjb21wb25lbnQsXG4gICAgICAgIC8vIGFuZCB2YWx1ZXMgbmVlZGVkIHRvIGNvbnRyb2wgYmVoYXZpb3IgKGZvcndhcmRlZCByZWZzLCBhbHRlcm5hdGUgY29udGV4dCBpbnN0YW5jZXMpLlxuICAgICAgICAvLyBUbyBtYWludGFpbiB0aGUgd3JhcHBlclByb3BzIG9iamVjdCByZWZlcmVuY2UsIG1lbW9pemUgdGhpcyBkZXN0cnVjdHVyaW5nLlxuICAgICAgICB2YXIgZm9yd2FyZGVkUmVmID0gcHJvcHMuZm9yd2FyZGVkUmVmLFxuICAgICAgICAgICAgd3JhcHBlclByb3BzID0gKDAsIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlMltcImRlZmF1bHRcIl0pKHByb3BzLCBbXCJmb3J3YXJkZWRSZWZcIl0pO1xuICAgICAgICByZXR1cm4gW3Byb3BzLmNvbnRleHQsIGZvcndhcmRlZFJlZiwgd3JhcHBlclByb3BzXTtcbiAgICAgIH0sIFtwcm9wc10pLFxuICAgICAgICAgIHByb3BzQ29udGV4dCA9IF91c2VNZW1vWzBdLFxuICAgICAgICAgIGZvcndhcmRlZFJlZiA9IF91c2VNZW1vWzFdLFxuICAgICAgICAgIHdyYXBwZXJQcm9wcyA9IF91c2VNZW1vWzJdO1xuXG4gICAgICB2YXIgQ29udGV4dFRvVXNlID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIFVzZXJzIG1heSBvcHRpb25hbGx5IHBhc3MgaW4gYSBjdXN0b20gY29udGV4dCBpbnN0YW5jZSB0byB1c2UgaW5zdGVhZCBvZiBvdXIgUmVhY3RSZWR1eENvbnRleHQuXG4gICAgICAgIC8vIE1lbW9pemUgdGhlIGNoZWNrIHRoYXQgZGV0ZXJtaW5lcyB3aGljaCBjb250ZXh0IGluc3RhbmNlIHdlIHNob3VsZCB1c2UuXG4gICAgICAgIHJldHVybiBwcm9wc0NvbnRleHQgJiYgcHJvcHNDb250ZXh0LkNvbnN1bWVyICYmICgwLCBfcmVhY3RJcy5pc0NvbnRleHRDb25zdW1lcikoX3JlYWN0W1wiZGVmYXVsdFwiXS5jcmVhdGVFbGVtZW50KHByb3BzQ29udGV4dC5Db25zdW1lciwgbnVsbCkpID8gcHJvcHNDb250ZXh0IDogQ29udGV4dDtcbiAgICAgIH0sIFtwcm9wc0NvbnRleHQsIENvbnRleHRdKTsgLy8gUmV0cmlldmUgdGhlIHN0b3JlIGFuZCBhbmNlc3RvciBzdWJzY3JpcHRpb24gdmlhIGNvbnRleHQsIGlmIGF2YWlsYWJsZVxuXG4gICAgICB2YXIgY29udGV4dFZhbHVlID0gKDAsIF9yZWFjdC51c2VDb250ZXh0KShDb250ZXh0VG9Vc2UpOyAvLyBUaGUgc3RvcmUgX211c3RfIGV4aXN0IGFzIGVpdGhlciBhIHByb3Agb3IgaW4gY29udGV4dFxuXG4gICAgICB2YXIgZGlkU3RvcmVDb21lRnJvbVByb3BzID0gQm9vbGVhbihwcm9wcy5zdG9yZSk7XG4gICAgICB2YXIgZGlkU3RvcmVDb21lRnJvbUNvbnRleHQgPSBCb29sZWFuKGNvbnRleHRWYWx1ZSkgJiYgQm9vbGVhbihjb250ZXh0VmFsdWUuc3RvcmUpO1xuICAgICAgKDAsIF9pbnZhcmlhbnRbXCJkZWZhdWx0XCJdKShkaWRTdG9yZUNvbWVGcm9tUHJvcHMgfHwgZGlkU3RvcmVDb21lRnJvbUNvbnRleHQsIFwiQ291bGQgbm90IGZpbmQgXFxcInN0b3JlXFxcIiBpbiB0aGUgY29udGV4dCBvZiBcIiArIChcIlxcXCJcIiArIGRpc3BsYXlOYW1lICsgXCJcXFwiLiBFaXRoZXIgd3JhcCB0aGUgcm9vdCBjb21wb25lbnQgaW4gYSA8UHJvdmlkZXI+LCBcIikgKyBcIm9yIHBhc3MgYSBjdXN0b20gUmVhY3QgY29udGV4dCBwcm92aWRlciB0byA8UHJvdmlkZXI+IGFuZCB0aGUgY29ycmVzcG9uZGluZyBcIiArIChcIlJlYWN0IGNvbnRleHQgY29uc3VtZXIgdG8gXCIgKyBkaXNwbGF5TmFtZSArIFwiIGluIGNvbm5lY3Qgb3B0aW9ucy5cIikpO1xuICAgICAgdmFyIHN0b3JlID0gcHJvcHMuc3RvcmUgfHwgY29udGV4dFZhbHVlLnN0b3JlO1xuICAgICAgdmFyIGNoaWxkUHJvcHNTZWxlY3RvciA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBUaGUgY2hpbGQgcHJvcHMgc2VsZWN0b3IgbmVlZHMgdGhlIHN0b3JlIHJlZmVyZW5jZSBhcyBhbiBpbnB1dC5cbiAgICAgICAgLy8gUmUtY3JlYXRlIHRoaXMgc2VsZWN0b3Igd2hlbmV2ZXIgdGhlIHN0b3JlIGNoYW5nZXMuXG4gICAgICAgIHJldHVybiBjcmVhdGVDaGlsZFNlbGVjdG9yKHN0b3JlKTtcbiAgICAgIH0sIFtzdG9yZV0pO1xuXG4gICAgICB2YXIgX3VzZU1lbW8yID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzKSByZXR1cm4gTk9fU1VCU0NSSVBUSU9OX0FSUkFZOyAvLyBUaGlzIFN1YnNjcmlwdGlvbidzIHNvdXJjZSBzaG91bGQgbWF0Y2ggd2hlcmUgc3RvcmUgY2FtZSBmcm9tOiBwcm9wcyB2cy4gY29udGV4dC4gQSBjb21wb25lbnRcbiAgICAgICAgLy8gY29ubmVjdGVkIHRvIHRoZSBzdG9yZSB2aWEgcHJvcHMgc2hvdWxkbid0IHVzZSBzdWJzY3JpcHRpb24gZnJvbSBjb250ZXh0LCBvciB2aWNlIHZlcnNhLlxuXG4gICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBuZXcgX1N1YnNjcmlwdGlvbltcImRlZmF1bHRcIl0oc3RvcmUsIGRpZFN0b3JlQ29tZUZyb21Qcm9wcyA/IG51bGwgOiBjb250ZXh0VmFsdWUuc3Vic2NyaXB0aW9uKTsgLy8gYG5vdGlmeU5lc3RlZFN1YnNgIGlzIGR1cGxpY2F0ZWQgdG8gaGFuZGxlIHRoZSBjYXNlIHdoZXJlIHRoZSBjb21wb25lbnQgaXMgdW5tb3VudGVkIGluXG4gICAgICAgIC8vIHRoZSBtaWRkbGUgb2YgdGhlIG5vdGlmaWNhdGlvbiBsb29wLCB3aGVyZSBgc3Vic2NyaXB0aW9uYCB3aWxsIHRoZW4gYmUgbnVsbC4gVGhpcyBjYW5cbiAgICAgICAgLy8gcHJvYmFibHkgYmUgYXZvaWRlZCBpZiBTdWJzY3JpcHRpb24ncyBsaXN0ZW5lcnMgbG9naWMgaXMgY2hhbmdlZCB0byBub3QgY2FsbCBsaXN0ZW5lcnNcbiAgICAgICAgLy8gdGhhdCBoYXZlIGJlZW4gdW5zdWJzY3JpYmVkIGluIHRoZSAgbWlkZGxlIG9mIHRoZSBub3RpZmljYXRpb24gbG9vcC5cblxuICAgICAgICB2YXIgbm90aWZ5TmVzdGVkU3VicyA9IHN1YnNjcmlwdGlvbi5ub3RpZnlOZXN0ZWRTdWJzLmJpbmQoc3Vic2NyaXB0aW9uKTtcbiAgICAgICAgcmV0dXJuIFtzdWJzY3JpcHRpb24sIG5vdGlmeU5lc3RlZFN1YnNdO1xuICAgICAgfSwgW3N0b3JlLCBkaWRTdG9yZUNvbWVGcm9tUHJvcHMsIGNvbnRleHRWYWx1ZV0pLFxuICAgICAgICAgIHN1YnNjcmlwdGlvbiA9IF91c2VNZW1vMlswXSxcbiAgICAgICAgICBub3RpZnlOZXN0ZWRTdWJzID0gX3VzZU1lbW8yWzFdOyAvLyBEZXRlcm1pbmUgd2hhdCB7c3RvcmUsIHN1YnNjcmlwdGlvbn0gdmFsdWUgc2hvdWxkIGJlIHB1dCBpbnRvIG5lc3RlZCBjb250ZXh0LCBpZiBuZWNlc3NhcnksXG4gICAgICAvLyBhbmQgbWVtb2l6ZSB0aGF0IHZhbHVlIHRvIGF2b2lkIHVubmVjZXNzYXJ5IGNvbnRleHQgdXBkYXRlcy5cblxuXG4gICAgICB2YXIgb3ZlcnJpZGRlbkNvbnRleHRWYWx1ZSA9ICgwLCBfcmVhY3QudXNlTWVtbykoZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoZGlkU3RvcmVDb21lRnJvbVByb3BzKSB7XG4gICAgICAgICAgLy8gVGhpcyBjb21wb25lbnQgaXMgZGlyZWN0bHkgc3Vic2NyaWJlZCB0byBhIHN0b3JlIGZyb20gcHJvcHMuXG4gICAgICAgICAgLy8gV2UgZG9uJ3Qgd2FudCBkZXNjZW5kYW50cyByZWFkaW5nIGZyb20gdGhpcyBzdG9yZSAtIHBhc3MgZG93biB3aGF0ZXZlclxuICAgICAgICAgIC8vIHRoZSBleGlzdGluZyBjb250ZXh0IHZhbHVlIGlzIGZyb20gdGhlIG5lYXJlc3QgY29ubmVjdGVkIGFuY2VzdG9yLlxuICAgICAgICAgIHJldHVybiBjb250ZXh0VmFsdWU7XG4gICAgICAgIH0gLy8gT3RoZXJ3aXNlLCBwdXQgdGhpcyBjb21wb25lbnQncyBzdWJzY3JpcHRpb24gaW5zdGFuY2UgaW50byBjb250ZXh0LCBzbyB0aGF0XG4gICAgICAgIC8vIGNvbm5lY3RlZCBkZXNjZW5kYW50cyB3b24ndCB1cGRhdGUgdW50aWwgYWZ0ZXIgdGhpcyBjb21wb25lbnQgaXMgZG9uZVxuXG5cbiAgICAgICAgcmV0dXJuICgwLCBfZXh0ZW5kczJbXCJkZWZhdWx0XCJdKSh7fSwgY29udGV4dFZhbHVlLCB7XG4gICAgICAgICAgc3Vic2NyaXB0aW9uOiBzdWJzY3JpcHRpb25cbiAgICAgICAgfSk7XG4gICAgICB9LCBbZGlkU3RvcmVDb21lRnJvbVByb3BzLCBjb250ZXh0VmFsdWUsIHN1YnNjcmlwdGlvbl0pOyAvLyBXZSBuZWVkIHRvIGZvcmNlIHRoaXMgd3JhcHBlciBjb21wb25lbnQgdG8gcmUtcmVuZGVyIHdoZW5ldmVyIGEgUmVkdXggc3RvcmUgdXBkYXRlXG4gICAgICAvLyBjYXVzZXMgYSBjaGFuZ2UgdG8gdGhlIGNhbGN1bGF0ZWQgY2hpbGQgY29tcG9uZW50IHByb3BzIChvciB3ZSBjYXVnaHQgYW4gZXJyb3IgaW4gbWFwU3RhdGUpXG5cbiAgICAgIHZhciBfdXNlUmVkdWNlciA9ICgwLCBfcmVhY3QudXNlUmVkdWNlcikoc3RvcmVTdGF0ZVVwZGF0ZXNSZWR1Y2VyLCBFTVBUWV9BUlJBWSwgaW5pdFN0YXRlVXBkYXRlcyksXG4gICAgICAgICAgX3VzZVJlZHVjZXIkID0gX3VzZVJlZHVjZXJbMF0sXG4gICAgICAgICAgcHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdCA9IF91c2VSZWR1Y2VyJFswXSxcbiAgICAgICAgICBmb3JjZUNvbXBvbmVudFVwZGF0ZURpc3BhdGNoID0gX3VzZVJlZHVjZXJbMV07IC8vIFByb3BhZ2F0ZSBhbnkgbWFwU3RhdGUvbWFwRGlzcGF0Y2ggZXJyb3JzIHVwd2FyZHNcblxuXG4gICAgICBpZiAocHJldmlvdXNTdGF0ZVVwZGF0ZVJlc3VsdCAmJiBwcmV2aW91c1N0YXRlVXBkYXRlUmVzdWx0LmVycm9yKSB7XG4gICAgICAgIHRocm93IHByZXZpb3VzU3RhdGVVcGRhdGVSZXN1bHQuZXJyb3I7XG4gICAgICB9IC8vIFNldCB1cCByZWZzIHRvIGNvb3JkaW5hdGUgdmFsdWVzIGJldHdlZW4gdGhlIHN1YnNjcmlwdGlvbiBlZmZlY3QgYW5kIHRoZSByZW5kZXIgbG9naWNcblxuXG4gICAgICB2YXIgbGFzdENoaWxkUHJvcHMgPSAoMCwgX3JlYWN0LnVzZVJlZikoKTtcbiAgICAgIHZhciBsYXN0V3JhcHBlclByb3BzID0gKDAsIF9yZWFjdC51c2VSZWYpKHdyYXBwZXJQcm9wcyk7XG4gICAgICB2YXIgY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZSA9ICgwLCBfcmVhY3QudXNlUmVmKSgpO1xuICAgICAgdmFyIHJlbmRlcklzU2NoZWR1bGVkID0gKDAsIF9yZWFjdC51c2VSZWYpKGZhbHNlKTtcbiAgICAgIHZhciBhY3R1YWxDaGlsZFByb3BzID0gdXNlUHVyZU9ubHlNZW1vKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gVHJpY2t5IGxvZ2ljIGhlcmU6XG4gICAgICAgIC8vIC0gVGhpcyByZW5kZXIgbWF5IGhhdmUgYmVlbiB0cmlnZ2VyZWQgYnkgYSBSZWR1eCBzdG9yZSB1cGRhdGUgdGhhdCBwcm9kdWNlZCBuZXcgY2hpbGQgcHJvcHNcbiAgICAgICAgLy8gLSBIb3dldmVyLCB3ZSBtYXkgaGF2ZSBnb3R0ZW4gbmV3IHdyYXBwZXIgcHJvcHMgYWZ0ZXIgdGhhdFxuICAgICAgICAvLyBJZiB3ZSBoYXZlIG5ldyBjaGlsZCBwcm9wcywgYW5kIHRoZSBzYW1lIHdyYXBwZXIgcHJvcHMsIHdlIGtub3cgd2Ugc2hvdWxkIHVzZSB0aGUgbmV3IGNoaWxkIHByb3BzIGFzLWlzLlxuICAgICAgICAvLyBCdXQsIGlmIHdlIGhhdmUgbmV3IHdyYXBwZXIgcHJvcHMsIHRob3NlIG1pZ2h0IGNoYW5nZSB0aGUgY2hpbGQgcHJvcHMsIHNvIHdlIGhhdmUgdG8gcmVjYWxjdWxhdGUgdGhpbmdzLlxuICAgICAgICAvLyBTbywgd2UnbGwgdXNlIHRoZSBjaGlsZCBwcm9wcyBmcm9tIHN0b3JlIHVwZGF0ZSBvbmx5IGlmIHRoZSB3cmFwcGVyIHByb3BzIGFyZSB0aGUgc2FtZSBhcyBsYXN0IHRpbWUuXG4gICAgICAgIGlmIChjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLmN1cnJlbnQgJiYgd3JhcHBlclByb3BzID09PSBsYXN0V3JhcHBlclByb3BzLmN1cnJlbnQpIHtcbiAgICAgICAgICByZXR1cm4gY2hpbGRQcm9wc0Zyb21TdG9yZVVwZGF0ZS5jdXJyZW50O1xuICAgICAgICB9IC8vIFRPRE8gV2UncmUgcmVhZGluZyB0aGUgc3RvcmUgZGlyZWN0bHkgaW4gcmVuZGVyKCkgaGVyZS4gQmFkIGlkZWE/XG4gICAgICAgIC8vIFRoaXMgd2lsbCBsaWtlbHkgY2F1c2UgQmFkIFRoaW5ncyAoVE0pIHRvIGhhcHBlbiBpbiBDb25jdXJyZW50IE1vZGUuXG4gICAgICAgIC8vIE5vdGUgdGhhdCB3ZSBkbyB0aGlzIGJlY2F1c2Ugb24gcmVuZGVycyBfbm90XyBjYXVzZWQgYnkgc3RvcmUgdXBkYXRlcywgd2UgbmVlZCB0aGUgbGF0ZXN0IHN0b3JlIHN0YXRlXG4gICAgICAgIC8vIHRvIGRldGVybWluZSB3aGF0IHRoZSBjaGlsZCBwcm9wcyBzaG91bGQgYmUuXG5cblxuICAgICAgICByZXR1cm4gY2hpbGRQcm9wc1NlbGVjdG9yKHN0b3JlLmdldFN0YXRlKCksIHdyYXBwZXJQcm9wcyk7XG4gICAgICB9LCBbc3RvcmUsIHByZXZpb3VzU3RhdGVVcGRhdGVSZXN1bHQsIHdyYXBwZXJQcm9wc10pOyAvLyBXZSBuZWVkIHRoaXMgdG8gZXhlY3V0ZSBzeW5jaHJvbm91c2x5IGV2ZXJ5IHRpbWUgd2UgcmUtcmVuZGVyLiBIb3dldmVyLCBSZWFjdCB3YXJuc1xuICAgICAgLy8gYWJvdXQgdXNlTGF5b3V0RWZmZWN0IGluIFNTUiwgc28gd2UgdHJ5IHRvIGRldGVjdCBlbnZpcm9ubWVudCBhbmQgZmFsbCBiYWNrIHRvXG4gICAgICAvLyBqdXN0IHVzZUVmZmVjdCBpbnN0ZWFkIHRvIGF2b2lkIHRoZSB3YXJuaW5nLCBzaW5jZSBuZWl0aGVyIHdpbGwgcnVuIGFueXdheS5cblxuICAgICAgdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIFdlIHdhbnQgdG8gY2FwdHVyZSB0aGUgd3JhcHBlciBwcm9wcyBhbmQgY2hpbGQgcHJvcHMgd2UgdXNlZCBmb3IgbGF0ZXIgY29tcGFyaXNvbnNcbiAgICAgICAgbGFzdFdyYXBwZXJQcm9wcy5jdXJyZW50ID0gd3JhcHBlclByb3BzO1xuICAgICAgICBsYXN0Q2hpbGRQcm9wcy5jdXJyZW50ID0gYWN0dWFsQ2hpbGRQcm9wcztcbiAgICAgICAgcmVuZGVySXNTY2hlZHVsZWQuY3VycmVudCA9IGZhbHNlOyAvLyBJZiB0aGUgcmVuZGVyIHdhcyBmcm9tIGEgc3RvcmUgdXBkYXRlLCBjbGVhciBvdXQgdGhhdCByZWZlcmVuY2UgYW5kIGNhc2NhZGUgdGhlIHN1YnNjcmliZXIgdXBkYXRlXG5cbiAgICAgICAgaWYgKGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudCkge1xuICAgICAgICAgIGNoaWxkUHJvcHNGcm9tU3RvcmVVcGRhdGUuY3VycmVudCA9IG51bGw7XG4gICAgICAgICAgbm90aWZ5TmVzdGVkU3VicygpO1xuICAgICAgICB9XG4gICAgICB9KTsgLy8gT3VyIHJlLXN1YnNjcmliZSBsb2dpYyBvbmx5IHJ1bnMgd2hlbiB0aGUgc3RvcmUvc3Vic2NyaXB0aW9uIHNldHVwIGNoYW5nZXNcblxuICAgICAgdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdChmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIElmIHdlJ3JlIG5vdCBzdWJzY3JpYmVkIHRvIHRoZSBzdG9yZSwgbm90aGluZyB0byBkbyBoZXJlXG4gICAgICAgIGlmICghc2hvdWxkSGFuZGxlU3RhdGVDaGFuZ2VzKSByZXR1cm47IC8vIENhcHR1cmUgdmFsdWVzIGZvciBjaGVja2luZyBpZiBhbmQgd2hlbiB0aGlzIGNvbXBvbmVudCB1bm1vdW50c1xuXG4gICAgICAgIHZhciBkaWRVbnN1YnNjcmliZSA9IGZhbHNlO1xuICAgICAgICB2YXIgbGFzdFRocm93bkVycm9yID0gbnVsbDsgLy8gV2UnbGwgcnVuIHRoaXMgY2FsbGJhY2sgZXZlcnkgdGltZSBhIHN0b3JlIHN1YnNjcmlwdGlvbiB1cGRhdGUgcHJvcGFnYXRlcyB0byB0aGlzIGNvbXBvbmVudFxuXG4gICAgICAgIHZhciBjaGVja0ZvclVwZGF0ZXMgPSBmdW5jdGlvbiBjaGVja0ZvclVwZGF0ZXMoKSB7XG4gICAgICAgICAgaWYgKGRpZFVuc3Vic2NyaWJlKSB7XG4gICAgICAgICAgICAvLyBEb24ndCBydW4gc3RhbGUgbGlzdGVuZXJzLlxuICAgICAgICAgICAgLy8gUmVkdXggZG9lc24ndCBndWFyYW50ZWUgdW5zdWJzY3JpcHRpb25zIGhhcHBlbiB1bnRpbCBuZXh0IGRpc3BhdGNoLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHZhciBsYXRlc3RTdG9yZVN0YXRlID0gc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICAgICAgICB2YXIgbmV3Q2hpbGRQcm9wcywgZXJyb3I7XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gQWN0dWFsbHkgcnVuIHRoZSBzZWxlY3RvciB3aXRoIHRoZSBtb3N0IHJlY2VudCBzdG9yZSBzdGF0ZSBhbmQgd3JhcHBlciBwcm9wc1xuICAgICAgICAgICAgLy8gdG8gZGV0ZXJtaW5lIHdoYXQgdGhlIGNoaWxkIHByb3BzIHNob3VsZCBiZVxuICAgICAgICAgICAgbmV3Q2hpbGRQcm9wcyA9IGNoaWxkUHJvcHNTZWxlY3RvcihsYXRlc3RTdG9yZVN0YXRlLCBsYXN0V3JhcHBlclByb3BzLmN1cnJlbnQpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGVycm9yID0gZTtcbiAgICAgICAgICAgIGxhc3RUaHJvd25FcnJvciA9IGU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICAgICAgbGFzdFRocm93bkVycm9yID0gbnVsbDtcbiAgICAgICAgICB9IC8vIElmIHRoZSBjaGlsZCBwcm9wcyBoYXZlbid0IGNoYW5nZWQsIG5vdGhpbmcgdG8gZG8gaGVyZSAtIGNhc2NhZGUgdGhlIHN1YnNjcmlwdGlvbiB1cGRhdGVcblxuXG4gICAgICAgICAgaWYgKG5ld0NoaWxkUHJvcHMgPT09IGxhc3RDaGlsZFByb3BzLmN1cnJlbnQpIHtcbiAgICAgICAgICAgIGlmICghcmVuZGVySXNTY2hlZHVsZWQuY3VycmVudCkge1xuICAgICAgICAgICAgICBub3RpZnlOZXN0ZWRTdWJzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFNhdmUgcmVmZXJlbmNlcyB0byB0aGUgbmV3IGNoaWxkIHByb3BzLiAgTm90ZSB0aGF0IHdlIHRyYWNrIHRoZSBcImNoaWxkIHByb3BzIGZyb20gc3RvcmUgdXBkYXRlXCJcbiAgICAgICAgICAgIC8vIGFzIGEgcmVmIGluc3RlYWQgb2YgYSB1c2VTdGF0ZS91c2VSZWR1Y2VyIGJlY2F1c2Ugd2UgbmVlZCBhIHdheSB0byBkZXRlcm1pbmUgaWYgdGhhdCB2YWx1ZSBoYXNcbiAgICAgICAgICAgIC8vIGJlZW4gcHJvY2Vzc2VkLiAgSWYgdGhpcyB3ZW50IGludG8gdXNlU3RhdGUvdXNlUmVkdWNlciwgd2UgY291bGRuJ3QgY2xlYXIgb3V0IHRoZSB2YWx1ZSB3aXRob3V0XG4gICAgICAgICAgICAvLyBmb3JjaW5nIGFub3RoZXIgcmUtcmVuZGVyLCB3aGljaCB3ZSBkb24ndCB3YW50LlxuICAgICAgICAgICAgbGFzdENoaWxkUHJvcHMuY3VycmVudCA9IG5ld0NoaWxkUHJvcHM7XG4gICAgICAgICAgICBjaGlsZFByb3BzRnJvbVN0b3JlVXBkYXRlLmN1cnJlbnQgPSBuZXdDaGlsZFByb3BzO1xuICAgICAgICAgICAgcmVuZGVySXNTY2hlZHVsZWQuY3VycmVudCA9IHRydWU7IC8vIElmIHRoZSBjaGlsZCBwcm9wcyBfZGlkXyBjaGFuZ2UgKG9yIHdlIGNhdWdodCBhbiBlcnJvciksIHRoaXMgd3JhcHBlciBjb21wb25lbnQgbmVlZHMgdG8gcmUtcmVuZGVyXG5cbiAgICAgICAgICAgIGZvcmNlQ29tcG9uZW50VXBkYXRlRGlzcGF0Y2goe1xuICAgICAgICAgICAgICB0eXBlOiAnU1RPUkVfVVBEQVRFRCcsXG4gICAgICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgICAgICBsYXRlc3RTdG9yZVN0YXRlOiBsYXRlc3RTdG9yZVN0YXRlLFxuICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvclxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH07IC8vIEFjdHVhbGx5IHN1YnNjcmliZSB0byB0aGUgbmVhcmVzdCBjb25uZWN0ZWQgYW5jZXN0b3IgKG9yIHN0b3JlKVxuXG5cbiAgICAgICAgc3Vic2NyaXB0aW9uLm9uU3RhdGVDaGFuZ2UgPSBjaGVja0ZvclVwZGF0ZXM7XG4gICAgICAgIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTsgLy8gUHVsbCBkYXRhIGZyb20gdGhlIHN0b3JlIGFmdGVyIGZpcnN0IHJlbmRlciBpbiBjYXNlIHRoZSBzdG9yZSBoYXNcbiAgICAgICAgLy8gY2hhbmdlZCBzaW5jZSB3ZSBiZWdhbi5cblxuICAgICAgICBjaGVja0ZvclVwZGF0ZXMoKTtcblxuICAgICAgICB2YXIgdW5zdWJzY3JpYmVXcmFwcGVyID0gZnVuY3Rpb24gdW5zdWJzY3JpYmVXcmFwcGVyKCkge1xuICAgICAgICAgIGRpZFVuc3Vic2NyaWJlID0gdHJ1ZTtcbiAgICAgICAgICBzdWJzY3JpcHRpb24udHJ5VW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICBzdWJzY3JpcHRpb24ub25TdGF0ZUNoYW5nZSA9IG51bGw7XG5cbiAgICAgICAgICBpZiAobGFzdFRocm93bkVycm9yKSB7XG4gICAgICAgICAgICAvLyBJdCdzIHBvc3NpYmxlIHRoYXQgd2UgY2F1Z2h0IGFuIGVycm9yIGR1ZSB0byBhIGJhZCBtYXBTdGF0ZSBmdW5jdGlvbiwgYnV0IHRoZVxuICAgICAgICAgICAgLy8gcGFyZW50IHJlLXJlbmRlcmVkIHdpdGhvdXQgdGhpcyBjb21wb25lbnQgYW5kIHdlJ3JlIGFib3V0IHRvIHVubW91bnQuXG4gICAgICAgICAgICAvLyBUaGlzIHNob3VsZG4ndCBoYXBwZW4gYXMgbG9uZyBhcyB3ZSBkbyB0b3AtZG93biBzdWJzY3JpcHRpb25zIGNvcnJlY3RseSwgYnV0XG4gICAgICAgICAgICAvLyBpZiB3ZSBldmVyIGRvIHRob3NlIHdyb25nLCB0aGlzIHRocm93IHdpbGwgc3VyZmFjZSB0aGUgZXJyb3IgaW4gb3VyIHRlc3RzLlxuICAgICAgICAgICAgLy8gSW4gdGhhdCBjYXNlLCB0aHJvdyB0aGUgZXJyb3IgZnJvbSBoZXJlIHNvIGl0IGRvZXNuJ3QgZ2V0IGxvc3QuXG4gICAgICAgICAgICB0aHJvdyBsYXN0VGhyb3duRXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiB1bnN1YnNjcmliZVdyYXBwZXI7XG4gICAgICB9LCBbc3RvcmUsIHN1YnNjcmlwdGlvbiwgY2hpbGRQcm9wc1NlbGVjdG9yXSk7IC8vIE5vdyB0aGF0IGFsbCB0aGF0J3MgZG9uZSwgd2UgY2FuIGZpbmFsbHkgdHJ5IHRvIGFjdHVhbGx5IHJlbmRlciB0aGUgY2hpbGQgY29tcG9uZW50LlxuICAgICAgLy8gV2UgbWVtb2l6ZSB0aGUgZWxlbWVudHMgZm9yIHRoZSByZW5kZXJlZCBjaGlsZCBjb21wb25lbnQgYXMgYW4gb3B0aW1pemF0aW9uLlxuXG4gICAgICB2YXIgcmVuZGVyZWRXcmFwcGVkQ29tcG9uZW50ID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfcmVhY3RbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoV3JhcHBlZENvbXBvbmVudCwgKDAsIF9leHRlbmRzMltcImRlZmF1bHRcIl0pKHt9LCBhY3R1YWxDaGlsZFByb3BzLCB7XG4gICAgICAgICAgcmVmOiBmb3J3YXJkZWRSZWZcbiAgICAgICAgfSkpO1xuICAgICAgfSwgW2ZvcndhcmRlZFJlZiwgV3JhcHBlZENvbXBvbmVudCwgYWN0dWFsQ2hpbGRQcm9wc10pOyAvLyBJZiBSZWFjdCBzZWVzIHRoZSBleGFjdCBzYW1lIGVsZW1lbnQgcmVmZXJlbmNlIGFzIGxhc3QgdGltZSwgaXQgYmFpbHMgb3V0IG9mIHJlLXJlbmRlcmluZ1xuICAgICAgLy8gdGhhdCBjaGlsZCwgc2FtZSBhcyBpZiBpdCB3YXMgd3JhcHBlZCBpbiBSZWFjdC5tZW1vKCkgb3IgcmV0dXJuZWQgZmFsc2UgZnJvbSBzaG91bGRDb21wb25lbnRVcGRhdGUuXG5cbiAgICAgIHZhciByZW5kZXJlZENoaWxkID0gKDAsIF9yZWFjdC51c2VNZW1vKShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChzaG91bGRIYW5kbGVTdGF0ZUNoYW5nZXMpIHtcbiAgICAgICAgICAvLyBJZiB0aGlzIGNvbXBvbmVudCBpcyBzdWJzY3JpYmVkIHRvIHN0b3JlIHVwZGF0ZXMsIHdlIG5lZWQgdG8gcGFzcyBpdHMgb3duXG4gICAgICAgICAgLy8gc3Vic2NyaXB0aW9uIGluc3RhbmNlIGRvd24gdG8gb3VyIGRlc2NlbmRhbnRzLiBUaGF0IG1lYW5zIHJlbmRlcmluZyB0aGUgc2FtZVxuICAgICAgICAgIC8vIENvbnRleHQgaW5zdGFuY2UsIGFuZCBwdXR0aW5nIGEgZGlmZmVyZW50IHZhbHVlIGludG8gdGhlIGNvbnRleHQuXG4gICAgICAgICAgcmV0dXJuIF9yZWFjdFtcImRlZmF1bHRcIl0uY3JlYXRlRWxlbWVudChDb250ZXh0VG9Vc2UuUHJvdmlkZXIsIHtcbiAgICAgICAgICAgIHZhbHVlOiBvdmVycmlkZGVuQ29udGV4dFZhbHVlXG4gICAgICAgICAgfSwgcmVuZGVyZWRXcmFwcGVkQ29tcG9uZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQ7XG4gICAgICB9LCBbQ29udGV4dFRvVXNlLCByZW5kZXJlZFdyYXBwZWRDb21wb25lbnQsIG92ZXJyaWRkZW5Db250ZXh0VmFsdWVdKTtcbiAgICAgIHJldHVybiByZW5kZXJlZENoaWxkO1xuICAgIH0gLy8gSWYgd2UncmUgaW4gXCJwdXJlXCIgbW9kZSwgZW5zdXJlIG91ciB3cmFwcGVyIGNvbXBvbmVudCBvbmx5IHJlLXJlbmRlcnMgd2hlbiBpbmNvbWluZyBwcm9wcyBoYXZlIGNoYW5nZWQuXG5cblxuICAgIHZhciBDb25uZWN0ID0gcHVyZSA/IF9yZWFjdFtcImRlZmF1bHRcIl0ubWVtbyhDb25uZWN0RnVuY3Rpb24pIDogQ29ubmVjdEZ1bmN0aW9uO1xuICAgIENvbm5lY3QuV3JhcHBlZENvbXBvbmVudCA9IFdyYXBwZWRDb21wb25lbnQ7XG4gICAgQ29ubmVjdC5kaXNwbGF5TmFtZSA9IGRpc3BsYXlOYW1lO1xuXG4gICAgaWYgKGZvcndhcmRSZWYpIHtcbiAgICAgIHZhciBmb3J3YXJkZWQgPSBfcmVhY3RbXCJkZWZhdWx0XCJdLmZvcndhcmRSZWYoZnVuY3Rpb24gZm9yd2FyZENvbm5lY3RSZWYocHJvcHMsIHJlZikge1xuICAgICAgICByZXR1cm4gX3JlYWN0W1wiZGVmYXVsdFwiXS5jcmVhdGVFbGVtZW50KENvbm5lY3QsICgwLCBfZXh0ZW5kczJbXCJkZWZhdWx0XCJdKSh7fSwgcHJvcHMsIHtcbiAgICAgICAgICBmb3J3YXJkZWRSZWY6IHJlZlxuICAgICAgICB9KSk7XG4gICAgICB9KTtcblxuICAgICAgZm9yd2FyZGVkLmRpc3BsYXlOYW1lID0gZGlzcGxheU5hbWU7XG4gICAgICBmb3J3YXJkZWQuV3JhcHBlZENvbXBvbmVudCA9IFdyYXBwZWRDb21wb25lbnQ7XG4gICAgICByZXR1cm4gKDAsIF9ob2lzdE5vblJlYWN0U3RhdGljc1tcImRlZmF1bHRcIl0pKGZvcndhcmRlZCwgV3JhcHBlZENvbXBvbmVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuICgwLCBfaG9pc3ROb25SZWFjdFN0YXRpY3NbXCJkZWZhdWx0XCJdKShDb25uZWN0LCBXcmFwcGVkQ29tcG9uZW50KTtcbiAgfTtcbn0iXX0=