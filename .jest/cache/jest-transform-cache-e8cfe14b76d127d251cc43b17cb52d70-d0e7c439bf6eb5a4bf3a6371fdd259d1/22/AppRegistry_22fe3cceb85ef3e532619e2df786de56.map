{"version":3,"sources":["AppRegistry.js"],"names":["BatchedBridge","require","BugReporting","NativeModules","ReactNative","SceneTracker","infoLog","invariant","renderApplication","createPerformanceLogger","runnables","runCount","sections","taskProviders","Map","taskCancelProviders","componentProviderInstrumentationHook","component","wrapperComponentProvider","showFabricIndicator","AppRegistry","setWrapperComponentProvider","provider","enableFabricIndicator","enabled","registerConfig","config","forEach","appConfig","run","registerRunnable","appKey","registerComponent","section","componentProvider","scopedPerformanceLogger","appParameters","initialProps","rootTag","fabric","registerSection","getAppKeys","Object","keys","getSectionKeys","getSections","getRunnable","getRegistry","setComponentProviderInstrumentationHook","hook","runApplication","msg","JSON","stringify","String","__DEV__","addSource","setActiveScene","name","unmountApplicationComponentAtRootTag","unmountComponentAtNodeAndRemoveContainer","registerHeadlessTask","taskKey","taskProvider","registerCancellableHeadlessTask","taskCancelProvider","has","console","warn","set","startHeadlessTask","taskId","data","get","HeadlessJsTaskSupport","notifyTaskFinished","then","catch","reason","error","cancelHeadlessTask","Error","registerCallableModule","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @flow\n * @format\n */\n'use strict';\n\nconst BatchedBridge = require('../BatchedBridge/BatchedBridge');\nconst BugReporting = require('../BugReporting/BugReporting');\nconst NativeModules = require('../BatchedBridge/NativeModules');\nconst ReactNative = require('../Renderer/shims/ReactNative');\nconst SceneTracker = require('../Utilities/SceneTracker');\n\nconst infoLog = require('../Utilities/infoLog');\nconst invariant = require('invariant');\nconst renderApplication = require('./renderApplication');\nconst createPerformanceLogger = require('../Utilities/createPerformanceLogger');\nimport type {IPerformanceLogger} from '../Utilities/createPerformanceLogger';\n\ntype Task = (taskData: any) => Promise<void>;\ntype TaskProvider = () => Task;\ntype TaskCanceller = () => void;\ntype TaskCancelProvider = () => TaskCanceller;\n\nexport type ComponentProvider = () => React$ComponentType<any>;\nexport type ComponentProviderInstrumentationHook = (\n  component: ComponentProvider,\n  scopedPerformanceLogger: IPerformanceLogger,\n) => React$ComponentType<any>;\nexport type AppConfig = {\n  appKey: string,\n  component?: ComponentProvider,\n  run?: Function,\n  section?: boolean,\n};\nexport type Runnable = {\n  component?: ComponentProvider,\n  run: Function,\n};\nexport type Runnables = {\n  [appKey: string]: Runnable,\n};\nexport type Registry = {\n  sections: Array<string>,\n  runnables: Runnables,\n};\nexport type WrapperComponentProvider = any => React$ComponentType<*>;\n\nconst runnables: Runnables = {};\nlet runCount = 1;\nconst sections: Runnables = {};\nconst taskProviders: Map<string, TaskProvider> = new Map();\nconst taskCancelProviders: Map<string, TaskCancelProvider> = new Map();\nlet componentProviderInstrumentationHook: ComponentProviderInstrumentationHook = (\n  component: ComponentProvider,\n) => component();\n\nlet wrapperComponentProvider: ?WrapperComponentProvider;\nlet showFabricIndicator = false;\n\n/**\n * `AppRegistry` is the JavaScript entry point to running all React Native apps.\n *\n * See http://facebook.github.io/react-native/docs/appregistry.html\n */\nconst AppRegistry = {\n  setWrapperComponentProvider(provider: WrapperComponentProvider) {\n    wrapperComponentProvider = provider;\n  },\n\n  enableFabricIndicator(enabled: boolean): void {\n    showFabricIndicator = enabled;\n  },\n\n  registerConfig(config: Array<AppConfig>): void {\n    config.forEach(appConfig => {\n      if (appConfig.run) {\n        AppRegistry.registerRunnable(appConfig.appKey, appConfig.run);\n      } else {\n        invariant(\n          appConfig.component != null,\n          'AppRegistry.registerConfig(...): Every config is expected to set ' +\n            'either `run` or `component`, but `%s` has neither.',\n          appConfig.appKey,\n        );\n        AppRegistry.registerComponent(\n          appConfig.appKey,\n          appConfig.component,\n          appConfig.section,\n        );\n      }\n    });\n  },\n\n  /**\n   * Registers an app's root component.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#registercomponent\n   */\n  registerComponent(\n    appKey: string,\n    componentProvider: ComponentProvider,\n    section?: boolean,\n  ): string {\n    let scopedPerformanceLogger = createPerformanceLogger();\n    runnables[appKey] = {\n      componentProvider,\n      run: appParameters => {\n        renderApplication(\n          componentProviderInstrumentationHook(\n            componentProvider,\n            scopedPerformanceLogger,\n          ),\n          appParameters.initialProps,\n          appParameters.rootTag,\n          wrapperComponentProvider && wrapperComponentProvider(appParameters),\n          appParameters.fabric,\n          showFabricIndicator,\n          scopedPerformanceLogger,\n        );\n      },\n    };\n    if (section) {\n      sections[appKey] = runnables[appKey];\n    }\n    return appKey;\n  },\n\n  registerRunnable(appKey: string, run: Function): string {\n    runnables[appKey] = {run};\n    return appKey;\n  },\n\n  registerSection(appKey: string, component: ComponentProvider): void {\n    AppRegistry.registerComponent(appKey, component, true);\n  },\n\n  getAppKeys(): Array<string> {\n    return Object.keys(runnables);\n  },\n\n  getSectionKeys(): Array<string> {\n    return Object.keys(sections);\n  },\n\n  getSections(): Runnables {\n    return {\n      ...sections,\n    };\n  },\n\n  getRunnable(appKey: string): ?Runnable {\n    return runnables[appKey];\n  },\n\n  getRegistry(): Registry {\n    return {\n      sections: AppRegistry.getSectionKeys(),\n      runnables: {...runnables},\n    };\n  },\n\n  setComponentProviderInstrumentationHook(\n    hook: ComponentProviderInstrumentationHook,\n  ) {\n    componentProviderInstrumentationHook = hook;\n  },\n\n  /**\n   * Loads the JavaScript bundle and runs the app.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#runapplication\n   */\n  runApplication(appKey: string, appParameters: any): void {\n    const msg =\n      'Running application \"' +\n      appKey +\n      '\" with appParams: ' +\n      JSON.stringify(appParameters) +\n      '. ' +\n      '__DEV__ === ' +\n      String(__DEV__) +\n      ', development-level warning are ' +\n      (__DEV__ ? 'ON' : 'OFF') +\n      ', performance optimizations are ' +\n      (__DEV__ ? 'OFF' : 'ON');\n    infoLog(msg);\n    BugReporting.addSource(\n      'AppRegistry.runApplication' + runCount++,\n      () => msg,\n    );\n    invariant(\n      runnables[appKey] && runnables[appKey].run,\n      'Application ' +\n        appKey +\n        ' has not been registered.\\n\\n' +\n        \"Hint: This error often happens when you're running the packager \" +\n        '(local dev server) from a wrong folder. For example you have ' +\n        'multiple apps and the packager is still running for the app you ' +\n        'were working on before.\\nIf this is the case, simply kill the old ' +\n        'packager instance (e.g. close the packager terminal window) ' +\n        'and start the packager in the correct app folder (e.g. cd into app ' +\n        \"folder and run 'npm start').\\n\\n\" +\n        'This error can also happen due to a require() error during ' +\n        'initialization or failure to call AppRegistry.registerComponent.\\n\\n',\n    );\n\n    SceneTracker.setActiveScene({name: appKey});\n    runnables[appKey].run(appParameters);\n  },\n\n  /**\n   * Stops an application when a view should be destroyed.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#unmountapplicationcomponentatroottag\n   */\n  unmountApplicationComponentAtRootTag(rootTag: number): void {\n    ReactNative.unmountComponentAtNodeAndRemoveContainer(rootTag);\n  },\n\n  /**\n   * Register a headless task. A headless task is a bit of code that runs without a UI.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#registerheadlesstask\n   */\n  registerHeadlessTask(taskKey: string, taskProvider: TaskProvider): void {\n    this.registerCancellableHeadlessTask(taskKey, taskProvider, () => () => {\n      /* Cancel is no-op */\n    });\n  },\n\n  /**\n   * Register a cancellable headless task. A headless task is a bit of code that runs without a UI.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#registercancellableheadlesstask\n   */\n  registerCancellableHeadlessTask(\n    taskKey: string,\n    taskProvider: TaskProvider,\n    taskCancelProvider: TaskCancelProvider,\n  ): void {\n    if (taskProviders.has(taskKey)) {\n      console.warn(\n        `registerHeadlessTask or registerCancellableHeadlessTask called multiple times for same key '${taskKey}'`,\n      );\n    }\n    taskProviders.set(taskKey, taskProvider);\n    taskCancelProviders.set(taskKey, taskCancelProvider);\n  },\n\n  /**\n   * Only called from native code. Starts a headless task.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#startheadlesstask\n   */\n  startHeadlessTask(taskId: number, taskKey: string, data: any): void {\n    const taskProvider = taskProviders.get(taskKey);\n    if (!taskProvider) {\n      console.warn(`No task registered for key ${taskKey}`);\n      NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);\n      return;\n    }\n    taskProvider()(data)\n      .then(() =>\n        NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId),\n      )\n      .catch(reason => {\n        console.error(reason);\n        NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);\n      });\n  },\n\n  /**\n   * Only called from native code. Cancels a headless task.\n   *\n   * See http://facebook.github.io/react-native/docs/appregistry.html#cancelheadlesstask\n   */\n  cancelHeadlessTask(taskId: number, taskKey: string): void {\n    const taskCancelProvider = taskCancelProviders.get(taskKey);\n    if (!taskCancelProvider) {\n      throw new Error(`No task canceller registered for key '${taskKey}'`);\n    }\n    taskCancelProvider()();\n  },\n};\n\nBatchedBridge.registerCallableModule('AppRegistry', AppRegistry);\n\nmodule.exports = AppRegistry;\n"]}