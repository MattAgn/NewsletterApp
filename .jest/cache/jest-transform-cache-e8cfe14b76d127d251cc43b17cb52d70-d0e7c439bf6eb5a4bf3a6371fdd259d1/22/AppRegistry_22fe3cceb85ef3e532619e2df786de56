0eb4fcefcb4d5632543ac51d5c2e2783
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var BatchedBridge = require('../BatchedBridge/BatchedBridge');

var BugReporting = require('../BugReporting/BugReporting');

var NativeModules = require('../BatchedBridge/NativeModules');

var ReactNative = require('../Renderer/shims/ReactNative');

var SceneTracker = require('../Utilities/SceneTracker');

var infoLog = require('../Utilities/infoLog');

var invariant = require('invariant');

var renderApplication = require('./renderApplication');

var createPerformanceLogger = require('../Utilities/createPerformanceLogger');

var runnables = {};
var runCount = 1;
var sections = {};
var taskProviders = new Map();
var taskCancelProviders = new Map();

var componentProviderInstrumentationHook = function componentProviderInstrumentationHook(component) {
  return component();
};

var wrapperComponentProvider;
var showFabricIndicator = false;
var AppRegistry = {
  setWrapperComponentProvider: function setWrapperComponentProvider(provider) {
    wrapperComponentProvider = provider;
  },
  enableFabricIndicator: function enableFabricIndicator(enabled) {
    showFabricIndicator = enabled;
  },
  registerConfig: function registerConfig(config) {
    config.forEach(function (appConfig) {
      if (appConfig.run) {
        AppRegistry.registerRunnable(appConfig.appKey, appConfig.run);
      } else {
        invariant(appConfig.component != null, 'AppRegistry.registerConfig(...): Every config is expected to set ' + 'either `run` or `component`, but `%s` has neither.', appConfig.appKey);
        AppRegistry.registerComponent(appConfig.appKey, appConfig.component, appConfig.section);
      }
    });
  },
  registerComponent: function registerComponent(appKey, componentProvider, section) {
    var scopedPerformanceLogger = createPerformanceLogger();
    runnables[appKey] = {
      componentProvider: componentProvider,
      run: function run(appParameters) {
        renderApplication(componentProviderInstrumentationHook(componentProvider, scopedPerformanceLogger), appParameters.initialProps, appParameters.rootTag, wrapperComponentProvider && wrapperComponentProvider(appParameters), appParameters.fabric, showFabricIndicator, scopedPerformanceLogger);
      }
    };

    if (section) {
      sections[appKey] = runnables[appKey];
    }

    return appKey;
  },
  registerRunnable: function registerRunnable(appKey, run) {
    runnables[appKey] = {
      run: run
    };
    return appKey;
  },
  registerSection: function registerSection(appKey, component) {
    AppRegistry.registerComponent(appKey, component, true);
  },
  getAppKeys: function getAppKeys() {
    return Object.keys(runnables);
  },
  getSectionKeys: function getSectionKeys() {
    return Object.keys(sections);
  },
  getSections: function getSections() {
    return _objectSpread({}, sections);
  },
  getRunnable: function getRunnable(appKey) {
    return runnables[appKey];
  },
  getRegistry: function getRegistry() {
    return {
      sections: AppRegistry.getSectionKeys(),
      runnables: _objectSpread({}, runnables)
    };
  },
  setComponentProviderInstrumentationHook: function setComponentProviderInstrumentationHook(hook) {
    componentProviderInstrumentationHook = hook;
  },
  runApplication: function runApplication(appKey, appParameters) {
    var msg = 'Running application "' + appKey + '" with appParams: ' + JSON.stringify(appParameters) + '. ' + '__DEV__ === ' + String(__DEV__) + ', development-level warning are ' + (__DEV__ ? 'ON' : 'OFF') + ', performance optimizations are ' + (__DEV__ ? 'OFF' : 'ON');
    infoLog(msg);
    BugReporting.addSource('AppRegistry.runApplication' + runCount++, function () {
      return msg;
    });
    invariant(runnables[appKey] && runnables[appKey].run, 'Application ' + appKey + ' has not been registered.\n\n' + "Hint: This error often happens when you're running the packager " + '(local dev server) from a wrong folder. For example you have ' + 'multiple apps and the packager is still running for the app you ' + 'were working on before.\nIf this is the case, simply kill the old ' + 'packager instance (e.g. close the packager terminal window) ' + 'and start the packager in the correct app folder (e.g. cd into app ' + "folder and run 'npm start').\n\n" + 'This error can also happen due to a require() error during ' + 'initialization or failure to call AppRegistry.registerComponent.\n\n');
    SceneTracker.setActiveScene({
      name: appKey
    });
    runnables[appKey].run(appParameters);
  },
  unmountApplicationComponentAtRootTag: function unmountApplicationComponentAtRootTag(rootTag) {
    ReactNative.unmountComponentAtNodeAndRemoveContainer(rootTag);
  },
  registerHeadlessTask: function registerHeadlessTask(taskKey, taskProvider) {
    this.registerCancellableHeadlessTask(taskKey, taskProvider, function () {
      return function () {};
    });
  },
  registerCancellableHeadlessTask: function registerCancellableHeadlessTask(taskKey, taskProvider, taskCancelProvider) {
    if (taskProviders.has(taskKey)) {
      console.warn("registerHeadlessTask or registerCancellableHeadlessTask called multiple times for same key '" + taskKey + "'");
    }

    taskProviders.set(taskKey, taskProvider);
    taskCancelProviders.set(taskKey, taskCancelProvider);
  },
  startHeadlessTask: function startHeadlessTask(taskId, taskKey, data) {
    var taskProvider = taskProviders.get(taskKey);

    if (!taskProvider) {
      console.warn("No task registered for key " + taskKey);
      NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);
      return;
    }

    taskProvider()(data).then(function () {
      return NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);
    }).catch(function (reason) {
      console.error(reason);
      NativeModules.HeadlessJsTaskSupport.notifyTaskFinished(taskId);
    });
  },
  cancelHeadlessTask: function cancelHeadlessTask(taskId, taskKey) {
    var taskCancelProvider = taskCancelProviders.get(taskKey);

    if (!taskCancelProvider) {
      throw new Error("No task canceller registered for key '" + taskKey + "'");
    }

    taskCancelProvider()();
  }
};
BatchedBridge.registerCallableModule('AppRegistry', AppRegistry);
module.exports = AppRegistry;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFwcFJlZ2lzdHJ5LmpzIl0sIm5hbWVzIjpbIkJhdGNoZWRCcmlkZ2UiLCJyZXF1aXJlIiwiQnVnUmVwb3J0aW5nIiwiTmF0aXZlTW9kdWxlcyIsIlJlYWN0TmF0aXZlIiwiU2NlbmVUcmFja2VyIiwiaW5mb0xvZyIsImludmFyaWFudCIsInJlbmRlckFwcGxpY2F0aW9uIiwiY3JlYXRlUGVyZm9ybWFuY2VMb2dnZXIiLCJydW5uYWJsZXMiLCJydW5Db3VudCIsInNlY3Rpb25zIiwidGFza1Byb3ZpZGVycyIsIk1hcCIsInRhc2tDYW5jZWxQcm92aWRlcnMiLCJjb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2siLCJjb21wb25lbnQiLCJ3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIiLCJzaG93RmFicmljSW5kaWNhdG9yIiwiQXBwUmVnaXN0cnkiLCJzZXRXcmFwcGVyQ29tcG9uZW50UHJvdmlkZXIiLCJwcm92aWRlciIsImVuYWJsZUZhYnJpY0luZGljYXRvciIsImVuYWJsZWQiLCJyZWdpc3RlckNvbmZpZyIsImNvbmZpZyIsImZvckVhY2giLCJhcHBDb25maWciLCJydW4iLCJyZWdpc3RlclJ1bm5hYmxlIiwiYXBwS2V5IiwicmVnaXN0ZXJDb21wb25lbnQiLCJzZWN0aW9uIiwiY29tcG9uZW50UHJvdmlkZXIiLCJzY29wZWRQZXJmb3JtYW5jZUxvZ2dlciIsImFwcFBhcmFtZXRlcnMiLCJpbml0aWFsUHJvcHMiLCJyb290VGFnIiwiZmFicmljIiwicmVnaXN0ZXJTZWN0aW9uIiwiZ2V0QXBwS2V5cyIsIk9iamVjdCIsImtleXMiLCJnZXRTZWN0aW9uS2V5cyIsImdldFNlY3Rpb25zIiwiZ2V0UnVubmFibGUiLCJnZXRSZWdpc3RyeSIsInNldENvbXBvbmVudFByb3ZpZGVySW5zdHJ1bWVudGF0aW9uSG9vayIsImhvb2siLCJydW5BcHBsaWNhdGlvbiIsIm1zZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJTdHJpbmciLCJfX0RFVl9fIiwiYWRkU291cmNlIiwic2V0QWN0aXZlU2NlbmUiLCJuYW1lIiwidW5tb3VudEFwcGxpY2F0aW9uQ29tcG9uZW50QXRSb290VGFnIiwidW5tb3VudENvbXBvbmVudEF0Tm9kZUFuZFJlbW92ZUNvbnRhaW5lciIsInJlZ2lzdGVySGVhZGxlc3NUYXNrIiwidGFza0tleSIsInRhc2tQcm92aWRlciIsInJlZ2lzdGVyQ2FuY2VsbGFibGVIZWFkbGVzc1Rhc2siLCJ0YXNrQ2FuY2VsUHJvdmlkZXIiLCJoYXMiLCJjb25zb2xlIiwid2FybiIsInNldCIsInN0YXJ0SGVhZGxlc3NUYXNrIiwidGFza0lkIiwiZGF0YSIsImdldCIsIkhlYWRsZXNzSnNUYXNrU3VwcG9ydCIsIm5vdGlmeVRhc2tGaW5pc2hlZCIsInRoZW4iLCJjYXRjaCIsInJlYXNvbiIsImVycm9yIiwiY2FuY2VsSGVhZGxlc3NUYXNrIiwiRXJyb3IiLCJyZWdpc3RlckNhbGxhYmxlTW9kdWxlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBU0E7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQ0FBRCxDQUE3Qjs7QUFDQSxJQUFNQyxZQUFZLEdBQUdELE9BQU8sQ0FBQyw4QkFBRCxDQUE1Qjs7QUFDQSxJQUFNRSxhQUFhLEdBQUdGLE9BQU8sQ0FBQyxnQ0FBRCxDQUE3Qjs7QUFDQSxJQUFNRyxXQUFXLEdBQUdILE9BQU8sQ0FBQywrQkFBRCxDQUEzQjs7QUFDQSxJQUFNSSxZQUFZLEdBQUdKLE9BQU8sQ0FBQywyQkFBRCxDQUE1Qjs7QUFFQSxJQUFNSyxPQUFPLEdBQUdMLE9BQU8sQ0FBQyxzQkFBRCxDQUF2Qjs7QUFDQSxJQUFNTSxTQUFTLEdBQUdOLE9BQU8sQ0FBQyxXQUFELENBQXpCOztBQUNBLElBQU1PLGlCQUFpQixHQUFHUCxPQUFPLENBQUMscUJBQUQsQ0FBakM7O0FBQ0EsSUFBTVEsdUJBQXVCLEdBQUdSLE9BQU8sQ0FBQyxzQ0FBRCxDQUF2Qzs7QUFnQ0EsSUFBTVMsU0FBb0IsR0FBRyxFQUE3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RSxXQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqIEBmb3JtYXRcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBCYXRjaGVkQnJpZGdlID0gcmVxdWlyZSgnLi4vQmF0Y2hlZEJyaWRnZS9CYXRjaGVkQnJpZGdlJyk7XG5jb25zdCBCdWdSZXBvcnRpbmcgPSByZXF1aXJlKCcuLi9CdWdSZXBvcnRpbmcvQnVnUmVwb3J0aW5nJyk7XG5jb25zdCBOYXRpdmVNb2R1bGVzID0gcmVxdWlyZSgnLi4vQmF0Y2hlZEJyaWRnZS9OYXRpdmVNb2R1bGVzJyk7XG5jb25zdCBSZWFjdE5hdGl2ZSA9IHJlcXVpcmUoJy4uL1JlbmRlcmVyL3NoaW1zL1JlYWN0TmF0aXZlJyk7XG5jb25zdCBTY2VuZVRyYWNrZXIgPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvU2NlbmVUcmFja2VyJyk7XG5cbmNvbnN0IGluZm9Mb2cgPSByZXF1aXJlKCcuLi9VdGlsaXRpZXMvaW5mb0xvZycpO1xuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnaW52YXJpYW50Jyk7XG5jb25zdCByZW5kZXJBcHBsaWNhdGlvbiA9IHJlcXVpcmUoJy4vcmVuZGVyQXBwbGljYXRpb24nKTtcbmNvbnN0IGNyZWF0ZVBlcmZvcm1hbmNlTG9nZ2VyID0gcmVxdWlyZSgnLi4vVXRpbGl0aWVzL2NyZWF0ZVBlcmZvcm1hbmNlTG9nZ2VyJyk7XG5pbXBvcnQgdHlwZSB7SVBlcmZvcm1hbmNlTG9nZ2VyfSBmcm9tICcuLi9VdGlsaXRpZXMvY3JlYXRlUGVyZm9ybWFuY2VMb2dnZXInO1xuXG50eXBlIFRhc2sgPSAodGFza0RhdGE6IGFueSkgPT4gUHJvbWlzZTx2b2lkPjtcbnR5cGUgVGFza1Byb3ZpZGVyID0gKCkgPT4gVGFzaztcbnR5cGUgVGFza0NhbmNlbGxlciA9ICgpID0+IHZvaWQ7XG50eXBlIFRhc2tDYW5jZWxQcm92aWRlciA9ICgpID0+IFRhc2tDYW5jZWxsZXI7XG5cbmV4cG9ydCB0eXBlIENvbXBvbmVudFByb3ZpZGVyID0gKCkgPT4gUmVhY3QkQ29tcG9uZW50VHlwZTxhbnk+O1xuZXhwb3J0IHR5cGUgQ29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rID0gKFxuICBjb21wb25lbnQ6IENvbXBvbmVudFByb3ZpZGVyLFxuICBzY29wZWRQZXJmb3JtYW5jZUxvZ2dlcjogSVBlcmZvcm1hbmNlTG9nZ2VyLFxuKSA9PiBSZWFjdCRDb21wb25lbnRUeXBlPGFueT47XG5leHBvcnQgdHlwZSBBcHBDb25maWcgPSB7XG4gIGFwcEtleTogc3RyaW5nLFxuICBjb21wb25lbnQ/OiBDb21wb25lbnRQcm92aWRlcixcbiAgcnVuPzogRnVuY3Rpb24sXG4gIHNlY3Rpb24/OiBib29sZWFuLFxufTtcbmV4cG9ydCB0eXBlIFJ1bm5hYmxlID0ge1xuICBjb21wb25lbnQ/OiBDb21wb25lbnRQcm92aWRlcixcbiAgcnVuOiBGdW5jdGlvbixcbn07XG5leHBvcnQgdHlwZSBSdW5uYWJsZXMgPSB7XG4gIFthcHBLZXk6IHN0cmluZ106IFJ1bm5hYmxlLFxufTtcbmV4cG9ydCB0eXBlIFJlZ2lzdHJ5ID0ge1xuICBzZWN0aW9uczogQXJyYXk8c3RyaW5nPixcbiAgcnVubmFibGVzOiBSdW5uYWJsZXMsXG59O1xuZXhwb3J0IHR5cGUgV3JhcHBlckNvbXBvbmVudFByb3ZpZGVyID0gYW55ID0+IFJlYWN0JENvbXBvbmVudFR5cGU8Kj47XG5cbmNvbnN0IHJ1bm5hYmxlczogUnVubmFibGVzID0ge307XG5sZXQgcnVuQ291bnQgPSAxO1xuY29uc3Qgc2VjdGlvbnM6IFJ1bm5hYmxlcyA9IHt9O1xuY29uc3QgdGFza1Byb3ZpZGVyczogTWFwPHN0cmluZywgVGFza1Byb3ZpZGVyPiA9IG5ldyBNYXAoKTtcbmNvbnN0IHRhc2tDYW5jZWxQcm92aWRlcnM6IE1hcDxzdHJpbmcsIFRhc2tDYW5jZWxQcm92aWRlcj4gPSBuZXcgTWFwKCk7XG5sZXQgY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rOiBDb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2sgPSAoXG4gIGNvbXBvbmVudDogQ29tcG9uZW50UHJvdmlkZXIsXG4pID0+IGNvbXBvbmVudCgpO1xuXG5sZXQgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyOiA/V3JhcHBlckNvbXBvbmVudFByb3ZpZGVyO1xubGV0IHNob3dGYWJyaWNJbmRpY2F0b3IgPSBmYWxzZTtcblxuLyoqXG4gKiBgQXBwUmVnaXN0cnlgIGlzIHRoZSBKYXZhU2NyaXB0IGVudHJ5IHBvaW50IHRvIHJ1bm5pbmcgYWxsIFJlYWN0IE5hdGl2ZSBhcHBzLlxuICpcbiAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FwcHJlZ2lzdHJ5Lmh0bWxcbiAqL1xuY29uc3QgQXBwUmVnaXN0cnkgPSB7XG4gIHNldFdyYXBwZXJDb21wb25lbnRQcm92aWRlcihwcm92aWRlcjogV3JhcHBlckNvbXBvbmVudFByb3ZpZGVyKSB7XG4gICAgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyID0gcHJvdmlkZXI7XG4gIH0sXG5cbiAgZW5hYmxlRmFicmljSW5kaWNhdG9yKGVuYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBzaG93RmFicmljSW5kaWNhdG9yID0gZW5hYmxlZDtcbiAgfSxcblxuICByZWdpc3RlckNvbmZpZyhjb25maWc6IEFycmF5PEFwcENvbmZpZz4pOiB2b2lkIHtcbiAgICBjb25maWcuZm9yRWFjaChhcHBDb25maWcgPT4ge1xuICAgICAgaWYgKGFwcENvbmZpZy5ydW4pIHtcbiAgICAgICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJSdW5uYWJsZShhcHBDb25maWcuYXBwS2V5LCBhcHBDb25maWcucnVuKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGludmFyaWFudChcbiAgICAgICAgICBhcHBDb25maWcuY29tcG9uZW50ICE9IG51bGwsXG4gICAgICAgICAgJ0FwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29uZmlnKC4uLik6IEV2ZXJ5IGNvbmZpZyBpcyBleHBlY3RlZCB0byBzZXQgJyArXG4gICAgICAgICAgICAnZWl0aGVyIGBydW5gIG9yIGBjb21wb25lbnRgLCBidXQgYCVzYCBoYXMgbmVpdGhlci4nLFxuICAgICAgICAgIGFwcENvbmZpZy5hcHBLZXksXG4gICAgICAgICk7XG4gICAgICAgIEFwcFJlZ2lzdHJ5LnJlZ2lzdGVyQ29tcG9uZW50KFxuICAgICAgICAgIGFwcENvbmZpZy5hcHBLZXksXG4gICAgICAgICAgYXBwQ29uZmlnLmNvbXBvbmVudCxcbiAgICAgICAgICBhcHBDb25maWcuc2VjdGlvbixcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogUmVnaXN0ZXJzIGFuIGFwcCdzIHJvb3QgY29tcG9uZW50LlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hcHByZWdpc3RyeS5odG1sI3JlZ2lzdGVyY29tcG9uZW50XG4gICAqL1xuICByZWdpc3RlckNvbXBvbmVudChcbiAgICBhcHBLZXk6IHN0cmluZyxcbiAgICBjb21wb25lbnRQcm92aWRlcjogQ29tcG9uZW50UHJvdmlkZXIsXG4gICAgc2VjdGlvbj86IGJvb2xlYW4sXG4gICk6IHN0cmluZyB7XG4gICAgbGV0IHNjb3BlZFBlcmZvcm1hbmNlTG9nZ2VyID0gY3JlYXRlUGVyZm9ybWFuY2VMb2dnZXIoKTtcbiAgICBydW5uYWJsZXNbYXBwS2V5XSA9IHtcbiAgICAgIGNvbXBvbmVudFByb3ZpZGVyLFxuICAgICAgcnVuOiBhcHBQYXJhbWV0ZXJzID0+IHtcbiAgICAgICAgcmVuZGVyQXBwbGljYXRpb24oXG4gICAgICAgICAgY29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rKFxuICAgICAgICAgICAgY29tcG9uZW50UHJvdmlkZXIsXG4gICAgICAgICAgICBzY29wZWRQZXJmb3JtYW5jZUxvZ2dlcixcbiAgICAgICAgICApLFxuICAgICAgICAgIGFwcFBhcmFtZXRlcnMuaW5pdGlhbFByb3BzLFxuICAgICAgICAgIGFwcFBhcmFtZXRlcnMucm9vdFRhZyxcbiAgICAgICAgICB3cmFwcGVyQ29tcG9uZW50UHJvdmlkZXIgJiYgd3JhcHBlckNvbXBvbmVudFByb3ZpZGVyKGFwcFBhcmFtZXRlcnMpLFxuICAgICAgICAgIGFwcFBhcmFtZXRlcnMuZmFicmljLFxuICAgICAgICAgIHNob3dGYWJyaWNJbmRpY2F0b3IsXG4gICAgICAgICAgc2NvcGVkUGVyZm9ybWFuY2VMb2dnZXIsXG4gICAgICAgICk7XG4gICAgICB9LFxuICAgIH07XG4gICAgaWYgKHNlY3Rpb24pIHtcbiAgICAgIHNlY3Rpb25zW2FwcEtleV0gPSBydW5uYWJsZXNbYXBwS2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIGFwcEtleTtcbiAgfSxcblxuICByZWdpc3RlclJ1bm5hYmxlKGFwcEtleTogc3RyaW5nLCBydW46IEZ1bmN0aW9uKTogc3RyaW5nIHtcbiAgICBydW5uYWJsZXNbYXBwS2V5XSA9IHtydW59O1xuICAgIHJldHVybiBhcHBLZXk7XG4gIH0sXG5cbiAgcmVnaXN0ZXJTZWN0aW9uKGFwcEtleTogc3RyaW5nLCBjb21wb25lbnQ6IENvbXBvbmVudFByb3ZpZGVyKTogdm9pZCB7XG4gICAgQXBwUmVnaXN0cnkucmVnaXN0ZXJDb21wb25lbnQoYXBwS2V5LCBjb21wb25lbnQsIHRydWUpO1xuICB9LFxuXG4gIGdldEFwcEtleXMoKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHJ1bm5hYmxlcyk7XG4gIH0sXG5cbiAgZ2V0U2VjdGlvbktleXMoKTogQXJyYXk8c3RyaW5nPiB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKHNlY3Rpb25zKTtcbiAgfSxcblxuICBnZXRTZWN0aW9ucygpOiBSdW5uYWJsZXMge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zZWN0aW9ucyxcbiAgICB9O1xuICB9LFxuXG4gIGdldFJ1bm5hYmxlKGFwcEtleTogc3RyaW5nKTogP1J1bm5hYmxlIHtcbiAgICByZXR1cm4gcnVubmFibGVzW2FwcEtleV07XG4gIH0sXG5cbiAgZ2V0UmVnaXN0cnkoKTogUmVnaXN0cnkge1xuICAgIHJldHVybiB7XG4gICAgICBzZWN0aW9uczogQXBwUmVnaXN0cnkuZ2V0U2VjdGlvbktleXMoKSxcbiAgICAgIHJ1bm5hYmxlczogey4uLnJ1bm5hYmxlc30sXG4gICAgfTtcbiAgfSxcblxuICBzZXRDb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2soXG4gICAgaG9vazogQ29tcG9uZW50UHJvdmlkZXJJbnN0cnVtZW50YXRpb25Ib29rLFxuICApIHtcbiAgICBjb21wb25lbnRQcm92aWRlckluc3RydW1lbnRhdGlvbkhvb2sgPSBob29rO1xuICB9LFxuXG4gIC8qKlxuICAgKiBMb2FkcyB0aGUgSmF2YVNjcmlwdCBidW5kbGUgYW5kIHJ1bnMgdGhlIGFwcC5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXBwcmVnaXN0cnkuaHRtbCNydW5hcHBsaWNhdGlvblxuICAgKi9cbiAgcnVuQXBwbGljYXRpb24oYXBwS2V5OiBzdHJpbmcsIGFwcFBhcmFtZXRlcnM6IGFueSk6IHZvaWQge1xuICAgIGNvbnN0IG1zZyA9XG4gICAgICAnUnVubmluZyBhcHBsaWNhdGlvbiBcIicgK1xuICAgICAgYXBwS2V5ICtcbiAgICAgICdcIiB3aXRoIGFwcFBhcmFtczogJyArXG4gICAgICBKU09OLnN0cmluZ2lmeShhcHBQYXJhbWV0ZXJzKSArXG4gICAgICAnLiAnICtcbiAgICAgICdfX0RFVl9fID09PSAnICtcbiAgICAgIFN0cmluZyhfX0RFVl9fKSArXG4gICAgICAnLCBkZXZlbG9wbWVudC1sZXZlbCB3YXJuaW5nIGFyZSAnICtcbiAgICAgIChfX0RFVl9fID8gJ09OJyA6ICdPRkYnKSArXG4gICAgICAnLCBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25zIGFyZSAnICtcbiAgICAgIChfX0RFVl9fID8gJ09GRicgOiAnT04nKTtcbiAgICBpbmZvTG9nKG1zZyk7XG4gICAgQnVnUmVwb3J0aW5nLmFkZFNvdXJjZShcbiAgICAgICdBcHBSZWdpc3RyeS5ydW5BcHBsaWNhdGlvbicgKyBydW5Db3VudCsrLFxuICAgICAgKCkgPT4gbXNnLFxuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgcnVubmFibGVzW2FwcEtleV0gJiYgcnVubmFibGVzW2FwcEtleV0ucnVuLFxuICAgICAgJ0FwcGxpY2F0aW9uICcgK1xuICAgICAgICBhcHBLZXkgK1xuICAgICAgICAnIGhhcyBub3QgYmVlbiByZWdpc3RlcmVkLlxcblxcbicgK1xuICAgICAgICBcIkhpbnQ6IFRoaXMgZXJyb3Igb2Z0ZW4gaGFwcGVucyB3aGVuIHlvdSdyZSBydW5uaW5nIHRoZSBwYWNrYWdlciBcIiArXG4gICAgICAgICcobG9jYWwgZGV2IHNlcnZlcikgZnJvbSBhIHdyb25nIGZvbGRlci4gRm9yIGV4YW1wbGUgeW91IGhhdmUgJyArXG4gICAgICAgICdtdWx0aXBsZSBhcHBzIGFuZCB0aGUgcGFja2FnZXIgaXMgc3RpbGwgcnVubmluZyBmb3IgdGhlIGFwcCB5b3UgJyArXG4gICAgICAgICd3ZXJlIHdvcmtpbmcgb24gYmVmb3JlLlxcbklmIHRoaXMgaXMgdGhlIGNhc2UsIHNpbXBseSBraWxsIHRoZSBvbGQgJyArXG4gICAgICAgICdwYWNrYWdlciBpbnN0YW5jZSAoZS5nLiBjbG9zZSB0aGUgcGFja2FnZXIgdGVybWluYWwgd2luZG93KSAnICtcbiAgICAgICAgJ2FuZCBzdGFydCB0aGUgcGFja2FnZXIgaW4gdGhlIGNvcnJlY3QgYXBwIGZvbGRlciAoZS5nLiBjZCBpbnRvIGFwcCAnICtcbiAgICAgICAgXCJmb2xkZXIgYW5kIHJ1biAnbnBtIHN0YXJ0JykuXFxuXFxuXCIgK1xuICAgICAgICAnVGhpcyBlcnJvciBjYW4gYWxzbyBoYXBwZW4gZHVlIHRvIGEgcmVxdWlyZSgpIGVycm9yIGR1cmluZyAnICtcbiAgICAgICAgJ2luaXRpYWxpemF0aW9uIG9yIGZhaWx1cmUgdG8gY2FsbCBBcHBSZWdpc3RyeS5yZWdpc3RlckNvbXBvbmVudC5cXG5cXG4nLFxuICAgICk7XG5cbiAgICBTY2VuZVRyYWNrZXIuc2V0QWN0aXZlU2NlbmUoe25hbWU6IGFwcEtleX0pO1xuICAgIHJ1bm5hYmxlc1thcHBLZXldLnJ1bihhcHBQYXJhbWV0ZXJzKTtcbiAgfSxcblxuICAvKipcbiAgICogU3RvcHMgYW4gYXBwbGljYXRpb24gd2hlbiBhIHZpZXcgc2hvdWxkIGJlIGRlc3Ryb3llZC5cbiAgICpcbiAgICogU2VlIGh0dHA6Ly9mYWNlYm9vay5naXRodWIuaW8vcmVhY3QtbmF0aXZlL2RvY3MvYXBwcmVnaXN0cnkuaHRtbCN1bm1vdW50YXBwbGljYXRpb25jb21wb25lbnRhdHJvb3R0YWdcbiAgICovXG4gIHVubW91bnRBcHBsaWNhdGlvbkNvbXBvbmVudEF0Um9vdFRhZyhyb290VGFnOiBudW1iZXIpOiB2b2lkIHtcbiAgICBSZWFjdE5hdGl2ZS51bm1vdW50Q29tcG9uZW50QXROb2RlQW5kUmVtb3ZlQ29udGFpbmVyKHJvb3RUYWcpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGhlYWRsZXNzIHRhc2suIEEgaGVhZGxlc3MgdGFzayBpcyBhIGJpdCBvZiBjb2RlIHRoYXQgcnVucyB3aXRob3V0IGEgVUkuXG4gICAqXG4gICAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FwcHJlZ2lzdHJ5Lmh0bWwjcmVnaXN0ZXJoZWFkbGVzc3Rhc2tcbiAgICovXG4gIHJlZ2lzdGVySGVhZGxlc3NUYXNrKHRhc2tLZXk6IHN0cmluZywgdGFza1Byb3ZpZGVyOiBUYXNrUHJvdmlkZXIpOiB2b2lkIHtcbiAgICB0aGlzLnJlZ2lzdGVyQ2FuY2VsbGFibGVIZWFkbGVzc1Rhc2sodGFza0tleSwgdGFza1Byb3ZpZGVyLCAoKSA9PiAoKSA9PiB7XG4gICAgICAvKiBDYW5jZWwgaXMgbm8tb3AgKi9cbiAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBjYW5jZWxsYWJsZSBoZWFkbGVzcyB0YXNrLiBBIGhlYWRsZXNzIHRhc2sgaXMgYSBiaXQgb2YgY29kZSB0aGF0IHJ1bnMgd2l0aG91dCBhIFVJLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hcHByZWdpc3RyeS5odG1sI3JlZ2lzdGVyY2FuY2VsbGFibGVoZWFkbGVzc3Rhc2tcbiAgICovXG4gIHJlZ2lzdGVyQ2FuY2VsbGFibGVIZWFkbGVzc1Rhc2soXG4gICAgdGFza0tleTogc3RyaW5nLFxuICAgIHRhc2tQcm92aWRlcjogVGFza1Byb3ZpZGVyLFxuICAgIHRhc2tDYW5jZWxQcm92aWRlcjogVGFza0NhbmNlbFByb3ZpZGVyLFxuICApOiB2b2lkIHtcbiAgICBpZiAodGFza1Byb3ZpZGVycy5oYXModGFza0tleSkpIHtcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgYHJlZ2lzdGVySGVhZGxlc3NUYXNrIG9yIHJlZ2lzdGVyQ2FuY2VsbGFibGVIZWFkbGVzc1Rhc2sgY2FsbGVkIG11bHRpcGxlIHRpbWVzIGZvciBzYW1lIGtleSAnJHt0YXNrS2V5fSdgLFxuICAgICAgKTtcbiAgICB9XG4gICAgdGFza1Byb3ZpZGVycy5zZXQodGFza0tleSwgdGFza1Byb3ZpZGVyKTtcbiAgICB0YXNrQ2FuY2VsUHJvdmlkZXJzLnNldCh0YXNrS2V5LCB0YXNrQ2FuY2VsUHJvdmlkZXIpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBPbmx5IGNhbGxlZCBmcm9tIG5hdGl2ZSBjb2RlLiBTdGFydHMgYSBoZWFkbGVzcyB0YXNrLlxuICAgKlxuICAgKiBTZWUgaHR0cDovL2ZhY2Vib29rLmdpdGh1Yi5pby9yZWFjdC1uYXRpdmUvZG9jcy9hcHByZWdpc3RyeS5odG1sI3N0YXJ0aGVhZGxlc3N0YXNrXG4gICAqL1xuICBzdGFydEhlYWRsZXNzVGFzayh0YXNrSWQ6IG51bWJlciwgdGFza0tleTogc3RyaW5nLCBkYXRhOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCB0YXNrUHJvdmlkZXIgPSB0YXNrUHJvdmlkZXJzLmdldCh0YXNrS2V5KTtcbiAgICBpZiAoIXRhc2tQcm92aWRlcikge1xuICAgICAgY29uc29sZS53YXJuKGBObyB0YXNrIHJlZ2lzdGVyZWQgZm9yIGtleSAke3Rhc2tLZXl9YCk7XG4gICAgICBOYXRpdmVNb2R1bGVzLkhlYWRsZXNzSnNUYXNrU3VwcG9ydC5ub3RpZnlUYXNrRmluaXNoZWQodGFza0lkKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGFza1Byb3ZpZGVyKCkoZGF0YSlcbiAgICAgIC50aGVuKCgpID0+XG4gICAgICAgIE5hdGl2ZU1vZHVsZXMuSGVhZGxlc3NKc1Rhc2tTdXBwb3J0Lm5vdGlmeVRhc2tGaW5pc2hlZCh0YXNrSWQpLFxuICAgICAgKVxuICAgICAgLmNhdGNoKHJlYXNvbiA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTtcbiAgICAgICAgTmF0aXZlTW9kdWxlcy5IZWFkbGVzc0pzVGFza1N1cHBvcnQubm90aWZ5VGFza0ZpbmlzaGVkKHRhc2tJZCk7XG4gICAgICB9KTtcbiAgfSxcblxuICAvKipcbiAgICogT25seSBjYWxsZWQgZnJvbSBuYXRpdmUgY29kZS4gQ2FuY2VscyBhIGhlYWRsZXNzIHRhc2suXG4gICAqXG4gICAqIFNlZSBodHRwOi8vZmFjZWJvb2suZ2l0aHViLmlvL3JlYWN0LW5hdGl2ZS9kb2NzL2FwcHJlZ2lzdHJ5Lmh0bWwjY2FuY2VsaGVhZGxlc3N0YXNrXG4gICAqL1xuICBjYW5jZWxIZWFkbGVzc1Rhc2sodGFza0lkOiBudW1iZXIsIHRhc2tLZXk6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHRhc2tDYW5jZWxQcm92aWRlciA9IHRhc2tDYW5jZWxQcm92aWRlcnMuZ2V0KHRhc2tLZXkpO1xuICAgIGlmICghdGFza0NhbmNlbFByb3ZpZGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHRhc2sgY2FuY2VsbGVyIHJlZ2lzdGVyZWQgZm9yIGtleSAnJHt0YXNrS2V5fSdgKTtcbiAgICB9XG4gICAgdGFza0NhbmNlbFByb3ZpZGVyKCkoKTtcbiAgfSxcbn07XG5cbkJhdGNoZWRCcmlkZ2UucmVnaXN0ZXJDYWxsYWJsZU1vZHVsZSgnQXBwUmVnaXN0cnknLCBBcHBSZWdpc3RyeSk7XG5cbm1vZHVsZS5leHBvcnRzID0gQXBwUmVnaXN0cnk7XG4iXX0=